"use strict";(self.webpackChunkyouniaogu=self.webpackChunkyouniaogu||[]).push([[1477],{10:n=>{n.exports=JSON.parse('{"blogPosts":[{"id":"/2022/04/07/console_log_what_a_lier","metadata":{"permalink":"/blog/2022/04/07/console_log_what_a_lier","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2022-04-07-console_log_what_a_lier.md","source":"@site/blog/2022-04-07-console_log_what_a_lier.md","title":"\u8bf4\u8c0e\u7684 console.log","description":"\u8bf4\u8c0e\u7684 console.log","date":"2022-04-07T00:00:00.000Z","formattedDate":"2022\u5e744\u67087\u65e5","tags":[],"readingTime":3.625,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u8bf4\u8c0e\u7684 console.log","authors":"youniaogu","date":"2022-04-07T00:00:00.000Z","tags":[]},"nextItem":{"title":"\u5982\u4f55\u5904\u7406 package-lock.json \u4e0e yarn.lock","permalink":"/blog/2022/03/09/how_to_handle_lock_file"}},"content":"### \u8bf4\u8c0e\u7684 console.log\\n\\n#### 1\u3001\u524d\u8a00\\n\\n`console.log`\uff0c\u524d\u7aef\u5728\u8c03\u8bd5\u65f6\u7528\u5f97\u6700\u591a\u7684\u5c0f\u4f19\u4f34\uff0c\u4f46\u4f60\u53ef\u80fd\u4e0d\u77e5\u9053\uff0c\u5b83\u6709\u65f6\u5019\u4e5f\u4f1a\u8bf4\u8c0e\\n\\n\u4e4b\u6240\u4ee5\u8981\u8bf4\u8fd9\u4e2a\uff0c\u539f\u56e0\u662f\u6700\u8fd1\u4fee \ud83d\udc1b \u65f6\uff0c\u65e0\u610f\u4e2d\u53d1\u73b0`console.log`\u65ad\u70b9\u8c03\u8bd5\u8f93\u51fa\u4e0e\u975e\u65ad\u70b9\u8f93\u51fa\u4e0d\u4e00\u81f4\\n\\n<img src={require(\\"./assets/stickers/9.jpg\\").default} width=\\"300\\" />\\n\\n#### 2\u3001\u4e3a\u4ec0\u4e48 console.log \u8f93\u51fa\u4f1a\u4e0d\u4e00\u81f4\uff1f\\n\\n\u9996\u5148\uff0c\u6211\u4eec\u8981\u660e\u786e\u4e00\u4e2a\u89c2\u5ff5\uff0c`console.log`\u662f\u540c\u6b65\u7684\u8fd8\u662f\u5f02\u6b65\u7684\uff1f\\n\\n\u7406\u8bba\u4e0a\uff0c`console.log`\u662f\u540c\u6b65\u7684\uff0c\u4ed6\u4eec\u5b9e\u65f6\u8f93\u51fa\u6570\u636e\uff0c\u4f46\u5728\u8f93\u51fa\u5f15\u7528\u7c7b\u578b\u7684\u6570\u636e\uff0c\u4f1a\u6709\u4e0d\u540c\u7684\u884c\u4e3a\\n\\n<img src={require(\\"./assets/screenshots/42.png\\").default} width=\\"900\\" />\\n\\n\u53ef\u4ee5\u770b\u5230\uff0c\u5f15\u7528\u7c7b\u578b\u6570\u636e\u5982\u679c\u5b58\u5728\u5d4c\u5957\u65f6\uff08\u56fe\u4e2d\u7ea2\u7ebf\uff09\uff0clog \u4e0d\u4f1a\u7ee7\u7eed\u8f93\u51fa\u91cc\u9762\u7684\u6570\u636e\uff0c\u800c\u662f\u4f1a\u7701\u7565\\n\\n\u800c\u4e14\u5f15\u7528\u7c7b\u578b\u8fd8\u53ef\u4ee5**\u5c55\u5f00**\uff0c\u7528\u6765\u67e5\u770b\u91cc\u9762\u5d4c\u5957\u7684\u6570\u636e\uff0c\u8fd9\u662f\u6211\u4eec\u5e73\u65f6\u8c03\u8bd5\u5e38\u7528\u7684\u52a8\u4f5c\\n\\n\u800c`console.log`\u8f93\u51fa\u4e0d\u4e00\u81f4\u7684\u539f\u56e0\uff0c\u5c31\u5728\u4e8e**\u5c55\u5f00**\u8fd9\u4e2a\u52a8\u4f5c\\n\\n<img src={require(\\"./assets/stickers/6.png\\").default} width=\\"300\\" />\\n\\n\u4e4b\u524d`console.log`\u8f93\u51fa\u7684\u6570\u636e\u5e76\u4e0d\u5b8c\u6574\uff0c\u53ea\u80fd\u8bf4\u662f\u4e00\u79cd\u5feb\u7167\u3002\u800c\u5728\u5c55\u5f00\u65f6\uff0c\u5219\u4f1a\u5f80\u5806\u5185\u5b58\u91cc\u62ff\u6700\u65b0\u7684\u6570\u636e\uff0c\u8fd9\u4e2d\u95f4\u5982\u679c\u6709\u5bf9\u6570\u636e\u8fdb\u884c\u4fee\u6539\u7684\u8bdd\uff0c\u5c31\u4f1a\u51fa\u73b0\u5f02\u6b65\u7684\u5047\u8c61\\n\\n\u4e3e\u4e2a \ud83c\udf30\\n\\n\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u7acb\u5373\u5c55\u5f00\u548c\u4e09\u79d2\u540e\u5c55\u5f00\u4f1a\u6709\u4e0d\u540c\u7684\u7ed3\u679c\\n\\n```javascript\\nconst obj = { name: \\"start\\" };\\n\\nconsole.log(obj);\\n\\nsetTimeout(() => {\\n  obj.name = \\"after 3 seconds\\";\\n}, 3000);\\n```\\n\\n<img src={require(\\"./assets/screenshots/43.png\\").default} width=\\"300\\" />\\n\\n<img src={require(\\"./assets/screenshots/44.png\\").default} width=\\"300\\" />\\n\\n\u56de\u5230\u6700\u5f00\u59cb\u7684\u95ee\u9898\uff0c\u4e3a\u4ec0\u4e48\u65ad\u70b9\u548c\u975e\u65ad\u70b9\u8c03\u8bd5\uff0c`console.log`\u8f93\u51fa\u4f1a\u4e0d\u4e00\u81f4\\n\\n\u7b54\u6848\u5f88\u660e\u4e86\uff0c\u4ee3\u7801\u91cc\u5b58\u5728\u5bf9\u8f93\u51fa\u6570\u636e\u7684\u4fee\u6539\uff0c\u5bfc\u81f4\u4e24\u6b21\u8c03\u8bd5\u7ed3\u679c\u4e0d\u4e00\u81f4\u3002\\n\\n\u800c\u5c31\u7ed3\u679c\u6765\u770b\uff0c\u65ad\u70b9\u8c03\u8bd5\u7684\u8f93\u51fa\u624d\u662f\u6b63\u786e\u7684\uff0c\u4e5f\u662f\u6211\u4eec\u60f3\u8981\u7684\uff08\u90fd\u65ad\u70b9\u4e86\uff0c\u8c01\u8fd8\u770b log \u5440\uff09\u3002\\n\\n#### 3\u3001\u4e3a\u4ec0\u4e48\u4f1a\u8fd9\u4e48\u8bbe\u8ba1\uff1f\\n\\n\u4e3b\u8981\u539f\u56e0\u5728\u4e8e\u5f15\u7528\u7c7b\u578b\u4f1a\u5b58\u5728**\u5faa\u73af\u5f15\u7528**\u7684\u60c5\u51b5\uff0c\u4e00\u6b21\u6027\u6253\u5370\u51fa\u6765\u7684\u8bdd\u5c31\u4f1a\u6b7b\u5faa\u73af\uff0c\u800c\u5982\u679c\u7f13\u5b58\u6570\u636e\uff0c\u5219\u4f1a\u5360\u7528\u8d44\u6e90\\n\\n\u6ce8\u610f\uff1a\u4ee5\u4e0a\u6d4b\u8bd5\u4e0e\u7ed3\u8bba\u90fd\u57fa\u4e8e chrome \u6d4f\u89c8\u5668\uff0c\u4e0d\u540c\u6d4f\u89c8\u5668\u5b9e\u73b0\u53ef\u80fd\u4e0d\u4e00\u6837\\n\\n#### 4\u3001\u603b\u7ed3\\n\\n`console.log`\u5728\u6253\u5370\u5f15\u7528\u7c7b\u578b\u65f6\uff0c\u4f1a\u7acb\u9a6c\u8f93\u51fa\u5f53\u524d\u7684\u5feb\u7167\uff0c\u5e76\u4f1a\u7701\u7565\u5d4c\u5957\u7684\u5f15\u7528\u7c7b\u578b\u6570\u636e\u3002\u800c\u540e\u9762**\u5c55\u5f00**\u6570\u636e\u65f6\uff0c\u4f1a\u5f80\u5806\u91cc\u62ff\u53d6\u6700\u65b0\u6570\u636e\uff0c\u540c\u65f6\u4e5f\u4f1a\u7f13\u5b58\u8d77\u6765\uff08\u540e\u7eed\u5f00\u5173\u4e0d\u4f1a\u66f4\u65b0\u6570\u636e\uff09\\n\\n\u5e76\u4e0d\u53ea\u662f`console.log`\u6709\u8fd9\u4e2a\u7279\u6027\uff0c\u53ea\u8981\u662f\u6d89\u53ca**\u5c55\u5f00**\u8fd9\u4e2a\u52a8\u4f5c\uff0c\u5c31\u4f1a\u5b58\u5728\\n\\n<img src={require(\\"./assets/stickers/13.jpg\\").default} width=\\"300\\" />\\n\\n\u4e86\u89e3\u8fd9\u4e2a\u7279\u6027\u53ef\u4ee5\u8ba9\u6211\u4eec debug \u5c11\u8d70\u5f2f\u8def\uff0c\u4f46\u6709\u4e00\u70b9\u8981\u660e\u767d\uff0c\u6700\u597d\u7684 debug \u65b9\u6cd5\u8fd8\u5f97\u662f**\u65ad\u70b9**\\n\\n\u9664\u6b64\u4e4b\u5916\uff0c\u826f\u597d\u7684\u4ee3\u7801\u4e60\u60ef\u4e5f\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\uff08\u524d\u8a00\u91cc\u7684\u95ee\u9898\u662f\u56e0\u4e3a\u5728 react \u91cc\u76f4\u63a5\u4fee\u6539 state\uff0c\u7136\u540e\u4f7f\u7528 forceUpdate \u8fdb\u884c render \u5bfc\u81f4\uff0c\u6211\u771f\u662f\u4f69\u670d\u5199\u51fa\u8fd9\u4e2a\u7684\u8001\u54e5\uff09"},{"id":"/2022/03/09/how_to_handle_lock_file","metadata":{"permalink":"/blog/2022/03/09/how_to_handle_lock_file","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2022-03-09-how_to_handle_lock_file.md","source":"@site/blog/2022-03-09-how_to_handle_lock_file.md","title":"\u5982\u4f55\u5904\u7406 package-lock.json \u4e0e yarn.lock","description":"\u5982\u4f55\u5904\u7406 package-lock.json \u4e0e yarn.lock","date":"2022-03-09T00:00:00.000Z","formattedDate":"2022\u5e743\u67089\u65e5","tags":[],"readingTime":4.36,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u5982\u4f55\u5904\u7406 package-lock.json \u4e0e yarn.lock","authors":"youniaogu","date":"2022-03-09T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u8bf4\u8c0e\u7684 console.log","permalink":"/blog/2022/04/07/console_log_what_a_lier"},"nextItem":{"title":"\u5c0f\u7a0b\u5e8f\u5f00\u53d1\u7ecf\u9a8c\u5206\u4eab","permalink":"/blog/2021/09/03/experience_of_build_wechat_miniapp"}},"content":"### \u5982\u4f55\u5904\u7406 package-lock.json \u4e0e yarn.lock\\n\\n#### 1\u3001\u524d\u8a00\\n\\n`package-lock.json`\u4e0e`yarn.lock`\u5206\u522b\u662f`npm`\u548c`yarn`\u5728\u5b89\u88c5\u4f9d\u8d56\u540e\u81ea\u52a8\u751f\u6210\u7684\u6587\u4ef6\uff0c\u7528\u6765\u8bb0\u5f55\u5b89\u88c5\u4f9d\u8d56\u7684\u5177\u4f53\u7248\u672c\\n\\n\u6bcf\u5f53\u6267\u884c`npm install`\u548c`yarn install`\u90fd\u4f1a\u53bb\u521b\u5efa\u6216\u66f4\u65b0 lock \u6587\u4ef6\uff0c\u5c06\u53d8\u66f4\u63d0\u4ea4\u5230 git \u540e\u7ecf\u5e38\u4f1a\u5bfc\u81f4 merge\uff0c\u6240\u4ee5\u6709\u4e9b\u4eba\u4f1a\u628a lock \u6587\u4ef6\u5199\u8fdb.gitignore \u91cc\uff0c**\u4f46\u8fd9\u4e2a\u884c\u4e3a\u662f\u6709\u98ce\u9669\u7684**\\n\\n<img src={require(\\"./assets/stickers/1.jpg\\").default} width=\\"200\\" />\\n\\n#### 2\u3001\u4e3e\u4e2a \ud83c\udf30\uff1a\\n\\n\u4f60\u72ec\u81ea\u8d1f\u8d23\u4e00\u4e2a\u9879\u76ee\uff0c\u5f00\u53d1\u4e86\u51e0\u5e74\uff0c\u9879\u76ee\u7a33\u5b9a\uff0c\u4f9d\u8d56\u4e5f\u4e00\u76f4\u6ca1\u6709\u51fa\u73b0\u95ee\u9898\u3002\u67d0\u5929\u9879\u76ee\u6269\u62db\uff0c\u6765\u4e86\u4e2a\u65b0\u540c\u4e8b\uff0c\u4f60\u5341\u5206\u5f00\u5fc3\uff0c\u5fc3\u60f3\u81ea\u5df1\u53ef\u4ee5\u8f7b\u677e\u4e00\u4e9b\u4e86\uff0c\u4f46\u65b0\u540c\u4e8b\u5728`yarn install`\u540e\uff0c**\u63d0\u793a\u4e86\u597d\u51e0\u4e2a\u8b66\u544a\uff0c\u9879\u76ee\u4e5f\u8dd1\u4e0d\u8d77\u6765**\\n\\n\u518d\u6765\u4e00\u4e2a \ud83c\udf30\uff1a\\n\\n\u4e00\u4e2a\u9879\u76ee\u51e0\u5e74\u6ca1\u52a8\u8fc7\uff0c\u67d0\u5929\u9886\u5bfc\u8981\u6c42\u4f60\u53bb\u5f00\u53d1\u4e2a\u5c0f\u9700\u6c42\u3002\u534a\u5929\u4e0d\u5230\u4f60\u5c31\u641e\u5b9a\u4e86\uff0c\u672c\u5730\u9a8c\u8bc1\u5b8c\u6210\uff0c\u63d0\u4ea4\u4ee3\u7801\u81f3 dev\uff0c\u7b49\u5f85 ci \u7136\u540e\u9a8c\u8bc1\uff0c\u5fc3\u91cc\u6697\u60f3\u53c8\u53ef\u4ee5\u6ed1\u51e0\u5929\u6c34\u3002\u4f46\u4f60\u7a81\u7136\u53d1\u73b0 ci **\u6ca1\u8dd1\u8fc7**\uff08\u53c8\u6216\u8005\u662f**\u6548\u679c\u4e0d\u5bf9**\uff09\\n\\n<img src={require(\\"./assets/stickers/6.png\\").default} width=\\"200\\" />\\n\\n\u95ee\u9898\u5728\u4e8e\u4f9d\u8d56\u7248\u672c\u53d8\u66f4\uff0c\u65b0\u540c\u4e8b\u548c ci \u4e0a\u5b89\u88c5\u7684\u4f9d\u8d56\u4e0e\u4f60\u672c\u5730\u7684\u4f9d\u8d56\u7248\u672c\u4e0d\u540c\uff0c\u5bfc\u81f4\u7ed3\u679c\u6709\u51fa\u5165\\n\\n\u4e0a\u9762\u4f8b\u5b50\u51fa\u73b0\u7684\u53ef\u80fd\u6027\u4f4e\uff0c\u4f46\u8fd9\u4e9b\u95ee\u9898\u662f\u786e\u5b9e\u5b58\u5728\u7684\uff0c\u800c\u4e14\u968f\u7740\u65f6\u95f4\u63a8\u79fb\uff0c\u53ef\u80fd\u6027\u5c31\u8d8a\u5927\uff08\u672c\u4eba\u9047\u5230\u8fc7\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff09\\n\\n#### 3\u3001\u90a3\u4e48\u6211\u4eec\u8be5\u5982\u4f55\u907f\u514d\u8fd9\u4e9b\u95ee\u9898\uff1f\\n\\n\u7b80\u800c\u8a00\u4e4b\uff0c\u4f60\u9700\u8981**\u9501\u6b7b\u4f9d\u8d56\u7248\u672c**\uff0c\u5e76\u4e0d\u662f\u5728 package.json \u91cc\u6307\u5b9a\u4f9d\u8d56\u7248\u672c\uff0c\u800c\u662f\u8ba9**\u4f9d\u8d56\u5b89\u88c5\u65f6\u4ee5 lock \u6587\u4ef6\u4e3a\u4e3b**\\n\\n<img src={require(\\"./assets/stickers/13.jpg\\").default} width=\\"180\\" />\\n\\n\u9996\u5148**\u4fdd\u8bc1 lock \u6587\u4ef6\u63d0\u4ea4\u5230\u8fdc\u7a0b\u4ed3\u5e93**\uff08lock \u6587\u4ef6\u53ea\u80fd\u63d0\u4f9b\u4fe1\u606f\uff0c\u5e76\u6ca1\u6709\u9501\u6b7b\u7248\u672c\u7684\u529f\u80fd\uff09\uff0c\u7136\u540e\u4f60\u9700\u8981\u4f7f\u7528`npm ci`\u548c`yarn install --frozen-lockfile`**\u5b89\u88c5\u4f9d\u8d56**\uff08\u8fd9\u4e9b\u6307\u4ee4\u4f1a\u6839\u636e lock \u6587\u4ef6\u5b89\u88c5\u4f9d\u8d56\uff0c\u5f53 lock \u6587\u4ef6\u4e0d\u5b58\u5728\u6216\u8005 lock \u6587\u4ef6\u4e0e package.json \u6709\u51fa\u5165\u65f6\u4f1a\u629b\u51fa\u9519\u8bef\uff09\\n\\n#### 4\u3001\u7ea6\u675f\uff1a\\n\\n\u4e0a\u9762\u8bf4\u7684\u90fd\u662f\u89c4\u8303\uff0c\u89c4\u8303\u5982\u679c\u4e0d\u88ab\u8ba4\u53ef\u4e0d\u88ab\u51c6\u5b88\uff0c\u90a3\u5c31\u6ca1\u6709\u610f\u4e49\uff0c\u6240\u4ee5\u9700\u8981\u7ea6\u675f\\n\\n1. \u7528 yarn \u8fd8\u662f\u7528 npm\uff1f\\n\\n\u7528\u54ea\u4e2a\u90fd\u53ef\u4ee5\uff0c\u751a\u81f3\u53ef\u4ee5\u4e24\u4e2a\u90fd\u7528\uff0c\u4f46\u9700\u8981\u540c\u65f6\u7ef4\u62a4`package-lock.json`\u4e0e`yarn.lock`\uff0c\u53ef\u4ee5\u4f7f\u7528`yarn import`\u6216[synp](https://github.com/imsnif/synp)\u5c06 lock \u6587\u4ef6\u8fdb\u884c\u8f6c\u6362\uff0c`postinstall` \u91cc\u8bbe\u7f6e\u597d\u8f6c\u6362\u7684\u811a\u672c\\n\\n\u4e0d\u5efa\u8bae\u540c\u65f6\u7ef4\u62a4\u4e24\u79cd\uff0c\u6ca1\u5565\u597d\u5904\uff0c\u53cd\u800c\u589e\u52a0\u9ebb\u70e6\uff0c\u800c\u4e14\u6df7\u5408\u4f7f\u7528\u4f1a\u6709\u8b66\u544a\u63d0\u793a\\n\\n<img src={require(\\"./assets/screenshots/41.png\\").default} width=\\"800\\" />\\n\\n2. \u5982\u4f55\u8ba9\u56e2\u961f\u6210\u5458\u53ea\u7528 yarn \u6216 npm\uff1f\\n\\n\u8fd8\u771f\u6709\uff0c\u53ef\u4ee5\u770b\u4e0b\u8fd9\u4e2a => [Force yarn install instead of npm install for Node module?](https://stackoverflow.com/questions/41076172/force-yarn-install-instead-of-npm-install-for-node-module)\uff0c\u63a8\u8350\u4f7f\u7528[only-allow](https://github.com/pnpm/only-allow)\\n\\n3. \u80fd\u4e0d\u80fd\u8ba9`npm install`\u548c`yarn install`\u9ed8\u8ba4\u9501\u7248\u672c\uff0c\u4e0d\u66f4\u65b0 lock \u6587\u4ef6\uff1f\\n\\n\u6dfb\u52a0`--install.frozen-lockfile true`\u5230`.yarnrc`\uff0c\u53ef\u4ee5\u8ba9`--frozen-lockfile`\u6210\u4e3a`yarn install`\u7684\u9ed8\u8ba4\u53c2\u6570\\n\\n`npm install`\u6ca1\u529e\u6cd5\u505a\u5230 yarn \u90a3\u6837\\n\\n#### 5\u3001\u603b\u7ed3\\n\\n\u6700\u540e\u603b\u7ed3\u4e0b\u6700\u4f73\u5b9e\u8df5\u6d41\u7a0b\uff1a\\n\\n1\u3001\u8bf7**\u52a1\u5fc5\u5c06 lock \u6587\u4ef6\u63d0\u4ea4\u81f3\u8fdc\u7a0b**\uff0c\u4e3a\u4e86\u81ea\u5df1\u4e5f\u4e3a\u4e86\u540e\u9762\u63a5\u624b\u7684\u540c\u4e8b\uff08\u540e\u9762\u540c\u4e8b\u63a5\u624b\u9879\u76ee\u8dd1\u4e0d\u8d77\u6765\uff0c\u7ffb git \u8bb0\u5f55\u4e5f\u6ca1\u6709 lock \u6587\u4ef6\uff0c\u5c31\u4f1a\u5f88\u96be\u53d7\uff09\\n\\n2\u3001\u4ece yarn\u3001npm \u4e2d\u9009\u62e9\u4e00\u4e2a\u4f5c\u4e3a\u5305\u7ba1\u7406\u5668\uff08\u5efa\u8bae yarn\uff09\uff0c\u5e76\u7528[only-allow](https://github.com/pnpm/only-allow)\u8fdb\u884c\u9650\u5236\\n\\n3\u3001\u5982\u679c\u662f yarn\uff0c\u8bf7\u6dfb\u52a0`--install.frozen-lockfile true`\u5230`.yarnrc`\u3002npm \u53ef\u4ee5\u5728\u56e2\u961f\u5185\u7ea6\u5b9a\u7edf\u4e00\u4f7f\u7528`npm ci`\\n\\n4\u3001**\u5b9a\u671f\u5347\u7ea7\u7248\u672c**\uff0c\u65e7\u7248\u672c\u53ef\u80fd\u85cf\u96f7\uff0c\u5b9a\u671f\u5347\u7ea7\u53ef\u4ee5\u5728\u9047\u5230\u4e4b\u524d\u6392\u9664"},{"id":"/2021/09/03/experience_of_build_wechat_miniapp","metadata":{"permalink":"/blog/2021/09/03/experience_of_build_wechat_miniapp","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2021-09-03-experience_of_build_wechat_miniapp.md","source":"@site/blog/2021-09-03-experience_of_build_wechat_miniapp.md","title":"\u5c0f\u7a0b\u5e8f\u5f00\u53d1\u7ecf\u9a8c\u5206\u4eab","description":"\u5c0f\u7a0b\u5e8f\u5f00\u53d1\u7ecf\u9a8c\u5206\u4eab","date":"2021-09-03T00:00:00.000Z","formattedDate":"2021\u5e749\u67083\u65e5","tags":[],"readingTime":6.29,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u5c0f\u7a0b\u5e8f\u5f00\u53d1\u7ecf\u9a8c\u5206\u4eab","authors":"youniaogu","date":"2021-09-03T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u5982\u4f55\u5904\u7406 package-lock.json \u4e0e yarn.lock","permalink":"/blog/2022/03/09/how_to_handle_lock_file"},"nextItem":{"title":"\u66f4\u597d\u7684\u7ebf\u6027\u6e10\u53d8\u80cc\u666f","permalink":"/blog/2021/06/25/better_linear_gradient_background"}},"content":"## \u5c0f\u7a0b\u5e8f\u5f00\u53d1\u7ecf\u9a8c\u5206\u4eab\\n\\n\u8fd9\u91cc\u4e3b\u8981\u662f\u5206\u4eab\u5c0f\u7a0b\u5e8f\u5f00\u53d1\u65f6\u9047\u5230\u7684\u95ee\u9898\uff0c\u4ee5\u53ca\u89e3\u51b3\u65b9\u6848\u3002\\n\\n### 1. \u5c0f\u7a0b\u5e8f\u7684\u7f3a\u70b9\\n\\n#### 1.1 `npm`\u652f\u6301\u4e0d\u5b8c\u5168\\n\\n\u5c0f\u7a0b\u5e8f\u53ea\u652f\u6301\u7eaf js \u5e93\uff0c\u800c\u4e14\u5fc5\u987b\u6709\u4e3b\u5165\u53e3\uff08\u9700\u8981\u6307\u5b9a main\uff09\uff0c[\u76f8\u5173\u6587\u6863](https://developers.weixin.qq.com/miniprogram/dev/devtools/npm.html)\u3002\\n\\n\u53ea\u8981\u7528\u5230 babel \u7f16\u8bd1\u7684\u5e93\uff0c\u90fd\u6ca1\u529e\u6cd5\u76f4\u63a5\u5f15\u5165\u5230\u5c0f\u7a0b\u5e8f\u91cc\uff0c\u5fc5\u987b\u624b\u52a8\u5f15\u5165\u6784\u5efa\u540e\u7684\u5305\u624d\u884c\uff0c\u4f46\u8fd9\u6837\u5c31\u5931\u53bb npm \u7248\u672c\u7ba1\u7406\u7684\u610f\u4e49\u3002\\n\\n#### 1.2 \u7f3a\u5c11\u72b6\u6001\u7ba1\u7406\\n\\n\u8fd9\u91cc\u662f\u6307\u7f3a\u5c11\u7c7b\u4f3c\u4e8e redux\u3001vuex\u3001mobx \u7684\u80fd\u529b\uff0c\u72b6\u6001\u7ba1\u7406\u662f\u5f00\u53d1\u5927\u578b\u9879\u76ee\u5fc5\u4e0d\u53ef\u5c11\u7684\u9700\u6c42\u3002\\n\\n\u5c0f\u7a0b\u5e8f\u7684 [storage](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.getStorage.html) \u4e0e localStorage \u7c7b\u4f3c\uff0c\u6ca1\u6709\u54cd\u5e94\u53d8\u5316\u7684\u80fd\u529b\u3002\\n\\n#### 1.3 \u7f3a\u5c11\u73af\u5883\u53d8\u91cf\\n\\n\u73af\u5883\u53d8\u91cf\u4e3b\u8981\u662f\u7528\u6765\u533a\u5206\u5f00\u53d1\u3001\u6d4b\u8bd5\u3001\u6b63\u5f0f\u8fd9\u4e09\u79cd\uff0c\u4e5f\u53ef\u4ee5\u51b3\u5b9a\u4e00\u4e9b\u5e93\u662f\u5426\u5bfc\u5165\u6216\u4f7f\u7528\u3002\\n\\n\u5c0f\u7a0b\u5e8f\u53ea\u80fd\u533a\u5206\u5f00\u53d1\u7248\u3001\u4f53\u9a8c\u7248\u3001\u6b63\u5f0f\u7248\uff0c\u4f46\u628a\u5b83\u4eec\u5bf9\u6807\u5f00\u53d1\u3001\u6d4b\u8bd5\u3001\u6b63\u5f0f\u4e0d\u592a\u597d\uff0c\u56e0\u4e3a\u6211\u4eec\u53ef\u80fd\u4f1a\u5728\u5f00\u53d1\u8005\u5de5\u5177\u91cc\u8c03\u8bd5\u5f00\u53d1\u3001\u6d4b\u8bd5\u3001\u6b63\u5f0f\u4e09\u79cd\u73af\u5883\u3002\\n\\n#### 1.4 \u4e0d\u4f1a\u5904\u7406`cookies`\\n\\n\u5c0f\u7a0b\u5e8f\u8bf7\u6c42\u65f6\u4e0d\u4f1a\u81ea\u52a8\u5e26\u4e0a cookies\uff0c\u8fd4\u56de\u7684 reponse \u91cc\u867d\u7136\u6709 cookies\uff0c\u4f46\u4e0d\u4f1a\u81ea\u52a8\u50a8\u5b58\u3002\\n\\n#### 1.5 \u5165\u53e3\u5f88\u591a\uff0c\u7f3a\u5c11\u63a7\u5236\u5c42\\n\\n\u5c0f\u7a0b\u5e8f\u542f\u52a8\u65f6\uff0c[App](https://developers.weixin.qq.com/miniprogram/dev/reference/api/App.html) \u7684\u751f\u547d\u5468\u671f\u867d\u7136\u7b2c\u4e00\u4e2a\u6267\u884c\uff0c\u4f46\u5b83\u4e0d\u80fd\u963b\u585e\u5176\u4ed6\u9875\u9762\uff0c\u8fd9\u610f\u5473\u5b83\u4e0d\u80fd\u4f5c\u4e3a\u9879\u76ee\u91cc\u7684\u63a7\u5236\u5c42\uff08\u6bd4\u5982\uff1a\u767b\u5f55\u5b8c\u6210\u524d\u663e\u793a loading\uff0c\u4e0d\u663e\u793a\u9875\u9762\uff09\u3002\\n\\n\u800c\u4e14\u5c0f\u7a0b\u5e8f\u7684\u8def\u7531\u662f\u5e73\u94fa\u5f00\u6765\u7684\uff0c\u5982\u679c\u8981\u505a\u767b\u5f55\u62e6\u622a\uff0c\u6709\u591a\u5c11\u4e2a\u8def\u7531\uff0c\u5c31\u8981\u5199\u591a\u5c11\u4e2a\u62e6\u622a\u3002\\n\\n### 2. \u5982\u4f55\u5e94\u5bf9\\n\\n#### 2.1 \u81ea\u5df1\u6253\u5305\\n\\n\u65e2\u7136\u8981\u4fdd\u7559\u7248\u672c\u7ba1\u7406\uff0c\u53c8\u8981\u6784\u5efa\uff0c\u90a3\u6211\u4eec\u81ea\u5df1\u6253\u5305\u8f93\u51fa\u5230`miniprogram_npm`\u4e0d\u5c31\u53ef\u4ee5\u4e86\u3002\\n\\n\u56e0\u4e3a\u53ea\u7528\u8f93\u51fa\u7eaf js\uff0c\u6240\u4ee5\u6211\u4eec\u9009\u7528 rollup \u6765\u6253\u5305\u3002\\n\\n\u9664\u6b64\u4e4b\u5916\uff0c\u4f7f\u7528`yarn workspaces`\u6765\u7ba1\u7406\u672c\u5730\u4f9d\u8d56\uff08\u8fd9\u91cc\u6211\u4eec\u76f4\u63a5\u6253\u5305\u5230`miniprogram_npm`\uff0c\u8fd9\u70b9\u53ef\u6709\u53ef\u65e0\u3002\u4e3b\u8981\u662f\u65b9\u4fbf\u6307\u4ee4\u63a7\u5236\uff0c\u4ee5\u53ca\u9879\u76ee\u5206\u7c7b\uff09\u3002\\n\\n\u8fd9\u4e00\u6b65\u5341\u5206\u91cd\u8981\uff0c\u662f\u4e0b\u9762\u4e24\u4e2a\u5e94\u5bf9\u7684\u524d\u63d0\uff01\\n\\n#### 2.2 \u5f15\u5165 redux\\n\\n\u5728\u8bb2\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u8981\u77e5\u9053**Component \u662f\u53ef\u4ee5\u4f5c\u4e3a Page \u4f7f\u7528\u7684**\uff0c\u800c\u4e14**Component \u7684\u529f\u80fd\u6bd4 Page \u66f4\u4e3a\u5f3a\u5927**\uff08Page \u5c5e\u4e8e\u9057\u7559\u4ea7\u7269\uff0c\u5f88\u9e21\u808b\uff09\u3002\\n\\n\u5f15\u5165 redux \u5c31\u9700\u8981 connect\uff0c\u5c0f\u7a0b\u5e8f\u6ca1\u6709\u73b0\u6210\uff0c\u6240\u4ee5\u6211\u4eec\u5f97\u81ea\u884c\u5c01\u88c5\u3002\u6709\u4e24\u79cd\u601d\u8def\uff0c\u4e00\u4e2a\u662f[behaviors](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Behavior.html)\uff0c\u53e6\u4e00\u4e2a\u662f[Component](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/component.html)\uff0c\u539f\u7406\u90fd\u662f\u52ab\u6301\u751f\u547d\u5468\u671f\uff0c\u6ce8\u5165 redux \u8ba2\u9605\u4e8b\u4ef6\u3002\\n\\n<img src={require(\\"./assets/screenshots/37.png\\").default} width=\\"800\\" />\\n\\n\u56e0\u4e3a\u6211\u4eec\u7528\u5230[redux-saga](https://redux-saga.js.org/docs/introduction/GettingStarted)\u505a\u5f02\u6b65\u5904\u7406\uff0c\u91cc\u9762\u5e26\u6709`generator function`\uff0c\u6240\u4ee5\u6253\u5305\u65f6\u9700\u8981\u5f15\u5165`@babel/plugin-transform-runtime`\u3002\\n\\n> babel7 \u91cc\u7684`@babel/env`\u53ea\u63d0\u4f9b\u8bed\u6cd5\u652f\u6301\uff0capi \u5219\u662f\u7531`runtime`\u63d0\u4f9b\\n\\n\u6ce8\u610f\uff1aredux \u91cc\u6709\u4f7f\u7528\u5230`process.env.NODE_ENV`\u73af\u5883\u53d8\u91cf\uff0c\u8fd9\u4e2a\u5728\u4e0b\u9762\u4f1a\u4e00\u5e76\u89e3\u51b3\u3002\\n\\n#### 2.3 \u81ea\u5b9a\u4e49\u73af\u5883\u53d8\u91cf\\n\\n\u6253\u5305\u811a\u672c\u4e0a\u6302\u8f7d\u73af\u5883\u53d8\u91cf\uff0crollup \u6253\u5305\u4e2d\u7edf\u4e00\u66ff\u6362\u3002\\n\\n```javascript\\n//package.json\\n\\"scripts\\": {\\n  \\"start\\": \\"RUNNER_ENV=dev runner-scripts\\",\\n  \\"build\\": \\"RUNNER_ENV=prod runner-scripts\\"\\n},\\n\\n//rollup.config.js\\nreplace({\\n  \'process.env.NODE_ENV\': JSON.stringify(env),\\n  preventAssignment: true,\\n}),\\n```\\n\\n\u63a5\u4e0b\u6765\u662f\u73af\u5883\u533a\u5206\uff0c\u5efa\u8bae\u6253\u5305\u73af\u5883\u4e0e[wx.getAccountInfoSync](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/account-info/wx.getAccountInfoSync.html)\u7ed3\u5408\u4f7f\u7528\uff0c\u4e0b\u9762\u662f\u6211\u9879\u76ee\u91cc\u7684\u73af\u5883\u533a\u5206\u3002\\n\\n<img src={require(\\"./assets/screenshots/36.png\\").default} width=\\"400\\" />\\n\\n\u8fd9\u6837\u5199\u7684\u597d\u5904\u6709\u4e24\u70b9\uff1a\\n\\n- \u914d\u7f6e\u7075\u6d3b\uff0c\u672c\u5730\u53ef\u4ee5\u8c03\u8bd5\u4efb\u610f\u73af\u5883\\n- \u53ef\u4ee5\u4f7f\u7528\u6d4b\u8bd5\u73af\u5883\u63d0\u5ba1\uff0c\u53d1\u5e03\u540e\u81ea\u52a8\u8f6c\u53d8\u6210\u6b63\u5f0f\u73af\u5883\uff0c\u80fd\u4e0e\u540e\u7aef\u540c\u65f6\u4e0a\u7ebf\\n\\n#### 2.4 \u5c01\u88c5\u8bf7\u6c42\\n\\n\u8fd9\u4e2a\u597d\u8bf4\uff0c\u5c0f\u7a0b\u5e8f storage \u53ef\u4ee5\u6301\u7eed\u5316\u50a8\u5b58\uff0c\u4ece response \u7684 header \u91cc\u53d6\u51fa`Set-Cookie`\uff0c\u518d\u653e\u8fdb storage \u91cc\u8fd9\u6837\u5c31\u5b9e\u73b0 cookies \u7684\u5b58\u50a8\u3002\\n\\n\u5728\u8bf7\u6c42\u4e4b\u524d\uff0c\u4ece storage \u83b7\u53d6 cookies\uff0c\u5e76\u5e26\u5728 header \u7684 Cookies \u4e0a\u5373\u53ef\u3002\\n\\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6b63\u5e38 cookies \u4f1a\u6709**\u8fc7\u671f\u65f6\u95f4**\uff0c\u5b58\u50a8\u65f6\u9700\u8981\u628a expires \u548c max-age \u4e00\u8d77\u5b58\u8fdb\u53bb\uff0c\u83b7\u53d6\u65f6\u6821\u9a8c cookies \u662f\u5426\u8fc7\u671f\u3002\\n\\n#### 2.5 \u7ef4\u6301\u751f\u547d\u5468\u671f\\n\\n\u5173\u4e8e\u63a7\u5236\u5c42\u65b9\u9762\uff0c\u5c0f\u7a0b\u5e8f\u6ca1\u6709\u89e3\u51b3\u65b9\u6848\uff0c\u53ea\u80fd\u5728\u9700\u8981\u63a7\u5236\u7684\u9875\u9762\u4e0a\u589e\u52a0\u63a7\u5236\u7684\u903b\u8f91\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e00\u5c42\u62bd\u8c61\u51fa\u6765\uff0c\u51cf\u5c11\u91cd\u590d\u4ee3\u7801\u3002\\n\\n\u601d\u8def\uff1a\u7ec4\u4ef6 Layout \u63a7\u5236\u9875\u9762\u662f\u5426\u6e32\u67d3\uff0chold\uff08\u4e00\u4e2a Behavior\uff09\u901a\u8fc7\u52ab\u6301\u9875\u9762\u6765\u7ef4\u6301\u751f\u547d\u5468\u671f\uff0c\u76f4\u5230 Layout \u53d1\u51fa\u901a\u884c\u7684\u4fe1\u53f7\u624d\u6267\u884c\u3002\u901a\u8fc7\u63a7\u5236\u751f\u547d\u5468\u671f\u548c\u9875\u9762\u6e32\u67d3\uff0c\u8fbe\u5230\u63a7\u5236\u9875\u9762\u7684\u6548\u679c\uff0c\u540c\u65f6\u7ec4\u4ef6\u4e0e Behavior \u90fd\u80fd\u590d\u7528\uff0c\u51cf\u5c11\u91cd\u590d\u7387\u3002\\n\\n<img src={require(\\"./assets/screenshots/38.png\\").default} width=\\"800\\" />\\n\\nBUG\uff1a\u5f00\u53d1\u65f6\u53d1\u73b0\u9875\u9762\u5185\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u65e0\u6cd5\u7ef4\u6301\uff0c\u9700\u8981\u589e\u52a0`wx:if=\\"{{!HOLDING}}\\"`\\n\\n<img src={require(\\"./assets/screenshots/39.png\\").default} width=\\"400\\" />\\n\\n### 3. \u6700\u540e\\n\\n#### 3.1 \u5173\u4e8e eslint\\n\\n<img src={require(\\"./assets/screenshots/40.png\\").default} width=\\"400\\" />\\n\\n\u5982\u679c\u4f7f\u7528 eslint\uff0c\u8bf7\u6307\u5b9a\u4f7f\u7528\u5230\u7684\u5fae\u4fe1 api\uff0c\u56e0\u4e3a\u7f16\u8f91\u5668\u4e0d\u77e5\u9053\u5fae\u4fe1\u7684\u5168\u5c40 api \u6709\u90a3\u4e9b\uff0c\u4f1a\u76f4\u63a5\u62a5\u9519\u3002\\n\\n#### 3.2 canvas \u7ed8\u5236\\n\\n\u5982\u679c\u624b\u52a8\u7ed8\u5236\u6d77\u62a5\uff0c\u6ce8\u610f\u5c06\u6587\u6848\u7684\u5bf9\u9f50\u65b9\u5f0f\uff08textBaseline\uff09\u8bbe\u7f6e\u4e3a middle\uff0cy \u8f74\u5b9a\u4f4d\u52a0\u4e0a\u4e00\u534a\u884c\u9ad8\u5373\u53ef\\n\\n#### 3.3 js \u652f\u6301\\n\\n\u5728\u5f00\u53d1\u524d\u6700\u597d\u770b\u4e0b[JavaScript \u652f\u6301\u60c5\u51b5](https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/js-support.html)\\n\\n\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5176\u4e2d\u5c0f\u7a0b\u5e8f\u7981\u7528`eval`\u548c`new Function`\uff0c`@babel/plugin-transform-runtime`\u5728\u7f16\u8bd1\u540e\u4f1a\u6709 Function \u4ee3\u7801\u5bfc\u81f4\u62a5\u9519\uff0c\u8be6\u7ec6\u89c1[issues](https://github.com/facebook/regenerator/issues/378)"},{"id":"/2021/06/25/better_linear_gradient_background","metadata":{"permalink":"/blog/2021/06/25/better_linear_gradient_background","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2021-06-25-better_linear_gradient_background.md","source":"@site/blog/2021-06-25-better_linear_gradient_background.md","title":"\u66f4\u597d\u7684\u7ebf\u6027\u6e10\u53d8\u80cc\u666f","description":"\u66f4\u597d\u7684\u7ebf\u6027\u6e10\u53d8\u80cc\u666f","date":"2021-06-25T00:00:00.000Z","formattedDate":"2021\u5e746\u670825\u65e5","tags":[],"readingTime":0.42,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u66f4\u597d\u7684\u7ebf\u6027\u6e10\u53d8\u80cc\u666f","authors":"youniaogu","date":"2021-06-25T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u5c0f\u7a0b\u5e8f\u5f00\u53d1\u7ecf\u9a8c\u5206\u4eab","permalink":"/blog/2021/09/03/experience_of_build_wechat_miniapp"},"nextItem":{"title":"\u4ec0\u4e48\u662f redux-toolkit","permalink":"/blog/2021/02/18/what_is_redux-toolkit"}},"content":"### \u66f4\u597d\u7684\u7ebf\u6027\u6e10\u53d8\u80cc\u666f\\n\\n\u505a\u6e10\u53d8\u80cc\u666f\uff0c\u6bd4\u5982\u8fdb\u5ea6\u6761\u65f6\uff0c\u53ea\u8981\u628a**\u80cc\u666f\u7684\u5bbd\u5ea6\u6491\u6ee1\u5916\u90e8\u5bb9\u5668**\uff0c\u5c31\u80fd\u83b7\u5f97\u66f4\u597d\u770b\u7684\u6548\u679c\\n\\n```css\\n.inside {\\n  width: 30%;\\n  height: 16px;\\n  border-radius: 8px;\\n  background: linear-gradient(to right, #ff3737, #3939ff);\\n  background-size: 333.33%; //\u6839\u636ewidth\u52a8\u6001\u8ba1\u7b97\u51fa\u5927\u5c0f\\n}\\n```\\n\\n##### \u6548\u679c\u56fe\uff1a\\n\\n<img src={require(\\"./assets/screenshots/35.gif\\").default} width=\\"720\\" />\\n\\n\u7ebf\u4e0a\u5730\u5740\uff1a[https://youniaogu.github.io/react-demo/component](https://youniaogu.github.io/react-demo/component)"},{"id":"/2021/02/18/what_is_redux-toolkit","metadata":{"permalink":"/blog/2021/02/18/what_is_redux-toolkit","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2021-02-18-what_is_redux-toolkit.md","source":"@site/blog/2021-02-18-what_is_redux-toolkit.md","title":"\u4ec0\u4e48\u662f redux-toolkit","description":"\u4ec0\u4e48\u662f redux-toolkit","date":"2021-02-18T00:00:00.000Z","formattedDate":"2021\u5e742\u670818\u65e5","tags":[],"readingTime":5.8,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u4ec0\u4e48\u662f redux-toolkit","authors":"youniaogu","date":"2021-02-18T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u66f4\u597d\u7684\u7ebf\u6027\u6e10\u53d8\u80cc\u666f","permalink":"/blog/2021/06/25/better_linear_gradient_background"},"nextItem":{"title":"\u901a\u8fc7 babel \u770b class","permalink":"/blog/2020/12/21/learn_about_class_through_babel"}},"content":"### \u4ec0\u4e48\u662f redux-toolkit\\n\\n#### 1. \u4ecb\u7ecd\\n\\nredux-toolkit \u4e0b\u9762\u7b80\u79f0\u4e3a rtk\uff0c\u662f\u4e00\u4e2a\u7ed3\u5408 redux \u5de5\u5177\u548c\u8bed\u6cd5\u7cd6\u7684\u5e93\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u89e3\u51b3\u4e09\u4e2a\u95ee\u9898\\n\\n- redux \u914d\u7f6e\u590d\u6742\uff08\u4e00\u822c \ud83e\udd14\uff09\\n- redux \u9700\u8981\u6dfb\u52a0\u4e00\u4e9b\u5e93\u914d\u5408\u4f7f\u7528\uff08\u4e00\u822c \ud83e\udd14\uff09\\n- **redux \u6a21\u7248\u4ee3\u7801\u8fc7\u591a\uff08\u91cd\u70b9 \ud83d\udcaa\uff09**\\n\\n#### 2. createAction\u3001createReducer\\n\\n> 2\u30013\u30014 \u4e3b\u8981\u662f API \u7684\u7b80\u5355\u4ecb\u7ecd\uff0c\u8be6\u7ec6\u89c1[\u5b98\u7f51\u6587\u6863](https://redux-toolkit.js.org/introduction/getting-started)\uff0c\u8fd8\u6709\u4e0e\u666e\u901a redux \u4f7f\u7528\u7684\u6bd4\u8f83\\n\\n`createAction`\u7c7b\u4f3c\u4e8e`actionCreater`\u7684\u5f62\u5f0f\uff0c\u4e24\u8005\u5728\u4f20\u53c2\u548c\u8fd4\u56de\u4e0a\u6709\u4e9b\u4e0d\u540c\\n\\n```javascript\\nimport { createAction } from \'@reduxjs/toolkit\';\\n\\n// \u4f7f\u7528createAction\\nconst loadUserInfo = createAction<string>(\'user/loadUserInfo\');\\n// \u6216\u8005\\nconst loadUserInfo = createAction(\'user/loadUserInfo\', function prepare(id: string) {\\n  return {\\n    payload: {\\n      id,\\n    },\\n  }\\n});\\n\\n// \u57fa\u4e8eactionCreater\\nfunction loadUserInfo(id: string) {\\n  return {\\n    type: \'LOAD_USER_INFO\'\\n    id\\n  }\\n}\\n```\\n\\n`createReducer`\u7528\u6765\u7b80\u5316\u521b\u5efa reducer \u7684\u51fd\u6570\uff0c\u5185\u90e8\u4f7f\u7528**[immer](https://github.com/immerjs/immer)**\u5927\u5927\u7b80\u5316\u4e86\u6570\u636e\u53d8\u66f4\u7684\u64cd\u4f5c\\n\\n```javascript\\n// \u6b63\u5e38\u7684userReducer\\nconst initialUserState = {\\n  name: \\"\u5c0f\u660e\\",\\n  age: 18,\\n  sex: 1,\\n};\\nfunction userReducer(state = initialUserState, action) {\\n  switch (action.type) {\\n    case \\"SET_NAME\\": {\\n      return {\\n        ...state,\\n        name: action.name,\\n      };\\n    }\\n    case \\"SET_AGE\\": {\\n      return {\\n        ...state,\\n        age: action.age,\\n      };\\n    }\\n    case \\"SET_SEX\\": {\\n      return {\\n        ...state,\\n        sex: action.sex,\\n      };\\n    }\\n    default:\\n      return state;\\n  }\\n}\\n\\n// \u57fa\u4e8e`createReducer`\u7b80\u5316\u540e\u7684`userReducer`\\nconst initialUserState = {\\n  name: \\"\u5c0f\u660e\\",\\n  age: 18,\\n  sex: 1,\\n};\\nconst userReducer = createReducer(initialUserState, (builder) => {\\n  builder\\n    .addCase(\\"SET_NAME\\", (state, action) => {\\n      // \u65e0\u9700\u8fd4\u56de\u65b0\u7684\u5bf9\u8c61\uff0c\u76f4\u63a5\u5bf9state\u8fdb\u884c\u64cd\u4f5c\u5373\u53ef\\n      state.name = action.payload;\\n    })\\n    .addCase(\\"SET_AGE\\", (state, action) => {\\n      state.age = action.payload;\\n    })\\n    .addCase(\\"SET_SEX\\", (state, action) => {\\n      state.sex = action.payload;\\n    });\\n});\\n```\\n\\n#### 3. createSlice\\n\\n`createSlice`\u662f\u7531`createAction`\u548c`createReducer`\u7ec4\u5408\u800c\u6210\uff0c\u66f4\u8fdb\u4e00\u6b65\u7b80\u5316\u6a21\u7248\u4ee3\u7801\\n\\n\u8bed\u6cd5\uff1a\\n\\n```javascript\\nfunction createSlice({\\n    // \u4f1a\u6dfb\u52a0\u5728action type\u7684\u524d\u9762\uff0c[name]/[action type]\\n    // \u4f8b\u5982\uff1auser/GET_USER_INFO\\n    name: string,\\n    // reducer\u7684\u521d\u59cb\u503c\\n    initialState: any,\\n    // \u5728\u8fd9\u91cc\u901a\u8fc7object\uff08key-value\uff09\u5f62\u5f0f\u5b9a\u4e49\u4f60\u9700\u8981\u7684action\u548creducer\\n    // key\u4e5f\u5c31\u662faction\u7684\u540d\u79f0\uff0c\u53ea\u80fd\u4ee5string\u7684\u5f62\u5f0f\u5b9a\u4e49\\n    // value\u6709\u4e24\u79cd\u5f62\u5f0f\uff1a\\n    // (state, action) => {} //\u5bf9state\u8fdb\u884c\u64cd\u4f5c\\n    // \u6216\u8005\\n    // {\\n    //   reducer: (state, action) => {},\\n    //   prepare: (...args) => { return { payload: any} }\\n    // }\\n    // prepare\u4e3b\u8981\u5728\u6267\u884creducer\u51fd\u6570\u524d\u5bf9action\u4f20\u53c2\u8fdb\u884c\u4fee\u6539\\n    // \u5982\u679c\u4e0d\u5b9a\u4e49prepare\uff0c\u5c06\u4f1a\u9ed8\u8ba4\u628a\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f5c\u4e3apayload\u4f20\u8fdb\u53bb\\n    reducers: Object<string, ReducerFunction | ReducerAndPrepareObject>\\n    // extraReducers\u7528\u6765\u6355\u6293\u6307\u5b9a\u7684action\uff0c\u5e76\u505a\u51fa\u76f8\u5e94\u52a8\u4f5c\\n    // \u81ea\u8eab\u7684action\u65e0\u6cd5\u6355\u6293\\n    // \u53ef\u4ee5\u81ea\u5b9a\u4e49\u6355\u6293\u6761\u4ef6\\n    // \u5982\u4f55\u5b9a\u4e49\uff1a\\n    // \u7c7b\u4f3c\u4e0ereducers\u7684object\uff08key-value\uff09\u5f62\u5f0f\uff0ckey\u5b9a\u4e49\u6355\u6293\u7684action\uff0cvalue\u8868\u793a\u6355\u6293\u6210\u529f\u540e\u7684\u76f8\u5e94\u52a8\u4f5c\\n    // \u901a\u8fc7builder\u7684addCase\u3001addMatcher\u3001addDefaultCase\u8fdb\u884c\u5b9a\u4e49\\n    extraReducers?:\\n    | Object<string, ReducerFunction>\\n    | ((builder: ActionReducerMapBuilder<State>) => void)\\n});\\n```\\n\\n\u4e3e\u4e2a \ud83c\udf30\uff1a\\n\\n```javascript\\nfunction timeout(ms: number) {\\n  return new Promise((resolve) => setTimeout(resolve, ms));\\n}\\nconst getUserInfo = createAsyncThunk<{name: string; sex: 1 | 0 | -1; age: number;}>(\\n  \\"user/getUserInfo\\",\\n  async (payload, thunkApi) => {\\n    await timeout(1000); // \u8bf7\u6c42\u63a5\u53e3\\n    return { name: \\"\u5c0f\u660e\\", sex: 0, age: 24 }; // \u8fd4\u56de\u7ed3\u679c\\n  }\\n);\\nconst loadOrderList = createAsyncThunk<{list: Array<{orderId: number, price: number}>, page: number, total: number}>(\\n  \\"order/loadOrderList\\",\\n  async (payload, thunkApi) => {\\n    await timeout(2000); // \u8bf7\u6c42\u63a5\u53e3\\n    return {\\n      list: [\\n        {orderId: 1, price: 500},\\n        {orderId: 2, price: 1300},\\n        {orderId: 3, price: 900}\\n      ],\\n      page: 1,\\n      total: 3\\n    }; // \u8fd4\u56de\u7ed3\u679c\\n  }\\n);\\nconst userSlice = createSlice({\\n  name: \'user\',\\n  initialState: {\\n    loadStatus: 0,\\n    name: \'\',\\n    sex: -1,\\n    age: 0,\\n  },\\n  reducers: {\\n    \'getUserInfo/pending\': (state) => {\\n      state.loadStatus === 1\\n    },\\n    \'getUserInfo/fulfilled\': (state, action) => {\\n      const { name, sex, age } = action.payload;\\n      state.loadStatus === 2\\n      state.name = name;\\n      state.sex = sex;\\n      state.age = age;\\n    },\\n    \'getUserInfo/rejected\': (state) => {\\n      state.loadStatus === 0\\n    },\\n  },\\n  extraReducers: (builder) => {\\n    builder.addCase(loadOrderList.pending, (state, action) => {\\n        //...\\n      }).addCase(loadOrderList.fulfilled, (state, action) => {\\n        //...\\n      }).addCase(loadOrderList.rejected, (state, action) => {\\n        //...\\n      })\\n  }\\n});\\n```\\n\\n#### 4. createAsyncThunk\\n\\n`createAsyncThunk`\u662f\u57fa\u4e8e`redux-thunk`\u5c01\u88c5\u7684 api\uff0c\u7528\u6765\u5904\u7406\u5f02\u6b65\u903b\u8f91\uff0c\u521b\u5efa\u51fa\u6765\u7684`type`\u6709\u4e09\u79cd\u72b6\u6001\\n\\n\u4f8b\u5982\u5b9a\u4e49\u7684 type \u4e3a`user/getUserInfo`\uff1a\\n\\n| status    | type                       |\\n| --------- | -------------------------- |\\n| pending   | user/getUserInfo/pending   |\\n| fulfilled | user/getUserInfo/fulfilled |\\n| rejected  | user/getUserInfo/rejected  |\\n\\n1. \u5728\u89e6\u53d1`action`\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u8fdb\u5165**pending**\u72b6\u6001\\n\\n2. \u6b63\u5e38`return`\u4f1a\u8fdb\u5165**fulfilled**\u72b6\u6001\\n\\n3. \u800c\u4f7f\u7528`thunkAPI.rejectWithValue`\u8fd4\u56de\u5219\u4f1a\u8fdb\u5165**rejected**\u72b6\u6001\uff08[\u76f8\u5173 api](https://redux-toolkit-cn.netlify.app/api/createAsyncThunk#payloadcreator)\uff09\\n\\n<img src={require(\\"./assets/screenshots/34.png\\").default} width=\\"700\\" alt=\\"34.png\\" />\\n\\n#### 5\u3001createEntityAdapter\\n\\n`createEntityAdapter`\u53ef\u4ee5\u7406\u89e3\u4e3a\u5c01\u88c5 CRUD\uff08\u589e\u5220\u67e5\u6539\uff09\u540e\u7684`reducer`\u4e0e`selector`\u51fd\u6570\\n\\n\u719f\u7ec3\u638c\u63e1\u540e\u53ef\u4ee5\u52a0\u5feb\u5217\u8868\u3001\u5b57\u5178\u7b49\u4e1a\u52a1\u903b\u8f91\u7684\u5f00\u53d1\u901f\u5ea6\uff0c\u4e0d\u5f3a\u5236\u8981\u6c42\u5b66\u4e60\\n\\n\u5c01\u88c5\u7a0b\u5ea6\u8f83\u9ad8\uff0c\u5efa\u8bae\u67e5\u9605[\u76f8\u5173 API \u6587\u6863](https://redux-toolkit-cn.netlify.app/api/createEntityAdapter)\u5b66\u4e60\\n\\n#### 6\u3001\u5b9e\u8df5 QA\\n\\n\u56e0\u4e3a\u4e00\u4e9b\u539f\u56e0\uff0c\u6ca1\u80fd\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\u5b9e\u8df5\u8fd0\u7528\uff0c\u4f46\u6211\u5199\u4e86\u4e24\u4e2a codesandbox\uff0c\u5b83\u4eec\u5b9e\u73b0\u4e86\u76f8\u540c\u7684\u529f\u80fd\uff0c\u53ef\u4ee5\u5bf9\u6bd4\u4e00\u4e0b\u5dee\u5f02\\n\\n- [redux-toolkit](https://codesandbox.io/s/example-rtk-sdnjk)\\n- [redux](https://codesandbox.io/s/example-redux-9x9wm)\\n\\n#### 7\u3001\u603b\u7ed3\\n\\n##### \u4f18\u70b9\uff1a\\n\\n- \u4f7f\u7528`slice`\u4ee3\u66ff`action\u3001reducer`\uff0c\u51cf\u5c11\u6587\u4ef6**\u788e\u7247\u5316**\\n- \u4f7f\u7528`immer`\uff0c\u5927\u5927**\u7b80\u5316**`state`\u7684\u64cd\u4f5c\\n- \u5bf9\u4e8e\u6570\u636e\u64cd\u4f5c\u9891\u7e41\u7684\u9879\u76ee\u6765\u8bf4\uff0c**\u719f\u7ec3\u638c\u63e1**`createEntityAdapter`\u540e\u53ef\u4ee5**\u63d0\u9ad8\u4e1a\u52a1\u903b\u8f91\u5f00\u53d1\u901f\u5ea6**\\n\\n##### \u4f18\u70b9\uff1a\\n\\n- \u5b58\u5728**\u5b66\u4e60\u6210\u672c**\uff0c\u5373\u4f7f\u719f\u7ec3\u8fd0\u7528`redux`\uff0c\u4e5f\u9700\u8981\u4e00\u5b9a\u65f6\u95f4\u4e0a\u624b\\n- `slice`\u590d\u6742\u5ea6\u6bd4`action\u3001reducer`\u9ad8\\n\\n##### \u5982\u679c\u8bf4`redux`\u662f\u6700\u539f\u59cb\u7684\u52a0\u51cf\u6cd5\uff0c\u90a3`rtk`\u5c31\u662f\u4e58\u9664\u6cd5\uff0c\u5b83\u80fd\u5e26\u6765\u7684\u6536\u76ca\u662f\u8fdc\u8fdc\u5927\u4e8e\u4ed8\u51fa\u7684"},{"id":"/2020/12/21/learn_about_class_through_babel","metadata":{"permalink":"/blog/2020/12/21/learn_about_class_through_babel","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-12-21-learn_about_class_through_babel.md","source":"@site/blog/2020-12-21-learn_about_class_through_babel.md","title":"\u901a\u8fc7 babel \u770b class","description":"\u901a\u8fc7 babel \u770b class","date":"2020-12-21T00:00:00.000Z","formattedDate":"2020\u5e7412\u670821\u65e5","tags":[],"readingTime":3.065,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u901a\u8fc7 babel \u770b class","authors":"youniaogu","date":"2020-12-21T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u4ec0\u4e48\u662f redux-toolkit","permalink":"/blog/2021/02/18/what_is_redux-toolkit"},"nextItem":{"title":"\u8bb0\u4e00\u4e2a react \u95ee\u9898","permalink":"/blog/2020/11/16/record_a_question_of_react"}},"content":"### \u901a\u8fc7 babel \u770b class\\n\\n#### 1. \u524d\u8a00\\n\\n\u6700\u8fd1\u5728\u5199\u5355\u5143\u6d4b\u8bd5\uff0c\u5728\u4f7f\u7528`jest.spyOn`\u6d4b\u8bd5\u751f\u547d\u5468\u671f\u65b9\u6cd5\u548c\u51fd\u6570\u65f6\uff0c\u53d1\u73b0\u7bad\u5934\u51fd\u6570\u65e0\u6cd5\u4f7f\u7528\u4e0b\u5217\u4ee3\u7801\u8fdb\u884c\u6d4b\u8bd5\\n\\n```javascript\\n//Error: Cannot spy the handleCardClick property because it is not a function; undefined given instead\\nconst handleCardClick = jest.spyOn(App.prototype, \\"handleCardClick\\");\\nconst wrapper = shallow(<App />);\\n```\\n\\n\u62a5\u9519\u63d0\u793a\u8bf4\u660e`App.prototype.handleCardClick`\u4e3a`undefined`\uff0c\u8fd9\u5c31\u6709\u610f\u601d\u4e86\\n\\n#### 2. \u7f16\u8bd1\u7b80\u5316\\n\\n\u901a\u8fc7[babel tranfer online](https://babeljs.io/repl/#?browsers=&build=&builtIns=false&spec=false&loose=false&code_lz=FBA&debug=false&forceAllTransforms=false&shippedProposals=false&circleciRepo=&evaluate=true&fileSize=false&timeTravel=false&sourceType=module&lineWrap=false&presets=es2015%2Creact%2Cstage-2&prettier=false&targets=&version=7.12.9&externalPlugins=)\u7f16\u8bd1\uff0c\u53d1\u73b0\u7bad\u5934\u51fd\u6570\u4e0e\u666e\u901a\u51fd\u6570\u5904\u7406\u6709\u70b9\u4e0d\u540c\\n\\n> \u4e3a\u4e86\u6613\u4e8e\u7406\u89e3\uff0c\u4ee5\u4e0b\u7f16\u8bd1\u540e\u4ee3\u7801\u7ecf\u8fc7\u7b80\u5316\uff0c\u5982\u679c\u5bf9\u975e\u7b80\u5316\u90e8\u5206\u611f\u5174\u8da3\uff0c\u5efa\u8bae\u81ea\u884c\u7f16\u8bd1\u67e5\u770b\\n\\n```javascript\\nclass App {\\n  fn() {}\\n  handleCardClick = () => {};\\n}\\n```\\n\\n\u2193\u2193\u2193 \u76f8\u5f53\u4e8e \u2193\u2193\u2193\\n\\n```javascript\\nfunction App() {\\n  this.handleCardClick = function () {};\\n}\\nApp.prototype.fn = function () {};\\n```\\n\\n\u53ef\u4ee5\u770b\u5230\uff0c\u51fd\u6570`fn`\u7ed1\u5b9a\u5728`App.prototype`\u4e0a\uff0c\u800c\u7bad\u5934\u51fd\u6570`handleCardClick`\u7ed1\u5b9a\u5728`App`\u7684\u5b9e\u4f8b\u4e0a\\n\\n\u95ee\u9898\u89e3\u51b3\u4e86\uff0c\u4f46\u79c9\u6301\u7740\u5b66\u4e60\u7684\u5fc3\u6001\uff0c\u6211\u628a`class`\u91cc\u5927\u90e8\u5206\u5b9a\u4e49\u53d8\u91cf\u548c\u51fd\u6570\u7684\u60c5\u51b5\u90fd\u5217\u4e3e\u4e86\u51fa\u6765\\n\\n```javascript\\nclass App {\\n  v1 = \\"v1\\";\\n  static v2 = \\"v2\\";\\n  constructor() {\\n    this.v1 = \\"fake v1\\";\\n    this.v2 = \\"fake v2\\";\\n    this.v3 = \\"v3\\";\\n  }\\n\\n  fn1() {}\\n  fn2 = () => {};\\n  static fn3() {}\\n  static fn4 = () => {};\\n}\\n```\\n\\n\u2193\u2193\u2193 \u76f8\u5f53\u4e8e \u2193\u2193\u2193\\n\\n```javascript\\nfunction App() {\\n  this.v1 = \\"v1\\";\\n\\n  this.v1 = \\"fake v1\\";\\n  this.v2 = \\"fake v2\\";\\n  this.v3 = \\"v3\\";\\n\\n  this.fn2 = function () {};\\n}\\nApp.prototype.fn1 = function () {};\\nApp.fn3 = function () {};\\nApp.v2 = \\"v2\\";\\nApp.fn4 = function () {};\\n```\\n\\n\u6709\u4e00\u70b9\u9700\u8981\u6ce8\u610f\uff0c`constructor`\u5728`class`\u91cc\u5b9a\u4e49\u7684\u4e0a\u4e0b\u4f4d\u7f6e\u5bf9\u7f16\u8bd1\u7ed3\u679c\u65e0\u5f71\u54cd\\n\\n```javascript\\nclass App {\\n  v1 = \\"v1\\";\\n  constructor() {\\n    this.v1 = \\"fake v1\\";\\n  }\\n}\\n\\nclass App {\\n  constructor() {\\n    this.v1 = \\"fake v1\\";\\n  }\\n  v1 = \\"v1\\";\\n}\\n```\\n\\n\u4e0a\u9762\u4e24\u4e2a\u7c7b\u7f16\u8bd1\u540e\u7ed3\u679c\u4e00\u81f4\\n\\n```javascript\\nfunction App() {\\n  this.v1 = \\"v1\\";\\n\\n  this.v1 = \\"fake v1\\";\\n}\\n```\\n\\n\u603b\u7ed3\uff1a\\n\\n- \u5177\u6709 static \u5c5e\u6027\u7684\u53d8\u91cf\u548c\u51fd\u6570\u4f1a\u76f4\u63a5\u5b9a\u4e49\u5728\u6784\u9020\u51fd\u6570\u4e0a\uff0c\u4f18\u5148\u7ea7\u6700\u9ad8\\n- \u7bad\u5934\u51fd\u6570\u5728\u6784\u9020\u51fd\u6570\u5185\uff0c\u4f1a\u5b9a\u4e49\u5728\u5b9e\u4f8b\u4e0a\u9762\\n- constructor \u7684\u5b9a\u4e49\u4f1a\u8986\u76d6\u7c7b\u4e0a\u7684\u5b9a\u4e49\\n\\n#### 3. \u7ee7\u627f\\n\\n\u6700\u540e\u518d\u7814\u7a76\u4e0b\u7ee7\u627f\u4ee5\u53ca`super`\u7f16\u8bd1\u540e\u7684\u7ed3\u679c\\n\\n```javascript\\nclass A {}\\nclass B extends A {}\\n```\\n\\n```javascript\\nvar A = function A() {};\\n\\nvar B = (function B(_A) {\\n  //super\u76f8\u5f53\u4e8enew\u5173\u952e\u5b57\\n  var super = function () {\\n    var Super = _B.__proto__;\\n    var result = Super.apply(this, arguments);\\n\\n    if (\\n      result &&\\n      (_typeof(result) === \\"object\\" || typeof result === \\"function\\")\\n    ) {\\n      return result;\\n    }\\n    return this;\\n  };\\n\\n  function _B() {\\n    //\u76f8\u5f53\u4e8enew B(...arguments)\\n    return super.apply(this, arguments);\\n  }\\n\\n  //\u7ee7\u627f_A\u7684prototype\uff0c\u5e76\u5c06\u539f\u578b\u6307\u5411_A\\n  _B.prototype = {\\n    ..._A.prototype,\\n    constructor: _B,\\n  };\\n  _B.__proto__ = _A;\\n\\n  return _B;\\n})(A);\\n```"},{"id":"/2020/11/16/record_a_question_of_react","metadata":{"permalink":"/blog/2020/11/16/record_a_question_of_react","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-11-16-record_a_question_of_react.md","source":"@site/blog/2020-11-16-record_a_question_of_react.md","title":"\u8bb0\u4e00\u4e2a react \u95ee\u9898","description":"\u8bb0\u4e00\u4e2a react \u95ee\u9898","date":"2020-11-16T00:00:00.000Z","formattedDate":"2020\u5e7411\u670816\u65e5","tags":[],"readingTime":1.77,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u8bb0\u4e00\u4e2a react \u95ee\u9898","authors":"youniaogu","date":"2020-11-16T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u901a\u8fc7 babel \u770b class","permalink":"/blog/2020/12/21/learn_about_class_through_babel"},"nextItem":{"title":"typescript \u5b9e\u8df5\u5fc3\u5f97","permalink":"/blog/2020/11/09/practice_experience_of_typescript"}},"content":"### \u8bb0\u4e00\u4e2a react \u95ee\u9898\\n\\n#### 1. \u524d\u8a00\\n\\n\u524d\u51e0\u5929\u770b\u5230\u4e00\u7bc7\u6587\u7ae0\uff1a[\u6211\u5728\u5927\u5382\u5199 React\uff0c\u5b66\u5230\u4e86\u4ec0\u4e48\uff1f\u6027\u80fd\u4f18\u5316\u7bc7](https://juejin.im/post/6889247428797530126)\uff0c\u6587\u7ae0\u6700\u5f00\u59cb\u63d0\u5230\u4e86\u795e\u5947\u7684`children`\uff0c\u8bb2\u8bc9\u4f7f\u7528`children`\u907f\u514d\u4e86\u4e0d\u5fc5\u8981\u7684\u6e32\u67d3\uff0c\u86ee\u6709\u610f\u601d\u7684\u3002\u800c\u8fd9\u7bc7\u6587\u7ae0\uff0c\u4e3b\u8981\u662f\u5206\u4eab\u6211\u5bf9\u6587\u7ae0\u4e2d\u95ee\u9898\u7684\u7406\u89e3\uff0c\u540c\u65f6\u68b3\u7406\u4e86\u5173\u4e8e react \u6e32\u67d3\u673a\u5236\u7684\u77e5\u8bc6\\n\\n#### 2. \u95ee\u9898\u662f\u4ec0\u4e48\uff1f\\n\\n\u6587\u4e2d`ChildNonTheme`\u91cc\u6ca1\u6709\u4f9d\u8d56 context\uff0c\u4f46\u4fee\u6539 context \u7684\u65f6\u5019\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u89e6\u53d1\u6e32\u67d3\uff1f\\n\\n\u56e0\u4e3a\u7236\u8282\u70b9\u53d1\u751f\u6539\u53d8\u65f6(state\u3001props\u3001context)\uff0c\u5b50\u8282\u70b9\u65e0\u8bba\u600e\u4e48\u6837\u90fd\u4f1a\u91cd\u65b0\u6e32\u67d3\uff0c\u5c31\u662f\u8fd9\u4e48\u7b80\u5355\\n\\n\u5982\u679c\u9700\u8981\u8ffd\u6839\u6eaf\u6e90\u7684\u8bdd\uff0c\u6839\u672c\u539f\u56e0\u662f react diff \u7b97\u6cd5\u5728\u6bd4\u8f83\u65b0\u65e7\u8282\u70b9\u7684\u65f6\u5019\uff0c\u5982\u679c\u7236\u8282\u70b9\u53d1\u751f\u6539\u53d8\uff0c\u5c06\u4f1a\u76f4\u63a5\u66ff\u6362\u6574\u4e2a\u8282\u70b9\uff0c\u800c\u4e0d\u4f1a\u5bf9\u5b50\u8282\u70b9\u8fdb\u884c\u6bd4\u8f83\u3002\u6240\u4ee5\u5373\u4f7f`ChildNonTheme`\u91cc\u7684\u72b6\u6001\u6ca1\u53d1\u751f\u6539\u53d8\uff0c\u4e5f\u4f1a\u91cd\u65b0\u6e32\u67d3\\n\\n#### 3. \u600e\u4e48\u89e3\u51b3\uff1f\\n\\n\u6587\u4e2d\u4f7f\u7528`children`\u65b9\u6cd5\u4e4b\u6240\u4ee5\u80fd\u591f\u89e3\u51b3\u95ee\u9898\uff0c\u4e2a\u4eba\u8ba4\u4e3a`ChildNonTheme`\u6b64\u65f6\u5e76\u4e0d\u5c5e\u4e8e`ThemeApp`\u7684\u5b50\u8282\u70b9\uff0c\u800c\u662f\u5c5e\u4e8e`App`\uff0c\u6240\u4ee5`ThemeApp`\u8282\u70b9\u6539\u53d8\u65f6\uff0c\u5e76\u4e0d\u80fd\u89e6\u53d1`ChildNonTheme`\u7684\u6e32\u67d3\uff08**\u5355\u7eaf\u4e2a\u4eba\u731c\u6d4b\uff0c\u5982\u6709\u66f4\u597d\u89e3\u91ca\u6216\u53d1\u73b0\u9519\u8bef\uff0c\u6b22\u8fce\u6307\u51fa**\uff09\\n\\n\u9664\u4e86`children`\u5916\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528`React.memo`\uff0c\u5bf9\u5e94 Component \u5199\u6cd5\u662f`React.PureComponent`\uff0c\u8fd9\u6837\u4e0d\u9700\u8981\u6539\u53d8\u4ee3\u7801\u7ed3\u6784\uff0c\u66f4\u52a0\u65b9\u4fbf"},{"id":"/2020/11/09/practice_experience_of_typescript","metadata":{"permalink":"/blog/2020/11/09/practice_experience_of_typescript","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-11-09-practice_experience_of_typescript.md","source":"@site/blog/2020-11-09-practice_experience_of_typescript.md","title":"typescript \u5b9e\u8df5\u5fc3\u5f97","description":"typescript \u5b9e\u8df5\u5fc3\u5f97","date":"2020-11-09T00:00:00.000Z","formattedDate":"2020\u5e7411\u67089\u65e5","tags":[],"readingTime":7.42,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"typescript \u5b9e\u8df5\u5fc3\u5f97","authors":"youniaogu","date":"2020-11-09T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u8bb0\u4e00\u4e2a react \u95ee\u9898","permalink":"/blog/2020/11/16/record_a_question_of_react"},"nextItem":{"title":"\u865a\u62df\u5217\u8868","permalink":"/blog/2020/10/15/virtual_list"}},"content":"### typescript \u5b9e\u8df5\u5fc3\u5f97\\n\\n\u5148\u8bf4\u4e0b\u603b\u7ed3\uff1a\\n\\n> 1. typescript \u7684\u9759\u6001\u68c0\u67e5\u80fd\u591f\u89c4\u907f\u5f88\u591a\u9519\u8bef\uff0c\u8d8a\u7528\u8d8a\u9999\u3002\\n>\\n> 2. \u7c7b\u578b\u68c0\u67e5\u9700\u8981\u73af\u73af\u76f8\u6263\uff0c\u5982\u679c\u8fd0\u7528\u4e0d\u5f53\uff0c\u5c06\u4f1a\u6210\u4e3a\u5982\u6897\u5728\u5589\u822c\u7684\u5b58\u5728\\n>\\n> 3. redux \u7684\u5355\u4e00\u6570\u636e\u6e90\u601d\u60f3\u4e0e typescript \u5341\u5206\u642d\u914d\\n\\n#### 1. \u524d\u8a00\\n\\n\u51e0\u4e2a\u6708\u524d\u6211\u5f00\u59cb\u5b66\u4e60 typescript\uff0c\u5e76\u5c06\u5176\u8fd0\u7528\u5230\u9879\u76ee\u4e2d\uff0c\u8fd9\u7bc7\u6587\u7ae0\u4e3b\u8981\u7528\u6765\u8bb0\u5f55\u5b9e\u6218\u8fc7\u7a0b\u4e2d\u4e00\u4e9b\u5fc3\u5f97\uff0c\u4e3b\u8981\u56f4\u7ed5 redux \u72b6\u6001\u4e0e typescript \u6765\u8bb2\u8ff0\\n\\ntips\uff1a\u5728\u5f00\u53d1\u9879\u76ee\u524d\uff0c\u5efa\u8bae\u5148\u67e5\u9605\u53bb\u76f8\u5173\u5e93\u6587\u6863\uff08\u6bd4\u5982\uff1a[redux](https://redux.js.org/recipes/usage-with-typescript)\uff09\uff0c\u53ef\u80fd\u4f1a\u6709\u4e00\u4e9b\u5173\u4e8e typescript \u7684\u6559\u7a0b\\n\\n#### 2. \u9879\u76ee\u642d\u5efa\\n\\n\u4f7f\u7528`cra`\u642d\u5efa\uff0c\u56e0\u4e3a\u5f00\u53d1\u8fdb\u5ea6\u7d27\u6025\uff0c\u6ca1\u6709\u591a\u4f59\u7684\u65f6\u95f4\u6765\u7814\u7a76`webpack`\u548c`babel`\u914d\u7f6e\uff08\u800c\u4e14\u6211\u76f8\u4fe1`cra`\u505a\u7684\u80af\u5b9a\u6bd4\u6211\u597d\uff09\\n\\n#### 3. connect \u548c typescript\\n\\n\u5728 typescript \u4e2d\uff0c`react.component`\u9700\u8981\u5b9a\u4e49`props`\u548c`state`\u7684\u7c7b\u578b\uff0c\u6240\u4ee5\u5728\u4f7f\u7528`connect`\u7684\u60c5\u51b5\u4e0b\uff0c\u9700\u8981\u5bf9\u4f20\u9012\u7684`props`\u8fdb\u884c\u7c7b\u578b\u5b9a\u4e49\\n\\n`mapStateToProps`\u4e3a\u51fd\u6570\u7c7b\u578b\uff0c`mapDispatchToProps`\u4e3a\u5bf9\u8c61\u7c7b\u578b\uff0c\u6240\u4ee5\u6700\u597d\u7684\u529e\u6cd5\u662f\u4f7f\u7528\u8303\u578b\u5de5\u5177`ReturnType`\u548c`typeof`\\n\\n```javascript\\ntype PropsTypes = ReturnType<typeof mapStateToProps> & typeof mapDispatchToProps & { ... };\\n\\nconst mapStateToProps = function (state: RootTypes) { return state.app };\\nconst mapDispatchToProps = { launch };\\n\\nclass App extends component<PropsTypes> { ... };\\n```\\n\\n\u4e0a\u9762\u4f8b\u5b50\u7684`RootTypes`\u6307`redux`\u4e2d\u6574\u4e2a`state`\u7684\u7c7b\u578b\uff0c\u4e0b\u9762\u5c31\u6765\u4ecb\u7ecd\u5982\u4f55\u83b7\u53d6\u5b83\\n\\n#### 4. reducer \u548c typescript\\n\\n`reducer`\u4f5c\u4e3a\u7eaf\u51fd\u6570\uff0c\u7528`ReturnType`\u5f88\u7b80\u5355\u5c31\u53ef\u4ee5\u83b7\u5f97\u8fd4\u56de\u7684\u7c7b\u578b\\n\\n```javascript\\nimport { combineReducers } from \\"redux\\";\\n\\nexport function launch() {\\n  return {\\n    type: \\"LAUNCH\\",\\n  };\\n}\\nexport function launchCompletion(error: Error | undefined) {\\n  return {\\n    type: \\"LAUNCH_COMPLETION\\",\\n    error,\\n  };\\n}\\n\\nconst initialState: 0 | 1 | 2 = 0;\\nfunction appReducer(state = initialState, action): typeof initialState {\\n  switch (action.type) {\\n    case \\"LAUNCH\\": {\\n      return 1;\\n    }\\n    case \\"LAUNCH_COMPLETION\\": {\\n      if (action.error) {\\n        return 0;\\n      }\\n      return 2;\\n    }\\n    default:\\n      return state;\\n  }\\n}\\nconst rootReducer = combineReducers({ app: appReducer });\\n\\nexport type RootTypes = ReturnType<typeof rootReducer>;\\nexport default rootReducer;\\n```\\n\\n\u6ce8\u610f`appReducer`\u65b9\u6cd5\u5fc5\u987b\u5b9a\u4e49\u8fd4\u56de\u7684\u7c7b\u578b\uff0c\u5982\u4e0b\\n\\n```javascript\\nfunction appReducer(state = initialState, action): typeof initialState { ... }\\n```\\n\\n**\u5982\u4f55\u4e0d\u5b9a\u4e49\uff0c\u8fd4\u56de\u7684\u7c7b\u578b\u5c06\u4f1a\u662f`never`!**\\n\\n\u4e0a\u9762\u7684`reducer`\u867d\u7136\u80fd\u8fd4\u56de\u6b63\u786e\u7684`RootTypes`\uff0c**\u4f46`action`\u8fd8\u6ca1\u6709\u5b9a\u4e49**\uff0c`action`\u7684\u7c7b\u578b\u4e3a`any`\uff0c\u8fd9\u6837`RootTypes`\u5c06\u6beb\u65e0\u610f\u4e49\uff0c\u56e0\u4e3a`case`\u91cc\u53ef\u4ee5\u968f\u610f\u4fee\u6539\u8fd4\u56de\u7684`state`\uff0c**\u6240\u4ee5\u4e3a`action`\u6dfb\u52a0\u7c7b\u578b\u5c24\u4e3a\u91cd\u8981**\\n\\n`action creator`\u4e3a\u51fd\u6570\u7c7b\u578b\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u5c06`action creator`\u8fd4\u56de\u7684\u7c7b\u578b\u5bfc\u51fa\uff0c\u7136\u540e\u5bfc\u5165\u5230`reducer`\u91cc\uff0c\u4e3a`action`\u63d0\u4f9b\u7c7b\u578b\\n\\n```javascript\\n...\\nexport function launch() { ... }\\nexport function launchCompletion() { ... }\\nconst initialState: 0 | 1 | 2 = 0;\\nfunction appReducer(state = initialState, action): typeof initialState {\\n  switch (action.type) {\\n    case \\"LAUNCH\\": { ... }\\n    case \\"LAUNCH_COMPLETION\\": {\\n      const { error } = action as ReturnType<typeof launchCompletion>\\n      ...\\n    }\\n    default:\\n      return state;\\n  }\\n}\\n...\\n```\\n\\n\u8fd9\u6837\u5b50\u53ef\u884c\uff0c\u4f46\u5982\u679c`case`\u6570\u91cf\u591a\u8d77\u6765\uff0c\u5c31\u9700\u8981\u5bfc\u5165\u591a\u4e2a\u7c7b\u578b\uff0c\u591a\u6b21\u4e3a`action`\u63d0\u4f9b\u7c7b\u578b\uff0c\u504f\u9ebb\u70e6\u3002\u8fd9\u91cc\u53ef\u4ee5\u4f7f\u7528 typescript[\u8fa8\u6790\u8054\u5408\u7c7b\u578b](https://jkchao.github.io/typescript-book-chinese/typings/discrominatedUnion.html#%E8%AF%A6%E7%BB%86%E7%9A%84%E6%A3%80%E6%9F%A5)\u7684\u7279\u6027\u4f18\u5316\u4e00\u4e0b\\n\\n```javascript\\nexport function launch() { ... }\\nexport function launchCompletion(error: Error | undefined) { ... }\\nexport function loadUserList(page: number, pageSize: number) { ... }\\nexport function loadUserListCompletion(error: Error | undefined, data: {[key: string]: any}) { ... }\\nexport type ActionTypes =\\n  | ReturnType<typeof launch>\\n  | ReturnType<typeof launchCompletion>\\n  | ReturnType<typeof loadUserList>\\n  | ReturnType<typeof loadUserListCompletion>\\n\\nconst initialState: 0 | 1 | 2 = 0;\\nfunction appReducer(state: = initialState, action: ActionTypes): typeof initialState {\\n  switch (action.type) {\\n    case \\"LAUNCH\\": { ... }\\n    case \\"LAUNCH_COMPLETION\\": { ... }\\n    case \\"LOAD_USER_LIST\\": { ... }\\n    case \\"LOAD_USER_LIST_COMPLETION\\": { ... }\\n    default:\\n      return state;\\n  }\\n}\\n```\\n\\n\u53ea\u9700\u8981\u5f15\u5165`ActionTypes`\uff0c\u5e76\u4e3a`action`\u6dfb\u52a0\u7c7b\u578b\uff0ctypescript \u4f1a\u6839\u636e`action.type`\u63a8\u65ad\u51fa\u5f53\u524d action \u7684\u7c7b\u578b\\n\\n#### 5. saga \u548c typescript\\n\\nsaga \u9700\u8981\u8fdb\u884c\u7c7b\u578b\u5b9a\u4e49\u7684\u4e3b\u8981\u6709\u4e24\u70b9\\n\\n- \u7b2c\u4e00\uff1a\u8bf7\u6c42\u5b8c\u63a5\u53e3\u540e\u8fd4\u56de\u7684\u6570\u636e\\n- \u7b2c\u4e8c\uff1a\u4f7f\u7528`select`\u8fd4\u56de\u7684`state`\\n\\n\u63a5\u53e3\u8fd4\u56de\u7684\u6570\u636e\u548c\u683c\u5f0f\u662f\u4e0d\u53ef\u63a7\u7684\uff0c\u5982\u679c\u5bf9\u5176\u8fdb\u884c\u7c7b\u578b\u5b9a\u4e49\u5c06\u4f1a\u82b1\u8d39\u5927\u91cf\u7cbe\u529b\uff0c\u4e0d\u53ef\u53d6\uff0c\u5efa\u8bae`any`\u5e26\u8fc7\u3002\u91cd\u70b9\u653e\u5728\u7b2c\u4e8c\u70b9\u4e0a\\n\\n`select`\u7684\u8fd4\u56de\u603b\u662f`any`\uff0c\u5373\u4f7f`selector`\u5b9a\u4e49\u4e86\u8fd4\u56de\u7684\u7c7b\u578b\uff0c\u8be6\u7ec6\u53ef\u4ee5\u770b\uff1a[issues](https://github.com/redux-saga/redux-saga/issues/970)\\n\\n\u6bd4\u8f83\u597d\u7684\u89e3\u51b3\u65b9\u6cd5\u4e3b\u8981\u6709\u4e24\u79cd\\n\\n- \u7b2c\u4e00\u79cd\uff1a\u5c06`selector`\u62ff\u51fa\u6765\uff0c\u4f7f\u7528`ReturnType`\u4e3a\u8fd4\u56de\u7ed3\u679c\u8fdb\u884c\u5b9a\u4e49\\n\\n```javascript\\nconst selector = (state: RootTypes) => state.app;\\nconst app: ReturnType<typeof selector> = yield select(selector);\\n```\\n\\n**\u903b\u8f91\u548c\u6700\u521d\u4e00\u6837**\uff0c\u5199\u6cd5\u4e0a\u7ed5\u4e86\u4e00\u4e0b\\n\\n- \u7b2c\u4e8c\u79cd\uff1a\u5229\u7528`yield select()`\u7b49\u540c\u4e8e`getState()`\u7684\u7279\u70b9\uff0c\u5c06`select`\u7684\u8fd4\u56de\u4f5c\u4e3a\u4f20\u53c2\u4f20\u5165`selector`\u4e2d\\n\\n```javascript\\nconst app = ((state: RootTypes) => state.app)(yield select())\\n```\\n\\n**\u5199\u6cd5\u7b80\u5355\uff0c\u4f46\u4e0e\u6700\u521d\u7684\u903b\u8f91\u6709\u51fa\u5165**\uff0c\u6bd4\u5982\u8fdb\u884c\u6d4b\u8bd5\u65f6\uff0c\u9700\u8981\u4f20\u5165\u6574\u4e2a state\\n\\n#### 6. \u5168\u5c40\u53d8\u91cf\\n\\n`ActionTypes`\u548c`RootTypes`\u90fd\u662f\u552f\u4e00\u7684\uff0c\u53ea\u9700\u8981\u5728\u5168\u5c40\u5b9a\u4e49\u8fd9\u4e24\u4e2a\u7c7b\u578b\uff0c\u5c31\u53ef\u4ee5\u51cf\u5c11\u5bfc\u5165\u4ee3\u7801\u82b1\u8d39\u7684\u65f6\u95f4\\n\\nstep 1. \u786e\u8ba4`tsconfig.json`\u91cc\u7684\u914d\u7f6e\uff0c\u628a\u5168\u5c40\u914d\u7f6e\u7684`.d.ts`\u6587\u4ef6\u653e\u5728\u7f16\u8bd1\u7684\u8303\u56f4\u5185\u5373\u53ef\\n\\nstep 2. \u5199\u5165\u5168\u5c40\u7c7b\u578b\\n\\n```javascript\\n//actions.js\\n...\\nexport type ActionTypes =\\n  | ReturnType<typeof launch>\\n  | ReturnType<typeof launchCompletion>\\n  | ReturnType<typeof loadUserList>\\n  | ReturnType<typeof loadUserListCompletion>\\n\\n//reducers.js\\n...\\nexport type RootTypes = ReturnType<typeof rootReducer>;\\nexport default rootReducer;\\n\\n// global.d.ts\\ndeclare type RootTypes = import(\'reducers\').RootTypes;\\ndeclare type ActionTypes = import(\'actions\').ActionTypes;\\n```\\n\\nstep 3. \u9700\u8981\u6ce8\u610f\u7684\u70b9\\n\\n\u7b2c\u4e00\uff0cimport \u5bfc\u5165\u662f\u5728 typescript2.9 \u52a0\u5165\u7684\uff0c\u5e76\u4e14\u53ea\u80fd\u5bfc\u5165\u7c7b\u578b\\n\\n\u7b2c\u4e8c\uff0c\u5728\u6dfb\u52a0\u5168\u5c40\u7c7b\u578b\u540e\uff0c\u6709\u53ef\u80fd\u4f1a\u51fa\u73b0\u7f16\u8bd1\u5668\u62a5\u9519\uff0c\u800c\u7f16\u8bd1\u901a\u8fc7\u7684\u95ee\u9898(\u89c1\u4e0b\u56fe)\uff0c\u91cd\u542f vscode \u5373\u53ef\u89e3\u51b3\\n\\n<img src={require(\\"./assets/screenshots/33.png\\").default} width=\\"600\\" alt=\\"33.png\\" />\\n\\n#### 7. \u5199\u5728\u6700\u540e\\n\\n\u6700\u5f00\u59cb\u4f7f\u7528 typescript\uff0c\u65b0\u624b\u4e0a\u8def\uff0c\u4e0d\u77e5\u9053\u5982\u4f55\u4f7f\u7528\u8303\u578b\uff0c\u5199\u4e86\u5f88\u591a\u91cd\u590d\u7684\u7c7b\u578b\u5b9a\u4e49\uff0c\u8d39\u65f6\u53c8\u8d39\u529b\u3002\u800c\u4e14\u4fee\u6539 redux \u91cc\u7684 state \u5b9a\u4e49\uff0c\u9700\u8981\u4fee\u6539\u597d\u51e0\u5904\u7684 props\uff0c\u662f\u771f\u7684\u5f88\u96be\u53d7\uff0c**\u611f\u89c9\u5f88\u4e0d\u503c\u5f97**\\n\\n\u540e\u9762\u6162\u6162\u5b66\u4f1a\u5982\u4f55\u8fd0\u7528\u8303\u578b\uff0c\u7ed3\u5408 redux \u5355\u4e00\u6570\u636e\u6e90\u8bbe\u8ba1\uff0c\u6570\u636e\u81f3\u4e0a\u800c\u4e0b\u4f20\u9012\uff0c\u7c7b\u578b\u4e5f\u53ef\u4ee5\u968f\u7740\u6570\u636e\u81f3\u4e0a\u800c\u4e0b\u4f20\u9012\uff0c\u4e0d\u7528\u5728\u5404\u4e2a\u5730\u65b9\u5b9a\u4e49\u7c7b\u578b\uff0c**\u7528\u66f4\u5c11\u7684\u4ee3\u7801\u83b7\u5f97\u66f4\u591a\u7684\u7c7b\u578b\u5b9a\u4e49\uff0ctypescript \u6162\u6162\u9999\u4e86\u8d77\u6765**\\n\\ntypescript \u662f javascript \u7684\u8d85\u96c6\uff0c\u8bed\u6cd5\u4e0a\u5b66\u4e60\u8d77\u6765\u5f88\u7b80\u5355\uff0c\u4f46\u8981\u60f3\u6709\u4e2a\u597d\u7684\u4f53\u9a8c\u548c\u5b9e\u8df5\uff0c\u6ca1\u6709\u60f3\u8c61\u4e2d\u90a3\u4e48\u7b80\u5355\uff0c\u5c31\u8ddf\u753b\u9a6c\u4e00\u6837\\n\\n<img src={require(\\"./assets/screenshots/32.png\\").default} width=\\"300\\" alt=\\"32.png\\" />\\n\\n\u5e0c\u671b\u8fd9\u7bc7\u6587\u7ae0\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u8c22\u8c22\uff01"},{"id":"/2020/10/15/virtual_list","metadata":{"permalink":"/blog/2020/10/15/virtual_list","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-10-15-virtual_list.md","source":"@site/blog/2020-10-15-virtual_list.md","title":"\u865a\u62df\u5217\u8868","description":"\u865a\u62df\u5217\u8868","date":"2020-10-15T00:00:00.000Z","formattedDate":"2020\u5e7410\u670815\u65e5","tags":[],"readingTime":7.025,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u865a\u62df\u5217\u8868","authors":"youniaogu","date":"2020-10-15T00:00:00.000Z","tags":[]},"prevItem":{"title":"typescript \u5b9e\u8df5\u5fc3\u5f97","permalink":"/blog/2020/11/09/practice_experience_of_typescript"},"nextItem":{"title":"\u6d6e\u70b9\u6570\u8ba1\u7b97\u95ee\u9898","permalink":"/blog/2020/10/10/floating_point_calculation_problem"}},"content":"### \u865a\u62df\u5217\u8868\\n\\n#### 1. \u524d\u8a00\\n\\n\u6211\u4eec\u5148\u6765\u770b\u4e2a\u95ee\u9898\uff1a\\n\\n\u67d0\u5929\uff0c\u4ea7\u54c1\u8981\u6c42\u6211\u4eec\u5c55\u793a\u4e00\u4e2a\u5927\u6570\u636e\u5217\u8868\uff08\u51e0\u4e07\u6216\u8005\u5341\u51e0\u4e07\u6761\uff09\uff0c\u4f46\u4e00\u6b21\u6027\u6e32\u67d3\u51fa\u6765\u4f1a\u5b58\u5728\u6027\u80fd\u95ee\u9898\uff0c\u8bf7\u95ee\u8be5\u600e\u4e48\u505a\uff1f\\n\\n- \u5206\u9875\\n\\n\u524d\u7aef\u5206\u9875\u6216\u8005\u540e\u7aef\u5206\u9875\u90fd\u53ef\u4ee5\uff0c\u8fd9\u662f\u6700\u5e38\u89c1\u7684\u5904\u7406\u65b9\u5f0f\uff0c\u4e5f\u662f\u6700\u597d\u7684\u5904\u7406\u65b9\u5f0f\\n\\n\u90a3\u5982\u679c\u4ea7\u54c1\u4e0d\u60f3\u8981\u5206\u9875\uff0c\u575a\u51b3\u4e0d\u8981\uff0c\u8fd9\u65f6\u5019\u8be5\u600e\u4e48\u529e\uff1f\u7b54\u6848\u662f\uff1a\\n\\n- \u865a\u62df\u5217\u8868\\n\\n\u4e0b\u9762\u7684\u573a\u666f\uff0c\u6211\u4eec\u6765\u601d\u8003\u4e0b\uff1a\\n\\n\u4e00\u4e2a\u8ba2\u5355\u5217\u8868\u5bb9\u5668\u9ad8 200px\uff0c\u4e00\u4e2a\u8ba2\u5355\u7ec4\u4ef6\u9ad8 50px\uff0c\u4e5f\u5c31\u662f\u8bf4\u6700\u591a\u80fd\u5b8c\u6574\u663e\u793a 4 \u4e2a\u8ba2\u5355\uff08\u90e8\u5206\u51fa\u73b0\u7684\u8bdd\u662f 5 \u4e2a\uff09\\n\\n<img src={require(\\"./assets/screenshots/21.png\\").default} width=\\"300\\" />\\n\\n\u8fd9\u65f6\u540e\u53f0\u63a5\u53e3\u8fd4\u56de 100 \u4e2a\u8ba2\u5355\uff0c\u4e8e\u662f\u6211\u4eec\u628a 100 \u4e2a\u8ba2\u5355\u90fd\u6e32\u67d3\u51fa\u6765\\n\\n<img src={require(\\"./assets/screenshots/22.png\\").default} width=\\"150\\" />\\n\\n\u4f46\u8ba2\u5355\u5217\u8868\u5bb9\u5668\u6700\u591a\u53ea\u80fd\u663e\u793a 5 \u4e2a\u8ba2\u5355\u7ec4\u4ef6\uff0c\u4e5f\u5c31\u662f\u8bf4\u8ba2\u5355 6-100 \u6682\u65f6\u662f\u65e0\u7528\u7684\uff0c\u53ea\u6709\u8ba2\u5355 1-5 \u662f\u5fc5\u987b\u6e32\u67d3\u7684\uff0c\u53ea\u9700\u8981\u6e32\u67d3\u5fc5\u8981\u7684\u5143\u7d20\uff0c\u8fd9\u5c31\u662f\u865a\u62df\u5217\u8868\u7684\u6838\u5fc3\u601d\u60f3\\n\\n#### 2. \u4ec0\u4e48\u662f\u865a\u62df\u5217\u8868\uff1f\\n\\n\u7b80\u5355\u6765\u8bf4\uff0c\u5c31\u662f\u901a\u8fc7\u8ba1\u7b97\uff0c\u52a8\u6001\u5c55\u793a\u5217\u8868\u7684\u4e00\u90e8\u5206\uff0c\u8fbe\u5230\u8282\u7ea6\u8d44\u6e90\u7684\u6548\u679c\\n\\n\u901a\u8fc7[scrollTop](https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollTop)\u53ef\u4ee5\u77e5\u9053\u4e00\u4e2a\u5143\u7d20\u7684\u5185\u5bb9\u5782\u76f4\u6eda\u52a8\u7684\u50cf\u7d20\u5927\u5c0f\uff0c\u8ba1\u7b97\u51fa\u5f53\u524d\u4f4d\u7f6e\u5bf9\u5e94\u539f\u5217\u8868\u5143\u7d20\u7684 index\uff0c\u4ece\u800c\u6e32\u67d3\u9700\u8981\u7684\u5217\u8868\u90e8\u5206\\n\\n\u865a\u62df\u5217\u8868\u6eda\u52a8\u8fc7\u7a0b\uff1a\\n\\n```javascript\\n<div style=\\"display: flex; align-items: center; text-align: center;\\">\\n  <div>\\n    <img src={require(\\"./assets/screenshots/23.png\\").default} width=\\"150\\" />\\n    <p>\uff081\uff09\u521d\u59cb\u72b6\u6001</p>\\n  </div>\\n  <span>\u3000=>\u3000</span>\\n  <div>\\n    <img src={require(\\"./assets/screenshots/24.png\\").default} width=\\"150\\" />\\n    <p>\uff082\uff09\u6ed1\u52a8\u4e00\u6bb5\u8ddd\u79bb</p>\\n  </div>\\n  <span>\u3000=>\u3000</span>\\n  <div>\\n    <img src={require(\\"./assets/screenshots/25.png\\").default} width=\\"150\\" />\\n    <p>\uff083\uff09\u91cd\u65b0\u6e32\u67d3\u540e</p>\\n  </div>\\n</div>\\n```\\n\\n#### 3. \u56fa\u5b9a\u9ad8\u5ea6\u5b9e\u73b0\\n\\n\u5728\u6eda\u52a8\u540e\uff0c\u6211\u4eec\u9700\u8981\u8ba1\u7b97 top \u7684\u503c\\n\\n<img src={require(\\"./assets/screenshots/23.png\\").default} width=\\"150\\" />\\n\\n<p>top\u4e3a4\u4e2a\u8ba2\u5355\u7684\u9ad8\u5ea6</p>\\n\\n<img src={require(\\"./assets/screenshots/25.png\\").default} width=\\"150\\" />\\n\\n<p>top\u4e3a5\u4e2a\u8ba2\u5355\u7684\u9ad8\u5ea6</p>\\n\\n\u4e0b\u9762\u4ee3\u7801\u4e3a\u4e86\u76f4\u63a5\u4f53\u73b0\u865a\u62df\u5217\u8868\u7684\u5b9e\u73b0\uff0c**\u6ca1\u6709\u8fdb\u884c api \u62bd\u8c61**\uff0c\u8be6\u7ec6\u8bf7\u770b\uff1a[github](https://github.com/youniaogu/react-demo/blob/master/src/virtual-list/index.js)\\n\\n```javascript\\nimport React, { Component } from \\"react\\";\\n\\nclass VirtualList extends Component {\\n  constructor(props) {\\n    super(props);\\n\\n    this.list = new Array(100000).fill(null).map((_, index) => {\\n      return index + 1;\\n    });\\n    this.height = 600; //\u5bb9\u5668\u9ad8\u5ea6\\n    this.itemHeight = 60; //\u5355\u4e2a\u5b50\u5143\u7d20\u9ad8\u5ea6\\n    this.state = { visibleData: [], startOffset: 0, offsetHeight: 0 }; //\u521d\u59cb\u5316\u6570\u636e\\n    this.totalHeight = this.list.length * this.itemHeight; //\u539f\u5217\u8868\u603b\u9ad8\u5ea6\\n    this.visibleCount = Math.ceil(this.height / this.itemHeight); //\u5bb9\u5668\u53ef\u4ee5\u663e\u793a\u7684\u4e2a\u6570\uff08\u5411\u4e0a\u53d6\u6574\uff09\\n    this.startIndex = 0; //\u5f00\u59cb\u7684index\\n    this.endIndex = this.startIndex + this.visibleCount; //\u7ed3\u675f\u7684index\\n  }\\n\\n  componentDidMount() {\\n    this.updateVisibleData(); //\u66f4\u65b0\u5217\u8868\\n  }\\n\\n  updateVisibleData = () => {\\n    const visibleData = this.list.slice(this.startIndex, this.endIndex);\\n    const startOffset = this.startIndex * this.itemHeight;\\n    const offsetHeight = visibleData.length * this.itemHeight;\\n\\n    this.setState({\\n      visibleData,\\n      startOffset,\\n      offsetHeight,\\n    });\\n  };\\n  handleScroll = (e) => {\\n    const scrollTop = this.node.scrollTop;\\n    const index = scrollTop / this.itemHeight;\\n\\n    this.startIndex = Math.floor(index);\\n    this.endIndex =\\n      this.startIndex + this.visibleCount + (index % 1 > 0 ? 1 : 0); //\u56e0\u4e3astartIndex\u5411\u4e0b\u53d6\u6574\uff0c\u6240\u4ee5endIndex\u9700\u8981\u6839\u636e\u60c5\u51b5\u9002\u5f53+1\\n\\n    this.updateVisibleData();\\n  };\\n\\n  renderListItem = (item) => {\\n    return (\\n      <div\\n        key={item}\\n        style={{\\n          height: this.itemHeight,\\n          boxSizing: \\"border-box\\",\\n          borderBottom: \\"1px solid black\\",\\n        }}\\n      >\\n        {item}\\n      </div>\\n    );\\n  };\\n\\n  render() {\\n    const { visibleData, startOffset, offsetHeight } = this.state;\\n\\n    return (\\n      <div\\n        style={{\\n          position: \\"relative\\",\\n          overflowY: \\"auto\\",\\n          height: this.height,\\n          border: \\"1px solid black\\",\\n        }}\\n        ref={(node) => (this.node = node)}\\n        onScroll={this.handleScroll}\\n      >\\n        <div style={{ height: this.totalHeight }}>\\n          <div\\n            style={{\\n              position: \\"absolute\\",\\n              left: 0,\\n              right: 0,\\n              top: startOffset,\\n              height: offsetHeight,\\n            }}\\n          >\\n            {visibleData.map(this.renderListItem)}\\n          </div>\\n        </div>\\n      </div>\\n    );\\n  }\\n}\\n\\nexport default VirtualList;\\n```\\n\\n\u9664\u4e86\u8bbe\u7f6e`height`\u6765\u6491\u5f00\u6eda\u52a8\u5bb9\u5668\u7684\u9ad8\u5ea6\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528`padding`\u548c`margin`\uff0c\u4f46\u9700\u8981\u989d\u5916\u8ba1\u7b97 bottom \u7684\u8ddd\u79bb\\n\\n<img src={require(\\"./assets/screenshots/31.png\\").default} width=\\"400\\" />\\n\\n#### 4. \u6d4b\u8bd5\\n\\n\u4e0b\u9762\u662f react \u521b\u5efa\u957f\u5ea6\u4e3a 100000 \u7684\u5217\u8868\u9700\u8981\u7684\u65f6\u95f4\uff0c\u5176\u4e2d\u6e32\u67d3\u548c js \u811a\u672c\u5360\u4e86\u5927\u90e8\u5206\u65f6\u95f4\uff0c\u5206\u522b\u662f 4.9s \u548c 1.5s\uff0c\u6e32\u67d3\u4e45\u5f88\u5bb9\u6613\u7406\u89e3\uff0c\u6bd5\u7adf\u9700\u8981\u5904\u7406 100000 \u4e2a dom \u5143\u7d20\uff0c\u811a\u672c\u4e45\u4e3b\u8981\u662f\u56e0\u4e3a react \u91cc\u865a\u62df dom \u5904\u7406\u7684\u539f\u56e0\\n\\n<img src={require(\\"./assets/screenshots/28.png\\").default} />\\n\\n\u518d\u4e0b\u9762\u662f react \u521b\u5efa\u957f\u5ea6\u4e3a 100000 \u7684\u865a\u62df\u5217\u8868\u9700\u8981\u7684\u65f6\u95f4\uff0c\u53ef\u4ee5\u770b\u5230 0.5s \u90fd\u4e0d\u5230\u5c31\u6e32\u67d3\u597d\u4e86\\n\\n<img src={require(\\"./assets/screenshots/29.png\\").default} />\\n\\n#### 5. \u767d\u5c4f\uff1f\\n\\n\u6709\u597d\u5904\u5c31\u6709\u574f\u5904\uff0c\u865a\u62df\u5217\u8868\u5728\u5feb\u901f\u6ed1\u52a8\u65f6\uff0c`onScroll`\u4e8b\u4ef6\u54cd\u5e94\u7684\u901f\u5ea6\u5982\u679c\u672a\u80fd\u8ddf\u4e0a\u6ed1\u52a8\u7684\u901f\u5ea6\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5411\u4e0b\u6ed1\u52a8\u8bdd\u65b0\u7684\u9875\u9762\u6ca1\u80fd\u53ca\u65f6\u6e32\u67d3\u51fa\u6765\uff0c\u8fd9\u5c31\u662f\u767d\u5c4f\u95ee\u9898\\n\\n<img src={require(\\"./assets/screenshots/26.png\\").default} width=\\"400\\" />\\n\\n\u53ef\u4ee5\u5c1d\u8bd5\u7f13\u5b58\u7684\u65b9\u5f0f\uff0c\u5728\u9996\u5c3e\u989d\u5916\u6e32\u67d3\u4e00\u90e8\u5206\u7684\u5143\u7d20\uff0c\u6709\u4e00\u5b9a\u7f13\u5b58\u8ddd\u79bb\uff0c\u8fd9\u6837\u4e0d\u90a3\u4e48\u5bb9\u6613\u51fa\u73b0\u767d\u5c4f\u95ee\u9898\uff0c\u4f46\u4e8b\u5b9e\u4e0a\uff0c\u6ed1\u52a8\u901f\u5ea6\u8981\u662f\u5feb\u8fc7\u7f13\u5b58\u8ddd\u79bb\u8fd8\u662f\u4f1a\u6709\u767d\u5c4f\u73b0\u8c61\uff0c\u5c24\u5176\u662f**\u62d6\u52a8\u6eda\u52a8\u6761**\uff0c\u6240\u4ee5\u8bf4\u5e76\u4e0d\u80fd\u5b8c\u5168\u89e3\u51b3\u95ee\u9898\\n\\n<img src={require(\\"./assets/screenshots/27.png\\").default} width=\\"500\\" />\\n\\n\u4e0a\u9762\u56fe\u793a\u91cc\uff0c\u8ba2\u5355\u5217\u8868\u5c3e\u90e8\u591a\u6e32\u67d3\u4e86 3 \u4e2a\u8ba2\u5355\u4f5c\u4e3a\u7f13\u5b58\uff0c\u53ea\u8981\u4e00\u6b21\u6ed1\u52a8\u7684\u8ddd\u79bb\u4e0d\u8d85\u8fc7 3 \u4e2a\u8ba2\u5355\u9ad8\u5ea6\uff0c\u5373\u4f7f\u4e8b\u4ef6\u54cd\u5e94\u548c\u6e32\u67d3\u901f\u5ea6\u8f83\u6162\uff0c\u4e5f\u4e0d\u4f1a\u51fa\u73b0\u767d\u5c4f\u95ee\u9898\uff08\u5411\u4e0a\u6ed1\u52a8\u540c\u7406\uff0c\u53ea\u8981\u9996\u90e8\u589e\u52a0\u7f13\u5b58\u5373\u53ef\uff09\\n\\n#### 6. \u7f13\u5b58\\n\\n\u589e\u52a0\u7f13\u5b58\u53ea\u9700\u8981\u4fee\u6539`startIndex`\u548c`endIndex`\u7684\u903b\u8f91\u5373\u53ef\\n\\n```javascript\\nimport React, { Component } from \\"react\\";\\n\\nclass VirtualList extends Component {\\n  constructor(props) {\\n    super(props);\\n\\n    this.list = new Array(100000).fill(null).map((_, index) => {\\n      return index + 1;\\n    });\\n    this.cache = 5; //\u9996\u5c3e\u7f13\u5b58\u6570\u91cf\\n    ... //\u7701\u7565\\n    this.endIndex = this.startIndex + this.visibleCount + this.cache; //\u7ed3\u675f\u7684index\\n  }\\n\\n  ...\\n\\n  handleScroll = e => {\\n    const scrollTop = this.node.scrollTop;\\n    const index = scrollTop / this.itemHeight;\\n    const startIndex = Math.floor(index);\\n    const offsetIndex = index % 1 > 0 ? 1 : 0;\\n\\n    if (startIndex >= this.cache) {\\n      this.startIndex = startIndex - this.cache;\\n    } else {\\n      this.startIndex = 0;\\n    }\\n\\n    if (\\n      startIndex >=\\n      this.list.length - (this.visibleCount + this.cache + offsetIndex)\\n    ) {\\n      this.endIndex = this.list.length;\\n    } else {\\n      this.endIndex = startIndex + this.visibleCount + this.cache + offsetIndex;\\n    }\\n\\n    this.updateVisibleData();\\n  };\\n\\n  ...\\n```\\n\\n\u589e\u52a0`cache`\u53c2\u6570\uff0c\u4fee\u6539`handleScroll`\u51fd\u6570\\n\\n<img src={require(\\"./assets/screenshots/30.gif\\").default} width=\\"500\\" />\\n\\n#### 7. \u52a8\u6001\u9ad8\u5ea6\u5b9e\u73b0\\n\\n\u4e0a\u9762\u7684\u573a\u666f\u548c\u5b9e\u73b0\u90fd\u662f\u4ee5\u5217\u8868\u5b50\u5143\u7d20\u56fa\u5b9a\u9ad8\u5ea6\u6765\u5b9e\u73b0\uff0c\u90a3\u5982\u679c\u9ad8\u5ea6\u4e0d\u56fa\u5b9a\u8be5\u600e\u4e48\u529e\uff1f\\n\\n\u672a\u5b8c\u5f85\u7eed..."},{"id":"/2020/10/10/floating_point_calculation_problem","metadata":{"permalink":"/blog/2020/10/10/floating_point_calculation_problem","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-10-10-floating_point_calculation_problem.md","source":"@site/blog/2020-10-10-floating_point_calculation_problem.md","title":"\u6d6e\u70b9\u6570\u8ba1\u7b97\u95ee\u9898","description":"\u6d6e\u70b9\u6570\u8ba1\u7b97\u95ee\u9898","date":"2020-10-10T00:00:00.000Z","formattedDate":"2020\u5e7410\u670810\u65e5","tags":[],"readingTime":3.565,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u6d6e\u70b9\u6570\u8ba1\u7b97\u95ee\u9898","authors":"youniaogu","date":"2020-10-10T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u865a\u62df\u5217\u8868","permalink":"/blog/2020/10/15/virtual_list"},"nextItem":{"title":"\u5b8f\u4efb\u52a1\u548c\u5fae\u4efb\u52a1","permalink":"/blog/2020/10/10/tasks_and_microtasks"}},"content":"### \u6d6e\u70b9\u6570\u8ba1\u7b97\u95ee\u9898\\n\\n#### 1. \u524d\u8a00\\n\\n\u5f88\u591a\u4eba\u90fd\u77e5\u9053 js \u91cc\u7684 number \u662f\u4ee5\u6d6e\u70b9\u6570\u5f62\u5f0f\u50a8\u5b58\uff0c\u9075\u5faa[IEEE 754 \u6807\u51c6](https://en.wikipedia.org/wiki/IEEE_754)\uff0c\u6240\u4ee5\u5728\u8fdb\u884c\u5c0f\u6570\u8ba1\u7b97\u65f6\u4f1a\u6709\u4e00\u4e9b\u8bef\u5dee\uff0c\u5176\u5b9e\u6d6e\u70b9\u6570\u8ba1\u7b97\u95ee\u9898\u4e0d\u6b62 js\uff0c\u5176\u4ed6\u8bed\u8a00\u4e5f\u4f1a\u6709\u7c7b\u4f3c\u60c5\u51b5\\n\\n\u4e3e\u4e2a \ud83c\udf30\uff1a\\n\\n<img src={require(\\"./assets/screenshots/9.png\\").default} width=\\"200\\" />\\n\\n\u53ef\u4ee5\u770b\u5230 0.1+0.2 \u7684\u7ed3\u679c\u5e76\u4e0d\u662f 0.3\uff0c0.1+0.7 \u4e5f\u4e0d\u662f 0.8\uff0c\u662f\u4ec0\u4e48\u95ee\u9898\u5bfc\u81f4\u8fd9\u4e9b\u8bef\u5dee\u7684\u5462\uff1f\\n\\n#### 2. \u95ee\u9898\u539f\u56e0\\n\\n\u6211\u4eec\u77e5\u9053\u8ba1\u7b97\u673a\u53ea\u4f1a\u8fdb\u884c\u4e8c\u8fdb\u5236\u8ba1\u7b97\uff0c\u6240\u4ee5\u5341\u8fdb\u5236\u9700\u8981\u8f6c\u6362\u6210\u4e8c\u8fdb\u5236\u3002\u4f46\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5341\u8fdb\u5236\u5c0f\u6570\u90e8\u5206\u5982\u679c\u8f6c\u6362\u6210\u4e8c\u8fdb\u5236\uff0c\u4f1a\u5b58\u5728**\u65e0\u9650\u5faa\u73af**\u7684\u60c5\u51b5\\n\\n\u6bd4\u5982\uff1a\\n\\n0.3 \u8f6c\u6362\u4e3a\u4e8c\u8fdb\u5236\\n\\n<img src={require(\\"./assets/screenshots/10.png\\").default} width=\\"300\\" />\\n\\n0.1 \u8f6c\u6362\u4e3a\u4e8c\u8fdb\u5236\\n\\n<img src={require(\\"./assets/screenshots/11.png\\").default} width=\\"300\\" />\\n\\n\u4e8c\u8fdb\u5236\u5c0f\u6570\u5b58\u5728\u65e0\u9650\u5faa\u73af\uff0c\u800c\u8ba1\u7b97\u673a\u7684\u5b58\u50a8\u7a7a\u95f4\u662f\u6709\u9650\u7684\uff0c\u4e0d\u53ef\u80fd\u65e0\u9650\u7684\u5b58\u50a8\u4e0b\u53bb\uff0c\u6240\u4ee5\u53ea\u80fd\u5b58\u50a8\u4e00\u90e8\u5206\u957f\u5ea6\uff0c\u4e5f\u5c31\u662f\u8bf4**\u65e0\u9650\u5faa\u73af\u90e8\u5206\u4f1a\u88ab\u622a\u65ad**\uff0c\u5b58\u50a8\u8d77\u6765\u7684\u5c06\u4f1a\u662f\u4e00\u4e2a**\u8fd1\u4f3c\u503c**\\n\\n> \u5728[IEEE 754 \u6807\u51c6](https://en.wikipedia.org/wiki/IEEE_754)\u4e0b\u5c0f\u6570\u90e8\u5206\u957f\u5ea6\u6700\u5927\u4e3a 52 \u4f4d\uff0c\u5982\u679c\u7b2c 53 \u4f4d\u4e3a 1 \u4f1a\u8fdb\u884c\u56db\u820d\u4e94\u5165\uff0c\u5176\u4ed6\u60c5\u51b5\u4f1a\u76f4\u63a5\u622a\u65ad\\n\\n\u4e5f\u5c31\u662f\u8bf4 **0.1(\u5341\u8fdb\u5236 0.1) \u2248 00111111 10111001 10011001 10011001 10011001 10011001 10011001 10011010(64 \u7cbe\u5ea6\u4e0b\u50a8\u5b58\u7684\u4e8c\u8fdb\u5236 0.1)**\\n\\n\u4e24\u4e2a**\u8fd1\u4f3c\u503c**\u76f8\u52a0\u5f97\u51fa\u6765\u4e5f\u4f1a\u662f\u4e00\u4e2a**\u8fd1\u4f3c\u503c**\uff0c\u81ea\u7136\u4f1a\u5b58\u5728\u504f\u5dee\\n\\n#### 3. \u5c0f\u6570\u7684\u6700\u5c0f\u7cbe\u5ea6\\n\\n\u6700\u5c0f\u7cbe\u5ea6\u6307\u7684\u662f\u6700\u540e\u4e00\u4f4d\u4e0a\u7684\u5355\u4f4d\u503c\uff0c\u4e5f\u5c31\u662f\u8bf4\u8981\u60f3\u77e5\u9053\u5c0f\u6570\u6700\u5c0f\u7cbe\u5ea6\uff0c\u5c31\u5fc5\u987b\u627e\u51fa**\u9664 0 \u548c\u8d1f\u6570\u5916**\u6700\u5c0f\u7684\u6570\\n\\n\u6309\u7167\u6807\u51c6\uff0c\u5c0f\u6570\u957f\u5ea6\u6700\u591a\u4e3a 52 \u4f4d\uff0c\u5c0f\u6570\u4f4d\u4e0e\u6574\u6570\u4f4d\u76f8\u53cd\uff0c\u8d8a\u5f80\u53f3\u4f4d\u6570\u4ee3\u8868\u7684\u6570\u8d8a\u5c0f\uff0c\u6240\u4ee5\u5c0f\u6570\u4f4d\u80fd\u8868\u793a\u7684\u6700\u5c0f\u6570\u4e3a\uff1a\\n\\n> 00000000 00000000 00000000 00000000 00000000 00000000 0001\\n\\n\u4e5f\u5c31\u662f 2^-52(2 \u7684-52 \u6b21\u65b9)\uff0c\u8ba1\u7b97\u5668\u91cc\u7b97\u51fa\u7ed3\u679c\u4e3a\\n\\n<img src={require(\\"./assets/screenshots/12.png\\").default} width=\\"300\\" />\\n\\n\u7ea6\u4e3a 2.22\\\\*10^-16\uff0c\u4e5f\u5c31\u662f\u8bf4\u7cbe\u786e\u5230\u5c0f\u6570\u70b9\u540e 15 \u4f4d\uff0c\u52a0\u4e0a\u4e2a\u4f4d\u6709\u6548\u4f4d\u6570\u4e3a 16 \u4f4d\u4e5f\u5c31\u662f\u6700\u5c0f\u7cbe\u5ea6\\n\\n#### 4. \u4e3a\u4ec0\u4e48 0.1+0.3 \u80fd\u5f97\u51fa 0.4\uff1f\\n\\n\u4e0a\u9762\u8bf4\u5230\u8fd1\u4f3c\u503c\u52a0\u8fd1\u4f3c\u503c\u8fd8\u662f\u4e2a\u8fd1\u4f3c\u503c\uff0c\u90a3\u4e3a\u4ec0\u4e48 js \u91cc\u5927\u90e8\u5206\u7684\u5c0f\u6570\u52a0\u51cf\u4e58\u9664\u5374\u80fd\u5f97\u5230\u51c6\u786e\u7684\u6570\u503c\uff0c\u6bd4\u5982 0.1 + 0.3 === 0.4\uff1f\\n\\n\u539f\u56e0\u5728\u4e8e\u53cc\u7cbe\u5ea6\u6d6e\u70b9\u6570\u662f\u6709\u6700\u5c0f\u7cbe\u5ea6\u7684\uff0c\u53ea\u80fd\u7cbe\u786e\u5230\u5341\u8fdb\u5236\u5c0f\u6570\u70b9\u540e 15 \u4f4d\uff0c\u518d\u5f80\u540e\u5c31\u662f\u4e0d\u51c6\u786e\u7684\u4e86\uff0c\u800c js \u7528\u4f7f\u7528\u540e 16 \u4f4d\u8fdb\u884c\u56db\u820d\u4e94\u5165\u5904\u7406\\n\\n- \u7406\u8bba\u4e0a\uff1a0.1 + 0.3 \u2248 0.4\\n- \u7ecf\u8fc7 16 \u4f4d\u7cbe\u5ea6\u7684\u56db\u820d\u4e94\u5165\u540e\uff1a0.1 + 0.3 === 0.4\\n\\n**\u7ed3\u679c\u7684\u8bef\u5dee\u5728 16 \u4f4d\u4e4b\u5916**\u6216\u8005**\u56db\u820d\u4e94\u5165\u540e\u5f97\u5230\u6b63\u786e\u7684\u7ed3\u679c**\uff0c\u8fd9\u5c31\u662f\u5927\u90e8\u5206\u5c0f\u6570\u80fd\u591f\u5f97\u51fa\u6b63\u786e\u7ed3\u679c\u7684\u539f\u56e0"},{"id":"/2020/10/10/tasks_and_microtasks","metadata":{"permalink":"/blog/2020/10/10/tasks_and_microtasks","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-10-10-tasks_and_microtasks.md","source":"@site/blog/2020-10-10-tasks_and_microtasks.md","title":"\u5b8f\u4efb\u52a1\u548c\u5fae\u4efb\u52a1","description":"\u5b8f\u4efb\u52a1\u548c\u5fae\u4efb\u52a1","date":"2020-10-10T00:00:00.000Z","formattedDate":"2020\u5e7410\u670810\u65e5","tags":[],"readingTime":2.645,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u5b8f\u4efb\u52a1\u548c\u5fae\u4efb\u52a1","authors":"youniaogu","date":"2020-10-10T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u6d6e\u70b9\u6570\u8ba1\u7b97\u95ee\u9898","permalink":"/blog/2020/10/10/floating_point_calculation_problem"},"nextItem":{"title":"\u7f51\u683c\u5e03\u5c40","permalink":"/blog/2020/09/22/grid_layout"}},"content":"### \u5b8f\u4efb\u52a1\u548c\u5fae\u4efb\u52a1\\n\\n\u53c2\u8003\u8d44\u6599\uff1a[Jake Archibald: \u5728\u5faa\u73af - JSConf.Asia](https://www.youtube.com/watch?v=cCOL7MC4Pl0)\uff0c\u91cc\u9762\u5173\u4e8e**V8 \u7684\u4e8b\u4ef6\u5faa\u73af\u3001\u4e3b\u7ebf\u7a0b\u3001\u5b8f\u4efb\u52a1\u3001\u5fae\u4efb\u52a1**\u8bb2\u7684\u7279\u522b\u8be6\u7ec6\uff0c\u5982\u679c\u6709\u80fd\u529b\u5efa\u8bae\u76f4\u63a5\u770b\u89c6\u9891\\n\\n#### 1. \u4e8b\u4ef6\u5faa\u73af\\n\\n\u4e00\u4e2a\u4e8b\u4ef6\u5faa\u73af\u53ef\u4ee5\u7b80\u5355\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u5b8f\u4efb\u52a1(tasks)\u548c\u5fae\u4efb\u52a1(microtasks)\\n\\n<img src={require(\\"./assets/screenshots/13.png\\").default} width=\\"400\\" />\\n\\n\u5b83\u4eec\u4e4b\u95f4\u6709\u7740\u91cd\u8981\u7684\u89c4\u5219\uff0c\u4e0b\u9762\u5148\u653e\u51fa\u7ed3\u8bba\uff1a\\n\\n- **\u5b8f\u4efb\u52a1\u4f1a\u4f18\u5148\u8fdb\u5165\u4efb\u52a1\u6808\u5e76\u4e14\u6267\u884c\uff0c\u5fae\u4efb\u52a1\u653e\u5728\u5fae\u4efb\u52a1\u6808\uff0c\u53ea\u6709\u5728\u4efb\u52a1\u6808\u4e3a\u7a7a\u65f6\u8fdb\u5165**\u3002\\n- **\u5f53\u524d\u5b8f\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5\u4efb\u52a1\u6808\u4e3a\u7a7a\u540e\uff0c\u540e\u7eed\u5b8f\u4efb\u52a1\u4f1a\u653e\u5230\u4e0b\u4e00\u4e2a\u4e8b\u4ef6\u5faa\u73af\u4e2d\u6267\u884c**\\n\\n#### 2. \u4e3e\u4e2a \ud83c\udf30\\n\\n```javascript\\nsetTimeout(() => {\\n  console.log(1);\\n}, 0);\\n\\nPromise.resolve().then(() => {\\n  console.log(2);\\n});\\n```\\n\\n\u76f8\u4fe1\u5f88\u591a\u4eba\u90fd\u77e5\u9053\u4e0a\u9762\u8fd9\u9053\u9898\u7684\u7b54\u6848\uff0c\u95ee\u9898\u662f\u4e3a\u4ec0\u4e48 Promise \u4f1a\u6bd4 setTimeout \u5feb\uff1f\\n\\n\u5982\u679c\u4e0d\u77e5\u9053\u5b8f\u5fae\u4efb\u52a1\uff0c\u53ea\u77e5\u9053\u7684 js \u5355\u7ebf\u7a0b\uff0c\u4f7f\u7528\u4e8b\u4ef6\u5faa\u73af\u5b9e\u73b0\u5f02\u6b65\uff0c\u5f88\u53ef\u80fd\u4f1a\u4ee5\u4e3a setTimeout \u548c promise \u90fd\u5728 Event Loop 2 \u4e2d\u6267\u884c\uff0c\u6839\u636e\u5148\u540e\u987a\u5e8f\uff0c\u5f97\u51fa\u7b54\u6848\u662f`1 2`\uff0c\u4ee5\u524d\u6211\u4e5f\u662f\u8fd9\u4e48\u8ba4\u4e3a\\n\\n<img src={require(\\"./assets/screenshots/14.png\\").default} width=\\"400\\" />\\n\\n\u4e8b\u5b9e\u4e0a promise \u5e76\u4e0d\u5728 Event Loop 2 \u4e2d\uff0c\u800c\u662f\u5728 Event Loop 1 \u7684**\u5fae\u4efb\u52a1\u4e2d**\\n\\n<img src={require(\\"./assets/screenshots/15.png\\").default} width=\\"400\\" />\\n\\n\u5728[\u89c6\u9891](https://youtu.be/cCOL7MC4Pl0?t=1803)\u4e2d\u6709\u4e00\u9053\u5341\u5206\u6709\u8da3\u7684\u9898\uff1a\\n\\n<img src={require(\\"./assets/screenshots/16.png\\").default} width=\\"600\\" />\\n\\n\u5f53\u6211\u4eec\u70b9\u51fb\u6309\u94ae\uff0c\u4f1a\u8f93\u51fa\u4ec0\u4e48\uff1f\\n\\n\u4e0b\u9762\u662f\u70b9\u51fb\u6309\u94ae\u540e\u7684\u4e8b\u4ef6\u5faa\u73af\u56fe\uff0c\u5728\u7b2c\u4e00\u4e2a\u76d1\u542c\u51fd\u6570\u91cc\uff0c\u5148\u662f\u628a`Microtasks 1`\u653e\u5165\u4e86\u5fae\u4efb\u52a1\u6808\uff0c\u4ee5\u53ca`Listener 1`\u5b8f\u4efb\u52a1\u653e\u5165\u4efb\u52a1\u6808\u91cc\uff0c\u5b8c\u6210\u4efb\u52a1\u540e\u6808\u7a7a\uff0c\u7ee7\u800c\u6267\u884c`Microtasks 1`\uff0c\u7b2c\u4e8c\u4e2a\u76d1\u542c\u51fd\u6570\u7c7b\u4f3c\uff0c\u6240\u4ee5\u4f1a\u4f9d\u6b21\u8f93\u51fa`Listener 1\u3001Microtasks 1\u3001Listener 2\u3001Microtasks 2`\\n\\n<img src={require(\\"./assets/screenshots/17.png\\").default} width=\\"600\\" />\\n\\n\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff1a\\n\\n<img src={require(\\"./assets/screenshots/18.png\\").default} width=\\"600\\" />\\n\\n\u6211\u4eec\u4f7f\u7528 js \u53bb\u89e6\u53d1\u6309\u94ae\u70b9\u51fb\u4e8b\u4ef6\uff0c\u4f1a\u8f93\u51fa\u4ec0\u4e48\uff1f\\n\\n\u4e0b\u9762\u540c\u6837\u662f\u70b9\u51fb\u6309\u94ae\u540e\u7684\u4e8b\u4ef6\u5faa\u73af\u56fe\uff0c\u4f46\u4e0d\u540c\u7684\u662f\u89e6\u53d1`Script`\u540e\u53ea\u6709`Listener 1`\u548c`Listener 2`\u6267\u884c\u5b8c\u6bd5\u540e`Script`\u624d\u4f1a\u6267\u884c\u5b8c\u6210\uff0c\u624d\u80fd\u8fdb\u884c\u5fae\u4efb\u52a1\u7684\u6267\u884c\uff0c\u6240\u4ee5\u6267\u884c\u7684\u7ed3\u679c\u662f`Listener 1\u3001Listener 2\u3001Microtasks 1\u3001Microtasks 2`\\n\\n<img src={require(\\"./assets/screenshots/19.png\\").default} width=\\"600\\" />"},{"id":"/2020/09/22/grid_layout","metadata":{"permalink":"/blog/2020/09/22/grid_layout","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-09-22-grid_layout.md","source":"@site/blog/2020-09-22-grid_layout.md","title":"\u7f51\u683c\u5e03\u5c40","description":"\u7f51\u683c\u5e03\u5c40","date":"2020-09-22T00:00:00.000Z","formattedDate":"2020\u5e749\u670822\u65e5","tags":[],"readingTime":4.615,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u7f51\u683c\u5e03\u5c40","authors":"youniaogu","date":"2020-09-22T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u5b8f\u4efb\u52a1\u548c\u5fae\u4efb\u52a1","permalink":"/blog/2020/10/10/tasks_and_microtasks"},"nextItem":{"title":"\u9632\u6296\u548c\u8282\u6d41","permalink":"/blog/2020/09/21/debounce_and_throttle"}},"content":"### \u7f51\u683c\u5e03\u5c40\\n\\nMDN \u91cc\u5bf9 grid \u7684\u4ecb\u7ecd\u548c\u5bf9\u6bd4\u5176\u4ed6\u5e03\u5c40\u8bb2\u89e3\u7684\u5341\u5206\u8be6\u7ec6\uff0c\u60f3\u4ed4\u7ec6\u5b66\u4e60\u7684\u5efa\u8bae\u70b9\u8fdb\u4e0b\u9762\u7684\u94fe\u63a5\\n\\n[\u7f51\u683c\u5e03\u5c40\u7684\u57fa\u672c\u6982\u5ff5](https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Grid_Layout/Basic_Concepts_of_Grid_Layout)\\n\\n[grid layout \u548c\u5176\u5b83\u5e03\u5c40\u65b9\u6cd5\u7684\u8054\u7cfb](https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Grid_Layout/Relationship_of_Grid_Layout)\\n\\n\u4e0b\u9762\u90e8\u5206\u662f\u6211\u5bf9\u94fe\u63a5\u91cc\u91cd\u8981\u5185\u5bb9\u7684\u622a\u53d6\uff0c\u4ee5\u53ca\u81ea\u5df1\u7684\u7406\u89e3\\n\\n#### 1. CSS \u7f51\u683c\u5e03\u5c40\u548c\u5f39\u6027\u76d2\u5e03\u5c40\u7684\u533a\u522b\\n\\n**CSS \u7f51\u683c\u5e03\u5c40**\u548c**\u5f39\u6027\u76d2\u5e03\u5c40**\u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e[\u5f39\u6027\u76d2\u5e03\u5c40](https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Flexible_Box_Layout)\u662f\u4e3a\u4e00\u7ef4\u5e03\u5c40\u670d\u52a1\u7684\uff08\u6cbf\u6a2a\u5411\u6216\u7eb5\u5411\u7684\uff09\uff0c\u800c\u7f51\u683c\u5e03\u5c40\u662f\u4e3a\u4e8c\u7ef4\u5e03\u5c40\u670d\u52a1\u7684\uff08\u540c\u65f6\u6cbf\u7740\u6a2a\u5411\u548c\u7eb5\u5411\uff09\u3002\u8fd9\u4e24\u4e2a\u89c4\u683c\u6709\u4e00\u4e9b\u76f8\u540c\u7684\u7279\u6027\u3002\u5982\u679c\u4f60\u5df2\u7ecf\u638c\u63e1\u5982\u4f55\u4f7f\u7528\u5f39\u6027\u76d2\u5e03\u5c40\u7684\u8bdd\uff0c\u4f60\u53ef\u80fd\u4f1a\u60f3\u77e5\u9053\u8fd9\u4e9b\u76f8\u4f3c\u4e4b\u5904\u600e\u6837\u5728\u80fd\u5e2e\u52a9\u4f60\u638c\u63e1\u7f51\u683c\u5e03\u5c40\\n\\nCSS \u7f51\u683c\u5728\u5bf9 row \u8fdb\u884c\u63a7\u5236\u7684\u540c\u65f6\uff0c\u8fd8\u80fd\u63a7\u5236 column\uff0c\u800c\u5f39\u6027\u76d2\u53ea\u80fd\u63a7\u5236 row \u6216 column\uff0c\u8fd9\u4e5f\u662f\u5f39\u6027\u76d2\u7684\u4e00\u5927\u4e0d\u8db3\\n\\n\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5b9e\u73b0 3 \u884c 3 \u5217\u5e03\u5c40\uff0c\u8981\u6c42\u884c\u4e0d\u6ee1 3 \u4e2a\u65f6\u5de6\u5bf9\u5176\uff1a\\n\\n<img src={require(\\"./assets/screenshots/4.png\\").default} width=\'500\' />\\n\\n\u8fd9\u65f6 Flexbox \u5c31\u4f1a\u6709\u4e2a\u5e38\u89c1\u95ee\u9898\uff0c\u600e\u6837\u624d\u80fd\u8ba9\u6700\u540e\u4e00\u884c\u5355\u72ec\u5de6\u5bf9\u5176\u5462\uff1f\\n\\n\u8fd9\u4e2a\u95ee\u9898\u5728 Flexbox \u4e0a\u5e76\u4e0d\u662f\u65e0\u89e3\uff0c\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a\\n\\n- justify-content \u4f7f\u7528 flex-start\uff0c\u8ba1\u7b97\u5404\u4e2a\u5b50\u5143\u7d20\u7684 width\u3001margin\uff0c\u8ba9\u5b83\u521a\u597d 3 \u4e2a\u65f6\u6362\u884c\\n\\n- justify-content \u4f7f\u7528 space-between\uff0c\u5728\u672b\u5c3e\u884c\u4e0d\u6ee1\u65f6\u6dfb\u52a0\u586b\u5145\uff0c\u8ba9\u5176\u6309 3 \u4e2a\u5143\u7d20\u8fdb\u884c\u5206\u5272\\n\\ngrid \u7684\u8bdd\u5f88\u7b80\u5355\uff1a\\n\\n- \u8bbe\u5b9a grid-template-columns \u5c5e\u6027\u4e3a repeat(3, 1fr)\u5373\u53ef\\n\\n\u53ef\u4ee5\u770b\u5230\uff0cflex \u867d\u7136\u4e5f\u80fd\u5b9e\u73b0\uff0c\u4f46\u76f8\u6bd4 grid \u6765\u8bf4\u6bd4\u8f83\u590d\u6742\\n\\n#### 2. \u4f7f\u7528 auto-fit \u548c minmax \u6a21\u62df flex\\n\\ngrid-template-columns: repeat(auto-fit, minmax(100px, 1fr))\u76f8\u5f53\u4e8e flex: 1 0 100px;\\n\\ngrid-template-columns: repeat(auto-fit, minmax(0, 100px))\u76f8\u5f53\u4e8e flex: 0 1 100px;\\n\\ngrid-template-columns: repeat(auto-fit, minmax(0, 1fr))\u76f8\u5f53\u4e8e flex: 1 1 auto;\\n\\n#### 3. auto-fill \u548c auto-fit \u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f\\n\\nauto-fill \u4f1a\u4fdd\u7559\u540e\u9762\u7684\u533f\u540d\u683c\u5b50\uff0cauto-fit \u5219\u4e0d\u4f1a\\n\\n\u4e3e\u4e2a \ud83c\udf30\uff1a\\n\\n\u5916\u5c42\u662f\u4e2a\u5bbd\u5ea6\u4e3a 450px \u5bb9\u5668\uff0ccolumn \u4f7f\u7528 repeat(auto-fill, minmax(100px,1fr))\uff0c\u5b50\u5143\u7d20\u521d\u59cb\u5bbd\u5ea6\u4e3a 100px\uff0c\u4e00\u5171\u4e09\u4e2a\uff0c\u8fd9\u65f6\u5bb9\u5668\u6709\u591a\u4f59\u7684 150px\\n\\n<img src={require(\\"./assets/screenshots/5.png\\").default} width=\'300\' />\\n\\n\u4f7f\u7528 auto-fill \u7684\u8bdd\uff0c\u4f1a\u591a\u751f\u6210 1 \u4e2a 100px \u5bbd\u5ea6\u7684\u533f\u540d\u683c\u5b50\uff0c\u4e5f\u5c31\u662f\u7ea2\u8272\u6807\u6ce8\u7684 4\uff0c\u518d\u53bb\u5206\u914d\u5269\u4e0b\u7684 50px \u5bbd\u5ea6\uff0c\u8ba1\u7b97\u4e0b\u6765\u6bcf\u4e2a\u5b50\u5143\u7d20\u5bbd\u5ea6\u4e3a 112.5px\\n\\n<img src={require(\\"./assets/screenshots/6.png\\").default} width=\'300\' />\\n\\n\u4f7f\u7528 auto-fit \u7684\u8bdd\uff0c\u5219\u4f1a\u76f4\u63a5\u5206\u5272\u591a\u4f59\u7684 150px\uff0c\u8fd9\u6837\u6bcf\u4e2a\u5b50\u5143\u7d20\u5bbd\u5ea6\u4e3a 150px\\n\\n> auto-fit \u66f4\u8d34\u8fd1 flex \u7684\u7279\u6027\\n\\n#### 4. \u6211\u8be5\u7528\u54ea\u4e2a\uff1f\\n\\n\u5f53\u6289\u62e9\u8be5\u7528\u7f51\u683c\u8fd8\u662f\u5f39\u6027\u76d2\u65f6\uff0c\u4f60\u53ef\u4ee5\u95ee\u81ea\u5df1\u4e00\u4e2a\u7b80\u5355\u7684\u95ee\u9898\uff1a\\n\\n- \u6211\u53ea\u9700\u8981\u6309\u884c\u6216\u8005\u5217\u63a7\u5236\u5e03\u5c40\uff1f\u90a3\u5c31\u7528\u5f39\u6027\u76d2\u5b50\\n- \u6211\u9700\u8981\u540c\u65f6\u6309\u884c\u548c\u5217\u63a7\u5236\u5e03\u5c40\uff1f\u90a3\u5c31\u7528\u7f51\u683c\\n\\n\u9664\u4e86\u6ee1\u8db3\u5e03\u5c40\u9700\u6c42\u5916\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u8003\u8651\u6d4f\u89c8\u5668\u517c\u5bb9\u6027\\n\\n<img src={require(\\"./assets/screenshots/8.png\\").default} width=\'500\' />\\n<img src={require(\\"./assets/screenshots/7.png\\").default} width=\'300\' />\\n\\n\u53ef\u4ee5\u770b\u5230\u7f51\u683c\u5e03\u5c40\u4e0d\u517c\u5bb9 IE\uff0c\u5b89\u5353 UC\u3001Opera Mini \u672a\u77e5\uff0cFirefox \u5b58\u5728 **bug**\uff0c**column \u91cc repeat()\u4e0d\u80fd\u91cd\u590d\u4f7f\u7528**\\n\\n\u5982\u679c\u9879\u76ee\u5bf9\u4e8e\u517c\u5bb9\u6027\u8981\u6c42\u6ca1\u6709\u90a3\u4e48\u4e25\u683c\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528\u7f51\u683c\u5e03\u5c40\uff0c\u7f51\u9875\u7ed3\u6784\u590d\u6742\u7684\u60c5\u51b5\u4e0b\uff0c\u76f8\u6bd4\u5f39\u6027\u76d2\u5e03\u5c40\u80fd\u591f\u7528\u66f4\u5c11\u7684\u5143\u7d20\u5b8c\u6210\u5e03\u5c40\uff08\u6ce8\u610f\u907f\u5f00 Firefox \u4e0a\u7684 bug\uff0c\u4e0d\u8981\u91cd\u590d\u4f7f\u7528 repeat()\uff09\\n\\n#### 5. \u76d2\u5bf9\u9f50\\n\\n\u5f39\u6027\u76d2\u7279\u6027\u5df2\u7ecf\u88ab\u52a0\u5165\u5230\u65b0\u89c4\u8303\u76d2[Box Alignment Level 3](https://drafts.csswg.org/css-align/)\u3002\u610f\u5473\u5b83\u4eec\u80fd\u88ab\u7528\u5728\u5305\u62ec\u7f51\u683c\u5e03\u5c40\u7684\u5176\u5b83\u89c4\u8303\u4e2d\u3002\u5b83\u4eec\u672a\u6765\u4e5f\u53ef\u80fd\u88ab\u7528\u5728\u5176\u4ed6\u7684\u5e03\u5c40\u65b9\u6cd5\u4e2d\\n\\n\u7b80\u5355\u7684\u8bf4\uff0c\u5c31\u662f\u4f60\u53ef\u4ee5\u5728\u7f51\u683c\u5e03\u5c40\u91cc\u4f7f\u7528 align-item\u3001align-content\u3001align-self\u3001justify-item\u3001justify-content\u3001justify-self \u7b49\u5c5e\u6027\uff0c\u53ef\u4ee5\u8bf4\u7f51\u683c\u5e03\u5c40\u7684\u80fd\u529b\u548c\u591a\u6837\u6027\u88ab\u5927\u5927\u52a0\u5f3a"},{"id":"/2020/09/21/debounce_and_throttle","metadata":{"permalink":"/blog/2020/09/21/debounce_and_throttle","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-09-21-debounce_and_throttle.md","source":"@site/blog/2020-09-21-debounce_and_throttle.md","title":"\u9632\u6296\u548c\u8282\u6d41","description":"\u9632\u6296\u548c\u8282\u6d41","date":"2020-09-21T00:00:00.000Z","formattedDate":"2020\u5e749\u670821\u65e5","tags":[],"readingTime":1.66,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u9632\u6296\u548c\u8282\u6d41","authors":"youniaogu","date":"2020-09-21T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u7f51\u683c\u5e03\u5c40","permalink":"/blog/2020/09/22/grid_layout"},"nextItem":{"title":"\u9762\u8bd5\u9898\u6c47\u603b","permalink":"/blog/2020/09/21/interview_questions"}},"content":"### \u9632\u6296\u548c\u8282\u6d41\\n\\n\u9632\u6296\u548c\u8282\u6d41\u662f js \u5904\u7406\u9ad8\u9891\u4e8b\u4ef6\u51fd\u6570\u65f6\u7ecf\u5e38\u4f1a\u7528\u5230\uff0c\u901a\u8fc7\u964d\u4f4e\u51fd\u6570\u7684\u6267\u884c\u6b21\u6570\u8fbe\u5230\u8282\u7ea6\u8d44\u6e90\u7684\u76ee\u7684\uff0c\u662f\u524d\u7aef\u5e38\u7528\u7684\u4e00\u79cd\u4f18\u5316\u624b\u6bb5\\n\\n- \u9632\u6296\uff1a\u5ef6\u8fdf\u4e8b\u4ef6\u51fd\u6570\uff0cn \u79d2\u540e\u6267\u884c\uff0c\u5982\u679c n \u79d2\u5185\u4e8b\u4ef6\u53c8\u88ab\u89e6\u53d1\u65f6\u91cd\u65b0\u8ba1\u65f6\\n- \u8282\u6d41\uff1a\u4e8b\u4ef6\u51fd\u6570 n \u79d2\u5185\u53ea\u80fd\u6267\u884c\u4e00\u6b21\uff0c\u6267\u884c\u5b8c\u540e\u5012\u8ba1\u65f6\u5f00\u59cb\\n\\n#### 1. \u9632\u6296\\n\\n```javascript\\nfunction debounce(timescope) {\\n  return function (fn) {\\n    let timeout = null;\\n\\n    return function () {\\n      if (timeout) {\\n        clearTimeout(timeout);\\n      }\\n\\n      timeout = setTimeout(() => {\\n        fn.apply(this, arguments);\\n      }, timescope);\\n    };\\n  };\\n}\\n```\\n\\n#### 2. \u8282\u6d41\\n\\n```javascript\\nfunction throttle(timescope) {\\n  return function (fn) {\\n    let cooldown = false;\\n\\n    return function () {\\n      if (cooldown) {\\n        return;\\n      }\\n\\n      cooldown = true;\\n      fn.apply(this.arguments);\\n\\n      setTimeout(() => {\\n        cooldown = false;\\n      }, timescope);\\n    };\\n  };\\n}\\n```\\n\\n#### 3. \u6bd4\u8f83\\n\\n\u9632\u6296\u548c\u8282\u6d41\u7684\u533a\u522b\u5728\u4e8e\uff1a\\n\\n1. \u662f\u5426\u5ef6\u8fdf\u4e8b\u4ef6\u51fd\u6570\u6267\u884c\\n2. \u91cd\u590d\u89e6\u53d1\u4e8b\u4ef6\u51fd\u6570\u662f\u5426\u91cd\u65b0\u5012\u8ba1\u65f6\\n\\n\u76f8\u540c\u70b9\uff1a\\n\\n1. \u90fd\u662f\u4e3a\u4e86\u964d\u4f4e\u4e8b\u4ef6\u51fd\u6570\u6267\u884c\u7684\u9891\u7387\\n\\n#### 4. \u5e94\u7528\u573a\u666f\\n\\n- input \u6846\u9700\u8981\u6839\u636e\u8f93\u5165\u7684\u5185\u5bb9\u5b9e\u65f6\u67e5\u8be2\u7ed3\u679c\uff0c\u53ef\u4ee5\u5728\u8f93\u5165\u505c\u6b62\u4e00\u6bb5\u65f6\u95f4\u540e\u518d\u8fdb\u884c\u67e5\u8be2\uff0c\u8fd9\u662f\u9632\u6296\\n- \u70b9\u51fb\u6309\u94ae\u63d0\u4ea4\u8868\u5355\u65f6\uff0c\u4e3a\u4e86\u9632\u6b62\u91cd\u590d\u63d0\u4ea4\uff0c\u4e00\u6bb5\u65f6\u95f4\u5185\u6216\u8005\u5230\u63d0\u4ea4\u5b8c\u6210\u524d\u4e0d\u5141\u8bb8\u63d0\u4ea4\uff0c\u8fd9\u662f\u8282\u6d41"},{"id":"/2020/09/21/interview_questions","metadata":{"permalink":"/blog/2020/09/21/interview_questions","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-09-21-interview_questions.md","source":"@site/blog/2020-09-21-interview_questions.md","title":"\u9762\u8bd5\u9898\u6c47\u603b","description":"\u9762\u8bd5\u9898\u6c47\u603b","date":"2020-09-21T00:00:00.000Z","formattedDate":"2020\u5e749\u670821\u65e5","tags":[],"readingTime":4.175,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u9762\u8bd5\u9898\u6c47\u603b","authors":"youniaogu","date":"2020-09-21T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u9632\u6296\u548c\u8282\u6d41","permalink":"/blog/2020/09/21/debounce_and_throttle"},"nextItem":{"title":"react-router-dom \u7b80\u5355\u8bb2\u89e3","permalink":"/blog/2020/09/16/the_simple_react-router-dom"}},"content":"### \u9762\u8bd5\u9898\u6c47\u603b\\n\\n#### 1. \u5b9e\u73b0 New \u5173\u952e\u5b57\\n\\n```javascript\\nfunction New(fn, ...args) {\\n  let obj = {};\\n\\n  obj.__proto__ = fn.prototype;\\n\\n  const ret = fn.apply(this, args);\\n\\n  if (ret instanceof Object) {\\n    return ret;\\n  }\\n\\n  return obj;\\n}\\n```\\n\\n#### 2. [Array.prototype.flat](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/flat)\\n\\nflat \u7684\u4f5c\u7528\u662f\u6839\u636e\u6307\u5b9a\u7684\u6570\u7ec4\u6df1\u5ea6\u644a\u5e73\u6570\u7ec4\uff0c\u53ef\u4ee5\u4f7f\u7528 [Infinity](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Infinity)(\u65e0\u7a77\u5927)\u5c55\u5f00\u4efb\u610f\u6df1\u5ea6\u7684\u6570\u7ec4\\n\\n```javascript\\nvar newArray = arr.flat([depth]);\\n```\\n\\ndepth \u6df1\u5ea6\u662f\u53ef\u9009\uff0c\u9ed8\u8ba4\u4e3a 1\\n\\n\u4e0b\u9762\u662f\u4f7f\u7528 concat \u548c reduce \u6a21\u62df\u7684 flat\\n\\n```javascript\\nvar arr1 = [1, 2, 3, [1, 2, 3, 4, [2, 3, 4]]];\\n\\nfunction flatDeep(arr, d = 1) {\\n  return d > 0\\n    ? arr.reduce(\\n        (acc, val) =>\\n          acc.concat(Array.isArray(val) ? flatDeep(val, d - 1) : val),\\n        []\\n      )\\n    : arr.slice();\\n}\\n\\nflatDeep(arr1, Infinity);\\n```\\n\\n#### 3. [\u4e0b\u9762\u7684\u4ee3\u7801\u6253\u5370\u4ec0\u4e48\u5185\u5bb9\uff0c\u4e3a\u4ec0\u4e48\uff1f](https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/48)\\n\\n```javascript\\nvar b = 10;\\n(function b() {\\n  b = 20;\\n  console.log(b);\\n})();\\n```\\n\\n- \u5177\u540d\u5e76\u4e14\u81ea\u6267\u884c\u51fd\u6570\uff0c\u51fd\u6570\u540d\u53ea\u8bfb(\u7c7b\u4f3c\u5e38\u91cf)\uff0c\u4e0d\u53ef\u4fee\u6539\\n- \u975e\u4e25\u683c\u6a21\u5f0f\u4e0b\u7ed9\u5e38\u91cf\u547d\u540d\u9759\u9ed8\u5931\u8d25\uff0c\u7b80\u5355\u6765\u8bf4`b = 20;`\u76f8\u5f53\u4e8e\u7ed9\u51fd\u6570 b \u8d4b\u503c\uff0c\u4e8e\u662f\u9759\u9ed8\u5931\u8d25\\n- \u4e25\u683c\u6a21\u5f0f\u4e0b\u7ed9\u5e38\u91cf\u547d\u540d\u62a5\u9519 TypeError\\n\\n<p></p>\\n\\n#### 4. \u4e8c\u5206\u67e5\u627e\\n\\n\u6ce8\u610f\uff1a\u4e8c\u5206\u67e5\u627e\u662f\u7279\u5b9a\u5728\u6709\u5e8f\u6570\u7ec4\u91cc\u624d\u80fd\u4f7f\u7528\u7684\u67e5\u627e\u7b97\u6cd5\\n\\n```javascript\\nconst a = [1, 3, 6, 7, 8, 11, 30, 60, 63, 90];\\n\\nfunction binaySearch(array, data) {\\n  const max = array.length - 1; // 9\\n  const mid = Math.floor(max / 2); // 4\\n\\n  if (max < 0) {\\n    return -1;\\n  }\\n\\n  if (array[mid] === data) {\\n    return data;\\n  }\\n\\n  if (array[mid] > data) {\\n    return binaySearch(array.slice(0, mid), data);\\n  } else {\\n    return binaySearch(array.slice(mid + 1, max + 1), data);\\n  }\\n}\\n\\na.forEach((data) => console.log(binaySearch(a, data)));\\n```\\n\\n#### 5. \u5192\u6ce1\u6392\u5e8f\\n\\n```javascript\\nArray.prototype.bubbleSort = function () {\\n  let isSorted = false;\\n\\n  for (let i = 0; i < this.length - 1; i++) {\\n    let haveSort = false;\\n\\n    if (isSorted) {\\n      return;\\n    }\\n\\n    for (let l = 0; l < this.length - 1 - i; l++) {\\n      if (this[l] > this[l + 1]) {\\n        const bigger = this[l];\\n        this[l] = this[l + 1];\\n        this[l + 1] = bigger;\\n        haveSort = true;\\n      }\\n    }\\n\\n    if (!haveSort) {\\n      isSorted = true;\\n    }\\n  }\\n};\\n```\\n\\n\u4f7f\u7528`haveSort`\u6807\u8bb0\u4e00\u6b21\u5192\u6ce1\u4e2d\u662f\u5426\u6709\u4e92\u6362\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u8868\u660e\u5217\u8868\u5df2\u7ecf\u662f\u6392\u5e8f\u5b8c\u6210\uff0c\u7ed3\u675f\u5192\u6ce1\\n\\n#### 6. \u63d2\u5165\u6392\u5e8f\\n\\n\u63d2\u5165\u6392\u5e8f\u5efa\u8bae\u7ed3\u5408\u4e0b\u56fe\u7406\u89e3\\n\\n![20.gif](./assets/screenshots/20.gif)\\n\\n\u5c06\u9009\u53d6\u7684\u6570\u63d2\u5165\u5230\u5df2\u7ecf\u6392\u5e8f\u597d\u7684\u6570\u7ec4\u91cc\\n\\n```javascript\\nArray.prototype.insertSort = function () {\\n  for (let i = 1; i < this.length; i++) {\\n    const current = this[i];\\n\\n    let l = i - 1;\\n    while (l >= 0 && current < this[l]) {\\n      this[l + 1] = this[l];\\n      l--;\\n    }\\n    this[l + 1] = current;\\n  }\\n};\\n```\\n\\n#### 7. \u9009\u62e9\u6392\u5e8f\\n\\n\u6bcf\u6b21\u904d\u5386\u9009\u62e9\u51fa\u6700\u5c0f\u7684\u90a3\u4e2a\u653e\u5728\u6700\u524d\u9762\\n\\n```javascript\\nArray.prototype.selectSort = function () {\\n  for (let i = 0; i < this.length - 1; i++) {\\n    let min = i;\\n\\n    for (let l = i + 1; l < this.length; l++) {\\n      if (this[l] < this[min]) {\\n        min = l;\\n      }\\n    }\\n\\n    if (min !== i) {\\n      const bigger = this[i];\\n      this[i] = this[min];\\n      this[min] = bigger;\\n    }\\n  }\\n};\\n```\\n\\n#### 8. \u5feb\u901f\u6392\u5e8f\\n\\n\u5728\u6570\u7ec4\u4e2d\u9009\u62e9\u4e00\u4e2a\u4f5c\u4e3a\u57fa\u51c6\uff0c\u5c06\u5c0f\u4e8e\u7684\u653e\u5728\u5de6\u8fb9\uff0c\u5927\u4e8e\u7684\u653e\u5728\u53f3\u8fb9\uff0c\u518d\u5206\u522b\u5bf9\u5de6\u8fb9\u548c\u53f3\u8fb9\u8fdb\u884c\u540c\u6837\u64cd\u4f5c\uff08\u9700\u8981\u7528\u5230\u9012\u5f52\uff09\\n\\n```javascript\\nArray.prototype.quickSort = function () {\\n  if (this.length <= 1) {\\n    return this;\\n  }\\n\\n  let mid = this[0],\\n    left = [],\\n    right = [];\\n\\n  for (let i = 1; i < this.length; i++) {\\n    if (this[i] <= mid) {\\n      left.push(this[i]);\\n    } else {\\n      right.push(this[i]);\\n    }\\n  }\\n\\n  return [].concat(left.quickSort()).concat(mid).concat(right.quickSort());\\n};\\n```\\n\\n#### 9. \u5b9e\u73b0 call,apply,bind\\n\\n```javascript\\nFunction.prototype.CALL = function (context, ...args) {\\n  context.fn = this;\\n  context.fn(...args);\\n\\n  delete context.fn;\\n};\\nFunction.prototype.APPLY = function (context, args) {\\n  context.fn = this;\\n  context.fn(...args);\\n\\n  delete context.fn;\\n};\\nFunction.prototype.BIND = function (context, ...args) {\\n  const self = this;\\n\\n  function RETURNFN(...bindArgs) {\\n    let contextOrThis = context;\\n    if (this instanceof RETURNFN) {\\n      contextOrThis = this;\\n    }\\n\\n    contextOrThis.fn = self;\\n    contextOrThis.fn(...args, ...bindArgs);\\n    delete contextOrThis.fn;\\n  }\\n\\n  RETURNFN.prototype = this.prototype;\\n  return RETURNFN;\\n};\\n```"},{"id":"/2020/09/16/the_simple_react-router-dom","metadata":{"permalink":"/blog/2020/09/16/the_simple_react-router-dom","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-09-16-the_simple_react-router-dom.md","source":"@site/blog/2020-09-16-the_simple_react-router-dom.md","title":"react-router-dom \u7b80\u5355\u8bb2\u89e3","description":"react-router-dom \u7b80\u5355\u8bb2\u89e3","date":"2020-09-16T00:00:00.000Z","formattedDate":"2020\u5e749\u670816\u65e5","tags":[],"readingTime":8.51,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"react-router-dom \u7b80\u5355\u8bb2\u89e3","authors":"youniaogu","date":"2020-09-16T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u9762\u8bd5\u9898\u6c47\u603b","permalink":"/blog/2020/09/21/interview_questions"},"nextItem":{"title":"\u524d\u7aef\u7248\u672c\u53f7\u5b9a\u4e49","permalink":"/blog/2020/09/14/version_of_fontend_project"}},"content":"### react-router-dom \u7b80\u5355\u8bb2\u89e3\\n\\n> \u793a\u4f8b demo\uff1a[github](https://github.com/youniaogu/simple-react-router-dom)\\n>\\n> \u672c\u6587\u4ee3\u7801\u6bd4\u8f83\u7c97\u7cd9\uff0c\u6709\u80fd\u529b\u5efa\u8bae\u81ea\u884c\u770b\u6e90\u7801\\n\\n#### 1. \u524d\u8a00\\n\\nreact-router-dom \u662f\u57fa\u4e8e`history`\u5e93\u5f00\u53d1\u7684 react \u8def\u7531\u7ba1\u7406\u5e93\uff0c\u8fd9\u91cc\u4e3b\u8981\u7b80\u5355\u8bb2\u89e3 react-router-dom \u7684 api\uff0c\u7406\u89e3\u4ed6\u4eec\u7684\u4f5c\u7528\u548c\u6d41\u7a0b\uff0c**\u800c`history`\u90e8\u5206\u5c06\u4e0d\u6df1\u5165\u8ba8\u8bba**\\n\\n> \u4e0b\u9762\u7684\u5b9e\u73b0\u548c\u8bb2\u89e3\u4e3b\u8981\u57fa\u4e8e class\uff0c\u65e0 hook \u90e8\u5206\\n\\n#### 2. api \u4ecb\u7ecd\\n\\nreact-router-dom \u4e3b\u8981\u6709`BrowserRouter`\u3001`HashRouter`\u3001`Router`\u3001`Switch`\u3001`Route`\u3001`Link`\u3001`Redirect`\u3001`withRouter` \u8fd9\u51e0\u4e2a\u5e38\u7528 api\uff0c\u5176\u4e2d `BrowserRouter`\u3001`HashRouter`\u662f`Router`\u5c01\u88c5\u540e\u7684 api\\n\\n- Router\uff1a\u63a5\u6536`history`\u5b9e\u4f8b\u5316\u540e\u7684\u5bf9\u8c61\uff0c\u7ed1\u5b9a`history`\u76d1\u542c\u51fd\u6570\uff0c\u5e76\u901a\u8fc7`context`\u4f20\u9012\u4e0b\u6765\\n- BrowserRouter | HashRouter\uff1a\u5206\u522b\u57fa\u4e8e`createBrowserHistory`\u548c`createHashHistory`\u5c01\u88c5\u540e\u7684`Router`\\n- Switch\uff1a\u4f1a\u6309\u987a\u5e8f\u4f9d\u6b21\u5339\u914d\uff0c\u53ea\u4f1a\u5c06\u7b2c\u4e00\u4e2a\u5339\u914d\u5230\u7684\u6e32\u67d3\u51fa\u53bb\\n- Route\uff1a\u6839\u636e\u8bbe\u5b9a\u7684 path \u5339\u914d\u5f53\u524d\u7684 pathname\uff0c\u5224\u65ad\u662f\u5426\u6e32\u67d3\u4f20\u9012\u7684 component \u6216\u8005 children\\n- Link\uff1a\u7c7b\u4f3c\u4e8e a \u6807\u7b7e\uff0c\u70b9\u51fb\u540e\u8fdb\u884c\u8def\u7531\u8df3\u8f6c\\n- Redirect\uff1a\u5f53\u7ec4\u4ef6\u6e32\u67d3\u65f6\u8fdb\u884c\u8def\u7531\u8df3\u8f6c\\n- withRouter\uff1a\u4e00\u4e2a\u9ad8\u9636\u7ec4\u4ef6\uff0c\u4e3a\u7ec4\u4ef6\u63d0\u4f9b`history`\u63a7\u5236 api\\n\\n> \u5b98\u65b9\u6587\u6863\u91cc\u5efa\u8bae Switch \u7684 children \u5e94\u5f53\u4e3a Route \u6216 Redirect \u7ec4\u4ef6\uff0c\u4f46\u5b9e\u9645\u5176\u5b83\u7ec4\u4ef6\u6216\u5143\u7d20\u4e5f\u662f\u53ef\u884c\u7684\uff0c\u540e\u9762\u4f1a\u8bf4\u660e\u539f\u56e0\\n\\n\u5176\u4e2d`BrowserRouter`\u3001`HashRouter`\u3001`Link`\u6765\u81ea react-router-dom\uff0c\u5176\u5b83 api \u90fd\u6765\u81ea react-router\uff0creact-router-dom \u53ea\u662f\u8fdb\u884c\u4e86\u8f6c\u63a5\u800c\u5df2\\n\\n\u53ea\u6240\u4ee5\u5206\u6210 react-router-dom \u548c react-router\uff0c\u662f\u56e0\u4e3a react-router \u4e0d\u6b62\u670d\u52a1\u4e8e**web**\uff0c\u8fd8\u6709**native**\u73af\u5883\uff0c\u901a\u7528\u7684 api \u653e\u5728\u4e86 react-router\uff0c\u800c\u57fa\u4e8e web \u7279\u5b9a\u7684 api \u5219\u653e\u5728\u4e86 react-router-dom\\n\\n\u4e0b\u9762\u4f1a\u8d34\u51fa\u81ea\u5df1\u7b80\u5316\u540e\u7684\u4ee3\u7801\uff0c\u6765\u7406\u89e3 api \u7684\u5b9e\u73b0\u539f\u7406\\n\\n#### 3. Router\\n\\n1. \u7ed1\u5b9a`history`\u76d1\u542c\u51fd\u6570\uff0c\u5f53\u8def\u7531\u53d8\u5316\u65f6\u4fee\u6539 state\\n2. \u5c06`location`\u3001`history`\u548c`match`\u901a\u8fc7`context`\u4f20\u9012\u4e0b\u53bb\\n\\n> match \u662f\u5f53 Route \u6216\u7ec4\u4ef6\u672a\u8bbe\u7f6e path \u65f6\u63d0\u4f9b\u7684\u9ed8\u8ba4\u503c\\n\\n```javascript\\nimport React, { Component, createContext } from \\"react\\";\\n\\nconst RouterContext = createContext({});\\n\\nexport class Router extends Component {\\n  constructor(props) {\\n    super(props);\\n\\n    this.state = {\\n      location: props.history.location,\\n    };\\n    this._isMounted = false;\\n\\n    this.uninstall = props.history.listen(({ location }) => {\\n      if (this._isMounted) {\\n        this.setState({\\n          location,\\n        });\\n      }\\n    });\\n  }\\n\\n  componentDidMount() {\\n    this._isMounted = true;\\n  }\\n  componentWillUnmount() {\\n    this.uninstall();\\n    this._isMounted = false;\\n  }\\n\\n  render() {\\n    const { location } = this.state;\\n    const { history, children } = this.props;\\n    const value = {\\n      location,\\n      history,\\n      match: {\\n        path: \\"/\\",\\n        url: \\"/\\",\\n        params: {},\\n        isExact: location.pathname === \\"/\\",\\n      },\\n    };\\n\\n    return (\\n      <RouterContext.Provider value={value}>{children}</RouterContext.Provider>\\n    );\\n  }\\n}\\n```\\n\\n\u8bbe\u7f6e`_isMounted`\u6807\u8bb0\u907f\u514d\u7ec4\u4ef6\u5728\u5c1a\u672a\u52a0\u8f7d\u5b8c\u6210\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528 setState\\n\\n> \u672a\u52a0\u8f7d\u5b8c\u6210\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528 setState\uff0c\u4e25\u683c\u6a21\u5f0f\u4e0b\u4f1a\u62a5\u9519\uff0c\u6b63\u5e38\u6a21\u5f0f\u4e0b\u4f1a\u5931\u8d25\u65e0\u63d0\u793a\\n\\n#### 4. BrowserRouter \uff5c HashRouter\\n\\n1. \u4f7f\u7528`createBrowserHistory`\u548c`createHashHistory`\u521b\u5efa\u5b9e\u4f8b\\n2. \u901a\u8fc7 props \u4f20\u9012\u7ed9 Router\\n\\n```javascript\\n...\\nimport { createBrowserHistory, createHashHistory } from \\"history\\";\\n\\nexport class BrowserRouter extends Component {\\n  constructor(props) {\\n    super(props);\\n\\n    this.history = createBrowserHistory(props);\\n  }\\n\\n  render() {\\n    return <Router history={this.history} children={this.props.children} />;\\n  }\\n}\\n\\nexport class HashRouter extends Component {\\n  constructor(props) {\\n    super(props);\\n\\n    this.history = createHashHistory(props);\\n  }\\n\\n  render() {\\n    return <Router history={this.history} children={this.props.children} />;\\n  }\\n}\\n```\\n\\n#### 5. Switch\\n\\n`Switch`\u91cc\u4f1a\u50cf\u6570\u7ec4\u904d\u5386\u90a3\u6837\u904d\u5386 children\uff0c\u4f9d\u6b21\u5c06 props \u4e0a\u9762\u7684 path \u6216\u8005 from \u548c context \u91cc\u7684 location.pathname \u8fdb\u884c\u6bd4\u5bf9\uff0c\u5c06\u7b2c\u4e00\u4e2a\u5339\u914d\u6210\u529f\u7684 children \u6e32\u67d3\u51fa\u6765\\n\\n\u800c\u5f53\u7ec4\u4ef6\u4e0a\u4e0d\u5b58\u5728 path \u548c from \u65f6\uff0c\u5c06\u4f1a\u4f7f\u7528 context \u4e0a\u7684 match \u8fdb\u884c\u5224\u65ad\uff0c\u4e0b\u9762\u7b80\u5316\u4ee3\u7801\u91cc\u6709\u5224\u65ad\u7684\u903b\u8f91\uff0c\u4ece\u7ed3\u679c\u4e0a\u6765\u8bf4\uff0c\u5982\u679c\u4e00\u4e2a\u7ec4\u4ef6\u5728`Switch`\u5185**\u672a\u8bbe\u7f6e** path \u6216 from\uff0c\u5b83\u5c06\u4f1a\u662f**\u9ed8\u8ba4\u5339\u914d\u6210\u529f**\uff0c\u4e5f\u5c31\u662f**\u5339\u914d\u4efb\u610f pathname**\\n\\n> Switch \u53ea\u5173\u5fc3 props \u4e0a\u7684 path \u548c from\uff0c\u53ea\u8981\u7ec4\u4ef6\u8bbe\u7f6e\u4e86 path \u6216 from \u5c5e\u6027\uff0c\u5c31\u80fd\u8fdb\u884c\u5339\u914d\uff0c\u672a\u8bbe\u7f6e\u7684\u60c5\u51b5\u4f1a\u5339\u914d\u4efb\u610f pathname\uff0c\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u6211\u4eec\u80fd\u5728 Switch \u4e2d\u4f7f\u7528 Route\u3001Redirct \u4ee5\u5916\u7ec4\u4ef6\u7684\u539f\u56e0\\n\\n\u5927\u5bb6\u53ef\u4ee5\u7b80\u5355\u6d4b\u8bd5\u4e00\u4e0b\uff0c\u5728`Switch`\u6700\u4e0a\u9762\u52a0\u4e0a\uff1a\\n\\n```html\\n<div path=\\"math pathname\\">i am not Route or Redirct</div>\\n```\\n\\n\u5982\u679c path \u547d\u4e2d\uff0c\u5c06\u4f1a\u663e\u793a`i am not Route or Redirct`\uff0c\u800c\u4e0d\u662f\u4e0b\u9762\u7684\u7ec4\u4ef6\\n\\n```html\\n<div>i am not Route or Redirct</div>\\n```\\n\\n\u5982\u679c\u4e0d\u8bbe\u7f6e path\uff0c\u5c06\u4f1a\u5339\u914d\u4efb\u610f pathname\\n\\n```javascript\\n...\\nexport class Switch extends Component {\\n  render() {\\n    return (\\n      <RouterContext.Consumer>\\n        {context => {\\n          const { math, location } = context;\\n\\n          let isMatch = false,\\n            element;\\n          React.Children.forEach(this.props.children, child => {\\n            if (!isMatch) {\\n              element = child;\\n\\n              const path = child.props.path || child.props.from\\n\\n              isMatch = path ? location.pathname === path : math;\\n            }\\n          });\\n\\n          if (element && isMatch) {\\n            return cloneElement(element, { location, computedMatch: match });\\n          }\\n          return null;\\n        }}\\n      </RouterContext.Consumer>\\n    );\\n  }\\n}\\n```\\n\\n`Switch`\u91cc\u4f7f\u7528\u4e86 React.Children.forEach \u53bb\u904d\u5386 children\uff0c\u9664 forEach \u5916\u8fd8\u6709 map\u3001count\u3001only\u3001toArray \u4e00\u5171\u4e94\u4e2a api\\n\\n\u6211\u4eec\u77e5\u9053 forEach \u904d\u5386\u662f\u4e0d\u80fd\u4e2d\u65ad\u7684\uff0c\u800c find\u3001some \u7b49\u65b9\u6cd5\u5728\u6ee1\u8db3\u6761\u4ef6\u540e\u4f1a\u81ea\u52a8\u9000\u51fa\u904d\u5386\uff0c\u6027\u80fd\u4e0a\u4f1a\u6bd4 forEach \u66f4\u597d\uff0c\u4e3a\u4ec0\u4e48\u8fd9\u91cc\u8981\u7528 forEach\uff1f\\n\\n![3.png](./assets/screenshots/3.png)\\n\\n\u6e90\u7801\u91cc\u6ce8\u91ca\u89e3\u91ca\u4e86\u4e3a\u4ec0\u4e48\u4e0d\u7528 toArray().find \u800c\u662f forEach\uff0c\u539f\u56e0\u5728\u4e8e toArray \u9700\u8981\u7ed9\u6bcf\u4e2a children \u6dfb\u52a0 key\uff0c\u5f53\u591a\u4e2a Route \u4f7f\u7528\u540c\u4e00\u4e2a component \u7684\u65f6\u5019\uff0c\u4f1a\u51fa\u73b0\u540c\u65f6\u89e6\u53d1\u4e00\u4e2a\u7ec4\u4ef6\u7684 unmount \u548c remount \u7684\u60c5\u51b5\uff0c\u4ed6\u4eec\u4e0d\u5e0c\u671b\u8fd9\u6837\\n\\n#### 5. Route\\n\\n`Route`\u7684\u5de5\u4f5c\u5f88\u5355\u4e00\uff0c\u6839\u636e\u662f\u5426\u5339\u914d\u6765\u5224\u65ad\u662f\u5426\u6e32\u67d3\u7ec4\u4ef6\\n\\n> \u5728\u672a\u8bbe\u7f6e path \u7684\u60c5\u51b5\u4e0b\uff0cRoute \u4f1a\u76f4\u63a5\u6e32\u67d3\u7ec4\u4ef6\\n\\n```javascript\\n...\\nexport class Route extends Component {\\n  render() {\\n    return (\\n      <RouterContext.Consumer>\\n        {context => {\\n          const { match, path, children } = this.props;\\n          const { location } = context;\\n\\n          const isMatch = match ? match : path ? location.pathname === path : context.match;\\n\\n          if (isMatch) {\\n            return children;\\n          } else {\\n            return null;\\n          }\\n        }}\\n      </RouterContext.Consumer>\\n    );\\n  }\\n}\\n```\\n\\n#### 6. Link\\n\\n\u4e0b\u9762\u4ee3\u7801\u867d\u7136\u80fd\u5b9e\u73b0\u76f8\u5e94\u7684\u529f\u80fd\uff0c\u4f46\u4e0e\u6e90\u7801\u76f8\u5dee\u8f83\u5927\uff0c\u6e90\u7801\u91cc\u5173\u4e8e ref \u7684\u8f6c\u53d1\u505a\u4e86\u6bd4\u8f83\u591a\u7684\u64cd\u4f5c\uff0c\u5efa\u8bae\u76f4\u63a5\u53c2\u8003\u6e90\u7801\u7684\u5b9e\u73b0\\n\\n```javascript\\n...\\nexport class Link extends Component {\\n  handleClick = method => {\\n    return event => {\\n      event.preventDefault();\\n\\n      method(this.props.to);\\n    };\\n  };\\n\\n  render() {\\n    const { to, replace, children, ...otherProps } = this.props;\\n\\n    return (\\n      <RouterContext.Consumer>\\n        {context => {\\n          const { history } = context;\\n          const method = replace ? history.replace : history.push;\\n\\n          return (\\n            <a href={to} onClick={this.handleClick(method)}>\\n              {children}\\n            </a>\\n          );\\n        }}\\n      </RouterContext.Consumer>\\n    );\\n  }\\n}\\n```\\n\\n#### 7. Redirect\\n\\n\u5b98\u65b9\u6ca1\u6709\u7528 class \u5b9e\u73b0`Redirect`\uff0c\u800c\u662f\u8bbe\u8ba1\u4e3a function \u7c7b\u578b\uff0c\u8fd4\u56de`Lifecycle`\u7ec4\u4ef6\uff0c\u4f7f\u7528`Lifecycle`\u7684\u751f\u547d\u5468\u671f\u6765\u89e6\u53d1\u8df3\u8f6c\uff0c\u5e76\u6ca1\u6709\u76f4\u63a5\u8df3\u8f6c\uff0c\u800c\u662f\u7a0d\u5fae\u7ed5\u4e86\u4e00\u4e0b\\n\\n> \u8fd9\u4e48\u8bbe\u8ba1\u7684\u539f\u56e0\uff0c\u4e2a\u4eba\u731c\u6d4b\u662f\u4e3a\u4e86\u4ee3\u7801\u7edf\u4e00\u4f7f\u7528 Consumer \u7684\u5f62\u5f0f\uff0c\u800c constructor \u91cc\u4e0d\u80fd\u4f7f\u7528 Consumer\uff0c\u5bfc\u81f4 Redirct \u65e0\u6cd5\u5728 didmount \u4e4b\u524d\u83b7\u53d6 context\uff0c\u6240\u4ee5\u6539\u6210 function \u5f62\u5f0f\u3002\\n\\n\u4e0b\u9762\u662f\u6211\u5c06`Redirect`\u4f5c\u4e3a\u4e00\u4e2a\u7ec4\u4ef6\u6765\u5b9e\u73b0\u7684\u4f8b\u5b50\uff1a\\n\\n```javascript\\n...\\nexport class Redirect extends Component {\\n  static contextType = RouterContext;\\n\\n  constructor(props, context) {\\n    super(props, context);\\n\\n    const { push = false } = props;\\n    const { history } = context;\\n\\n    this.method = push ? history.push : history.replace;\\n  }\\n\\n  componentDidMount() {\\n    this.method(this.props.to);\\n  }\\n  componentDidUpdate(prevProps) {\\n    if (prevProps.to !== this.props.to) {\\n      this.method(this.props.to);\\n    }\\n  }\\n\\n  render() {\\n    return null;\\n  }\\n}\\n```\\n\\n#### 8. withRouter\\n\\n\u4e3a\u4e86\u6ee1\u8db3\u5176\u4ed6\u7ec4\u4ef6\u80fd\u591f\u624b\u52a8\u7684\u8fdb\u884c\u8def\u7531\u8df3\u8f6c\uff0c\u9700\u8981\u5c06`history`\u5bf9\u8c61\u66b4\u9732\u51fa\u6765\\n\\n> \u4f7f\u7528 hoc \u7684\u65f6\u5019\uff0c\u4f20\u9012 props \u548c ref \u540c\u65f6\u8fd8\u9700\u8981\u590d\u5236\u9759\u6001\u65b9\u6cd5\uff0c\u53c2\u8003\uff1a[hoist-non-react-statics](https://github.com/mridgway/hoist-non-react-statics)\\n\\n```javascript\\n...\\nexport function withRouter(WrapComponent) {\\n  class WrappedComponent extends Component {\\n    render() {\\n      return (\\n        <RouterContext.Consumer>\\n          {context => {\\n            return <WrapComponent {...this.props} {...context} />;\\n          }}\\n        </RouterContext.Consumer>\\n      );\\n    }\\n  }\\n\\n  return hoistStatics(WrappedComponent, WrapComponent);\\n}\\n```\\n\\n#### 8. \u5199\u5728\u6700\u540e\\n\\n\u5728\u770b\u4e86\u6e90\u7801\u5e76\u7b80\u5355\u5b9e\u73b0\u540e\uff0c\u8ba9\u6211\u60ca\u8bb6\u7684\u662f Link \u6bd4\u60f3\u8c61\u4e2d\u8981\u590d\u6742\u5f88\u591a\uff0c\u4ee5\u53ca pathname \u7684\u5339\u914d\u65b9\u6cd5\uff0c\u8fd8\u6709 Switch \u7684\u5339\u914d\u65b9\u5f0f\\n\\n\u5e0c\u671b\u8fd9\u7bc7\u6587\u7ae0\u80fd\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u8c22\u8c22"},{"id":"/2020/09/14/version_of_fontend_project","metadata":{"permalink":"/blog/2020/09/14/version_of_fontend_project","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-09-14-version_of_fontend_project.md","source":"@site/blog/2020-09-14-version_of_fontend_project.md","title":"\u524d\u7aef\u7248\u672c\u53f7\u5b9a\u4e49","description":"\u524d\u7aef\u7248\u672c\u53f7\u5b9a\u4e49","date":"2020-09-14T00:00:00.000Z","formattedDate":"2020\u5e749\u670814\u65e5","tags":[],"readingTime":2.355,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u524d\u7aef\u7248\u672c\u53f7\u5b9a\u4e49","authors":"youniaogu","date":"2020-09-14T00:00:00.000Z","tags":[]},"prevItem":{"title":"react-router-dom \u7b80\u5355\u8bb2\u89e3","permalink":"/blog/2020/09/16/the_simple_react-router-dom"},"nextItem":{"title":"redux-saga \u4e2d\u53d6\u6d88 fetch \u8bf7\u6c42","permalink":"/blog/2020/09/09/cancel_fetch_in_redux-saga"}},"content":"### \u524d\u7aef\u7248\u672c\u53f7\u5b9a\u4e49\\n\\n\u7248\u672c\u53f7\u7ed3\u6784\uff1a\\n\\n> \u4e3b\u7248\u672c\u53f7.\u6b21\u7248\u672c\u53f7.\u4fee\u8ba2\u53f7\\n\\n\u7248\u672c\u53f7\u80fd\u591f\u8868\u660e\u7248\u672c\u7684\u91cd\u8981\u6027\u548c\u7834\u574f\u6027\uff0c\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u6709\u7740\u5f88\u91cd\u8981\u7684\u610f\u4e49\\n\\n#### 1. \u7248\u672c\u53f7\u5b9a\u4e49\\n\\n\u7248\u672c\u53f7\u5b9a\u4e49\u53c2\u8003[\u8bed\u4e49\u5316\u7248\u672c 2.0.0](https://semver.org/lang/zh-CN/)\uff0cnpm \u8bed\u4e49\u5316\u7248\u672c\u63a7\u5236\u4e5f\u662f\u4ee5\u5b83\u4e3a\u57fa\u51c6\u7684\\n\\n\u91cc\u9762\u89c4\u5b9a\u7248\u672c\u53f7\u5fc5\u987b\u9075\u5b88\u4ee5\u4e0b\u89c4\u5219\uff1a\\n\\n- \u4e3b\u7248\u672c\u53f7\uff1a\u5f53\u4f60\u505a\u4e86\u4e0d\u517c\u5bb9\u7684 API \u4fee\u6539\uff0c\\n- \u6b21\u7248\u672c\u53f7\uff1a\u5f53\u4f60\u505a\u4e86\u5411\u4e0b\u517c\u5bb9\u7684\u529f\u80fd\u6027\u65b0\u589e\uff0c\\n- \u4fee\u8ba2\u53f7\uff1a\u5f53\u4f60\u505a\u4e86\u5411\u4e0b\u517c\u5bb9\u7684\u95ee\u9898\u4fee\u6b63\u3002\\n\\n#### 2. \u533a\u522b\\n\\n\u5728\u524d\u7aef\u7684\u7cfb\u7edf\u91cc\u9762\u901a\u5e38\u5e76\u6ca1\u6709 api \u7b49\u7279\u6027\uff0c\u6240\u4ee5\u4e0a\u9762\u7684\u89c4\u5219\u5e76\u4e0d\u5b8c\u5168\u9002\u7528\uff0c\u6240\u4ee5\u5728\u89c4\u5219\u65b9\u9762\u8981\u505a\u4e00\u4e9b\u53d8\u66f4\\n\\n\u5728\u7248\u672c\u53f7\u7684\u4fee\u6539\u4e0a\u9762\uff0c\u4e00\u767e\u4e2a\u4eba\u6709\u4e00\u4e2a\u79cd\u65b9\u6cd5\uff0c\u4e0b\u9762\u662f\u6211\u4e2a\u4eba\u7684\u4e00\u4e9b\u7406\u89e3\uff1a\\n\\n- \u4e3b\u7248\u672c\u53f7\uff1a\u5f53\u9879\u76ee\u7ed3\u6784\u53d1\u751f\u6539\u53d8\u3001\u63a8\u51fa\u5f88\u91cd\u8981\u529f\u80fd\u6216\u8005\u662f\u591a\u4e2a\u6b21\u7248\u672c\u53f7\u66f4\u66ff\u540e\u53d8\u66f4\\n- \u6b21\u7248\u672c\u53f7\uff1a\u5f53\u65b0\u589e\u529f\u80fd\u5e76\u4e14\u9879\u76ee\u7ed3\u6784\u65e0\u591a\u5927\u4fee\u6539\u65f6\u65b0\u589e\\n- \u4fee\u8ba2\u53f7\uff1a\u5f53\u4f60\u4fee\u6539\u4e86 bug \u6216\u8005\u505a\u4e86\u4e00\u4e9b\u5c0f\u7684\u6837\u5f0f\u6216\u903b\u8f91\u8c03\u6574\\n\\n**\u89c4\u5219\u662f\u6b7b\u7684\uff0c\u4eba\u662f\u6d3b\u5f97\uff0c\u53ea\u6709\u9002\u5408\u624d\u662f\u6700\u597d\u7684**\\n\\n#### 2. \u5982\u4f55\u7406\u89e3 dependencies \u5185\u7684\u7248\u672c\u53f7\\n\\n- ^\uff1a\u4ece\u5de6\u8fb9\u6570\u7b2c\u4e00\u4e2a\u4e0d\u7b49\u4e8e 0 \u7684\u7248\u672c\u53f7\u4e0d\u5141\u8bb8\u6539\u53d8\uff0c\u53f3\u8fb9\u7684\u53ef\u4ee5\u5339\u914d\u5230\u6700\u65b0\u7684\u7248\u672c\\n- ~\uff1a\u5982\u679c\u5b58\u5728\u6b21\u7248\u672c\u53f7\uff0c\u5219\u53ea\u80fd\u5339\u914d\u5230\u4fee\u8ba2\u53f7\u7684\u6700\u65b0\u7248\u3002\u5982\u679c\u4e0d\u5b58\u5728\u6b21\u7248\u672c\u53f7\uff08\u6307\u7684\u662f~1\uff0c\u800c\u4e0d\u662f~1.0 \u6216~1.0.0\uff0c\u56e0\u4e3a 0 \u4e5f\u7b97\u662f\u6b21\u7248\u672c\u53f7\uff09\uff0c\u53ef\u4ee5\u5339\u914d\u5230\u6b21\u7248\u672c\u53f7\u6700\u65b0\u7248\u672c\\n- latest\uff1a\u5339\u914d\u6700\u65b0\u7248\u672c\u53f7\\n- \\\\*\uff1a\u5339\u914d\u6700\u65b0\u7248\u672c\u53f7\\n- 1.2.3\uff1a\u6307\u5b9a\u7248\u672c\u53f7\\n- -\uff1a\u5339\u914d\u4e24\u4e2a\u7248\u672c\u53f7\u7684\u533a\u95f4\\n- \\\\> >= < <= =\uff1a\u8fd0\u7b97\u7b26\u5339\u914d"},{"id":"/2020/09/09/cancel_fetch_in_redux-saga","metadata":{"permalink":"/blog/2020/09/09/cancel_fetch_in_redux-saga","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-09-09-cancel_fetch_in_redux-saga.md","source":"@site/blog/2020-09-09-cancel_fetch_in_redux-saga.md","title":"redux-saga \u4e2d\u53d6\u6d88 fetch \u8bf7\u6c42","description":"redux-saga \u4e2d\u53d6\u6d88 fetch \u8bf7\u6c42","date":"2020-09-09T00:00:00.000Z","formattedDate":"2020\u5e749\u67089\u65e5","tags":[],"readingTime":1.64,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"redux-saga \u4e2d\u53d6\u6d88 fetch \u8bf7\u6c42","authors":"youniaogu","date":"2020-09-09T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u524d\u7aef\u7248\u672c\u53f7\u5b9a\u4e49","permalink":"/blog/2020/09/14/version_of_fontend_project"},"nextItem":{"title":"\u4e3a\u4ec0\u4e48\u7528 fetch\uff1f","permalink":"/blog/2020/09/02/why_fetch"}},"content":"### redux-saga \u4e2d\u53d6\u6d88 fetch \u8bf7\u6c42\\n\\n\u5728\u9605\u8bfb\u672c\u7bc7\u6587\u7ae0\u524d\uff0c\u5efa\u8bae\u5148\u9605\u8bfb[redux-saga \u6587\u6863](https://redux-saga.js.org/)\uff0c\u7406\u89e3\u57fa\u7840\u7528\u6cd5\\n\\nredux-saga \u53ef\u4ee5\u4f7f\u7528`cancel`\u53d6\u6d88\u4efb\u52a1\uff0c\u4f46\u5e76\u4e0d\u80fd\u53d6\u6d88\u5df2\u7ecf\u53d1\u8d77\u7684\u8bf7\u6c42\u3002\u800c`xhr`\u3001`fetch`\u90fd\u63d0\u4f9b\u4e86\u53d6\u6d88\u8bf7\u6c42\u7684\u65b9\u6cd5\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5c01\u88c5`fetch`\uff0c\u5728\u53d6\u6d88\u4efb\u52a1\u7684\u540c\u65f6\u53d6\u6d88\u8bf7\u6c42\u3002\\n\\n#### 1. \u5173\u4e8e fetch \u8bf7\u6c42\u7684\u53d6\u6d88\\n\\n\u53c2\u8003[AbortController](https://developer.mozilla.org/en-US/docs/Web/API/AbortController/AbortController)\\n\\n#### 2. \u539f\u7406\\n\\nyield \u5173\u952e\u5b57\u5728\u88ab\u53d6\u6d88\u65f6\u5019\u4f1a\u629b\u51fa\u9519\u8bef\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u7528`generator`\u51fd\u6570\u5305\u4f4f`fetch`\u8bf7\u6c42\uff0c\u5728\u91cc\u9762\u901a\u8fc7`try catch`\u83b7\u53d6\u9519\u8bef\uff0c\u6700\u540e\u53d6\u6d88\u8bf7\u6c42\\n\\n\u5c01\u88c5`fetch`\uff1a\\n\\n```javascript\\n//fetch.js\\nfunction* fetchData(options) {\\n  const controller = new AbortController();\\n\\n  try {\\n    return yield fetchDataWithoutCancel({\\n      ...options,\\n      signal: controller.signal,\\n    });\\n  } finally {\\n    controller.abort();\\n  }\\n}\\n```\\n\\n#### 3. \u5b9e\u9645\u8fd0\u7528\\n\\n##### \u4e0e`takeLatest`\u7ed3\u5408\u4f7f\u7528\uff1a\\n\\n```javascript\\nfunction* cancelFetchSaga() {\\n  yield takeLatest(\'CANCEL_FETCH\', function*() {\\n    const data = yield call(fetchData, {\\n      url: \'http://httpstat.us/200?sleep=1000\',\\n    }),\\n\\n    console.log(data);\\n  });\\n}\\n```\\n\\n\u6bcf\u5f53\u6267\u884c`cancelFetch`\u4efb\u52a1\uff0c\u4e0a\u4e00\u4e2a\u672a\u5b8c\u6210\u4efb\u52a1\u5c31\u4f1a\u88ab\u53d6\u6d88\uff0c\u540c\u65f6\u8bf7\u6c42\u4e5f\u4f1a\u88ab\u53d6\u6d88\\n\\n##### \u4f7f\u7528`race`\u548c`delay`\u5b9e\u73b0\u8d85\u65f6\u53d6\u6d88\u8bf7\u6c42\uff1a\\n\\n```javascript\\nfunction* cancelFetchSaga() {\\n  yield takeLatest(\\"CANCEL_FETCH\\", function* () {\\n    const { data, timeout } = yield race({\\n      data: call(fetchData, {\\n        url: \\"http://httpstat.us/200?sleep=2000\\",\\n      }),\\n      timeout: delay(1000),\\n    });\\n\\n    if (timeout) {\\n      console.log(\\"fetch canceled!\\");\\n    } else {\\n      console.log(data);\\n    }\\n  });\\n}\\n```\\n\\n1s \u540e\u8bf7\u6c42\u4f1a\u88ab\u53d6\u6d88\\n\\n#### 4. \u6d4b\u8bd5\u7528\u5de5\u5177\\n\\n1. [httpstat](http://httpstat.us/)\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u8fd4\u56de\u5ef6\u8fdf\\n\\n2. chrome network \u91cc\u8bbe\u7f6e throtting\\n\\n![pic2](./assets/screenshots/2.png)"},{"id":"/2020/09/02/why_fetch","metadata":{"permalink":"/blog/2020/09/02/why_fetch","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-09-02-why_fetch.md","source":"@site/blog/2020-09-02-why_fetch.md","title":"\u4e3a\u4ec0\u4e48\u7528 fetch\uff1f","description":"\u4e3a\u4ec0\u4e48\u7528 fetch\uff1f","date":"2020-09-02T00:00:00.000Z","formattedDate":"2020\u5e749\u67082\u65e5","tags":[],"readingTime":3.15,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u4e3a\u4ec0\u4e48\u7528 fetch\uff1f","authors":"youniaogu","date":"2020-09-02T00:00:00.000Z","tags":[]},"prevItem":{"title":"redux-saga \u4e2d\u53d6\u6d88 fetch \u8bf7\u6c42","permalink":"/blog/2020/09/09/cancel_fetch_in_redux-saga"},"nextItem":{"title":"input \u9650\u5236\u8f93\u5165","permalink":"/blog/2020/08/28/how_to_limit_in_react_input"}},"content":"### \u4e3a\u4ec0\u4e48\u7528 fetch\uff1f\\n\\n\u4e0b\u9762\u7f57\u5217\u4e86\u7f51\u4e0a\u7ecf\u5e38\u8ba8\u8bba\uff0c\u5173\u4e8e fetch \u7684\u7f3a\u70b9\uff0c\u4ee5\u53ca\u76ee\u524d\u7684\u89e3\u51b3\u65b9\u6848\\n\\n#### 1. \u6ca1\u6709\u81ea\u52a8 stringify\\n\\n\u5c01\u88c5\u62bd\u8c61\u65b9\u6cd5\uff0c\u5f88\u7b80\u5355\\n\\n#### 2. \u63a5\u53e3\u629b\u51fa 4xx\u30015xx \u7c7b\u9519\u8bef\u4f1a\u5f52\u5230\u6210\u529f\u91cc\uff0c\u53ea\u6709\u7f51\u7edc\u9519\u8bef\u624d\u4f1a\u629b\u51fa reject\\n\\n400 \u2264 status < 600 \u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5728 then \u91cc\u901a\u8fc7 res.ok \u5224\u65ad\u662f\u5426\u4e3a\u9519\u8bef\u60c5\u51b5\uff0c\u5728\u6839\u636e status \u8fdb\u884c\u5904\u7406\uff0c\u800c\u7f51\u7edc\u8bf7\u6c42\u9519\u8bef\u5219\u5728 catch \u91cc\u5904\u7406\\n\\n#### 3. \u7f3a\u5c11\u9ed8\u8ba4\u914d\u7f6e\\n\\n\u9700\u8981\u81ea\u5df1\u5c01\u88c5\u9ed8\u8ba4\u7684`headers`\u6216`credentials`\uff0c\u4e0d\u80fd\u5f00\u7bb1\u5373\u7528\\n\\n#### 4. \u517c\u5bb9\u6027\\n\\nIE \u4e0d\u517c\u5bb9\\n\\n\u5728 fetch \u521a\u51fa\u7684\u65f6\u5019\u5f88\u591a\u4eba\u5410\u69fd\u5b83\u7684\u517c\u5bb9\u6027\uff0c\u4f46\u5230 2020 \u5e74\uff0c[caniuse](https://caniuse.com/#search=fetch)\u4e0a\u663e\u793a\u5168\u7403\u6d4f\u89c8\u5668\u517c\u5bb9\u6027\u8986\u76d6\u7387\u8fbe\u5230\u4e86 95.11%\uff0c\u53ef\u4ee5\u653e\u5fc3\u4f7f\u7528\\n\\n\u5982\u679c\u9700\u8981\u517c\u5bb9 IE\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528[whatwg-fetch](https://github.com/github/fetch)\uff0c\u8fd9\u662f\u4e2a polyfill \u5e93\uff0c\u539f\u7406\u662f\u4f7f\u7528 XMLHttpRequest \u6765\u6a21\u62df fetch\\n\\n#### 5. \u8bf7\u6c42\u8d85\u65f6\u3001\u53d6\u6d88\u8bf7\u6c42\\n\\n\u53ef\u4ee5\u4f7f\u7528[AbortController](https://developer.mozilla.org/en-US/docs/Web/API/AbortController/AbortController)\u5b9e\u73b0\u76f8\u5173\u529f\u80fd\\n\\n#### 6. \u4e0b\u8f7d\u8fdb\u5ea6\\n\\n\u53ef\u4ee5\u4f7f\u7528[ReadableStream](https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream)\u5b9e\u73b0\u76f8\u5173\u529f\u80fd\\n\\n#### 7. \u4e0a\u4f20\u8fdb\u5ea6\\n\\n\u6682\u65e0\u89e3\u51b3\u65b9\u6848\\n\\n##### \u4f18\u70b9\\n\\n1. \u8bed\u6cd5\u4e0a\u6bd4\u8f83\u7b80\u5355\u7b80\u6d01\\n2. \u57fa\u4e8e\u6d4f\u89c8\u5668\u63d0\u4f9b\u7684\u539f\u751f\u65b9\u6cd5\uff0c\u4f7f\u7528`promise`\u5b9e\u73b0\\n3. \u5c5e\u4e8e\u539f\u751f js \u7cfb\u5217\uff0c\u4e0d\u9700\u8981\u5f15\u5165\u7b2c\u4e09\u65b9\u5e93\\n4. \u5c5e\u4e8e\u5e95\u5c42 api\uff0c\u80fd\u591f\u81ea\u884c\u5c01\u88c5\u548c\u63a7\u5236\\n\\n##### \u5bf9\u6bd4 axios\\n\\naxios \u662f\u5e94\u7528\u4e8e web \u548c node \u7684 http \u8bf7\u6c42\u7b2c\u4e09\u65b9\u5e93\uff0c\u4f7f\u7528`promise`\uff0cweb \u57fa\u4e8e`XMLHttpRequest`\u5b9e\u73b0\uff0cnode \u57fa\u4e8e`http`\u6a21\u5757\u5b9e\u73b0\\n\\naxios \u529f\u80fd\u5341\u5206\u5f3a\u5927\uff0c\u57fa\u672c\u4e0a fetch \u80fd\u505a\u5230\u7684 axios \u90fd\u80fd\u505a\u5230\uff0c\u751a\u81f3\u80fd\u505a fetch \u505a\u4e0d\u5230\u7684\u4e8b\u60c5\uff0c\u5e76\u4e14 api \u7b80\u5355\uff0c\u5728\u517c\u5bb9\u6027\u65b9\u9762\uff0caxios \u6700\u4f4e\u517c\u5bb9\u81f3 ie11\\n\\n\u53ef\u4ee5\u8bf4 axios \u662f\u5168\u9762\u78be\u538b fetch\uff0c\u90a3\u4e48\u8fd8\u6709\u4ec0\u4e48\u7406\u7531\u575a\u6301 fetch \u5462\uff1f\u8bf7\u7ee7\u7eed\u5f80\u4e0b\u770b\\n\\n##### \u4e3a\u4ec0\u4e48\u575a\u6301 fetch\\n\\n1. fetch \u4f5c\u4e3a\u5e95\u5c42 api\uff0c\u76ee\u524d\u9664\u4e86\u4e0a\u4f20\u8fdb\u5ea6\u65e0\u89e3\u4ee5\u5916\uff0c\u5176\u4ed6\u90fd\u6709\u5bf9\u5e94\u7684\u5904\u7406\u65b9\u6cd5\uff0c\u53ea\u8981\u62bd\u8c61\u5c01\u88c5\u540e\u5b8c\u5168\u80fd\u591f\u5e94\u5bf9\u5927\u90e8\u5206\u7684\u573a\u666f\\n\\n2. \u9ad8\u5ea6\u5c01\u88c5\u7684\u5e93\u786e\u5b9e\u80fd\u591f\u5f88\u65b9\u4fbf\u7684\u6ee1\u8db3\u9700\u6c42\uff0c\u4f46\u8fd9\u4e2d\u95f4\u5c01\u88c5\u7684\u8fc7\u7a0b\u548c\u539f\u7406\u5374\u65e0\u4ece\u5f97\u77e5\uff0c\u4f1a\u7528\u4ec5\u4ec5\u662f\u8fbe\u5230 20%\u800c\u5df2\\n\\n3. \u5927\u90e8\u5206\u60c5\u51b5\u4e0b\uff0chttp \u8bf7\u6c42\u5e76\u4e0d\u9700\u8981\u7279\u522b\u590d\u6742\u7684\u529f\u80fd\uff0c\u4e0d\u9700\u8981\u5f15\u5165\u989d\u5916\u5e93\u7684 fetch \u4f1a\u662f\u66f4\u597d\u7684\u9009\u62e9\\n\\n4. \u81ea\u5df1\u5c01\u88c5\u5e95\u5c42 api\uff0c\u80fd\u591f\u66f4\u8d34\u5408\u5b9e\u9645\u4e1a\u52a1\u4e2d\u7684\u9700\u6c42\uff0c\u66f4\u52a0\u7684\u7406\u89e3\u91cc\u9762\u7684\u6d41\u7a0b\uff0c\u51fa\u95ee\u9898\u65f6\u80fd\u591f\u66f4\u597d\u7684\u89e3\u51b3"},{"id":"/2020/08/28/how_to_limit_in_react_input","metadata":{"permalink":"/blog/2020/08/28/how_to_limit_in_react_input","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-08-28-how_to_limit_in_react_input.md","source":"@site/blog/2020-08-28-how_to_limit_in_react_input.md","title":"input \u9650\u5236\u8f93\u5165","description":"input \u9650\u5236\u8f93\u5165","date":"2020-08-28T00:00:00.000Z","formattedDate":"2020\u5e748\u670828\u65e5","tags":[],"readingTime":2.335,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"input \u9650\u5236\u8f93\u5165","authors":"youniaogu","date":"2020-08-28T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u4e3a\u4ec0\u4e48\u7528 fetch\uff1f","permalink":"/blog/2020/09/02/why_fetch"},"nextItem":{"title":"\u5982\u4f55\u5b9e\u73b0 Redux","permalink":"/blog/2020/07/20/how_to_implement_redux"}},"content":"### input \u9650\u5236\u8f93\u5165\\n\\n#### 1. \u95ee\u9898\\n\\n\u5f88\u591a\u65f6\u5019\u9700\u8981\u5bf9 input \u8fdb\u884c\u8f93\u5165\u7684\u9650\u5236\uff0c\u6bd4\u5982\u53ea\u5141\u8bb8\u8f93\u5165\u6570\u5b57\u3001\u82f1\u6587\u5b57\u6bcd\u548c\u4e2d\u6587\uff0c\u4e0d\u5141\u8bb8\u8f93\u5165\u7279\u6b8a\u5b57\u7b26\uff0c\u53c8\u6216\u8005\u9650\u5236\u957f\u5ea6\u7b49\\n\\n\u7b2c\u4e00\u6b21\u63a5\u89e6\u7684\u4eba\u53ef\u80fd\u4f1a\u7b80\u5355\u7684\u5728`onChange`\u91cc`replace`\\n\\n```javascript\\nhandleInputChange = evt => {\\n  const { name, value } = evt.target\\n\\n  this.setState({\\n    [name]: value.replace(/[^\\\\u4e00-\\\\u9fa50-9a-zA-Z]/g, \\"\\"); //\u9664\u6570\u5b57\u3001\u82f1\u6587\u5b57\u6bcd\u548c\u4e2d\u6587\u5916\u90fd\u66ff\u6362\u4e3a\u2018\u2019\\n  })\\n}\\n\\n<input name=\\"name\\" value={name} onChange={this.handleInputChange} />\\n```\\n\\n\u8fd9\u6837\u5199\u7684\u8bdd\uff0c\u5982\u679c\u6d89\u53ca\u5230\u8f93\u5165\u6cd5\u65f6\u4f1a\u51fa\u73b0\u9519\u8bef\\n\\n\u56e0\u4e3a\u8f93\u5165\u6cd5\u952e\u5165\u662f\u4e00\u4e2a\u8fc7\u7a0b\uff0c\u800c React \u4e2d\u6bcf\u6b21\u952e\u5165\u90fd\u4f1a\u89e6\u53d1`onChange`\uff0c\u8fc7\u7a0b\u4e2d\u8f93\u5165\u6cd5\u7684\u4e00\u4e9b\u952e\u5165\u88ab`replace`\u53bb\u9664\u540e\uff0c\u5c31\u4f1a\u5bfc\u81f4\u9519\u8bef\u7684\u60c5\u51b5\\n\\n#### 2. \u89e3\u51b3\u65b9\u6cd5\\n\\n[Composition Events](https://developer.mozilla.org/zh-CN/docs/Web/API/CompositionEvent)\uff08\u7ec4\u6210\u4e8b\u4ef6\uff09\u91cc\u9762\u6709`onCompositionStart onCompositionUpdate onCompositionEnd`\u4e09\u4e2a\u4e8b\u4ef6\u5206\u522b\u4ee3\u8868 \u5f00\u59cb\u8f93\u5165\u5408\u6210\u3001\u8f93\u5165\u5408\u6210\u66f4\u65b0\u3001\u8f93\u5165\u5408\u6210\u7ed3\u675f\\n\\n`onCompositionStart`\u548c`onCompositionEnd`\u4e0e`onChange`\u7684\u6267\u884c\u987a\u5e8f\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\\n\\n1. \u6b63\u5e38\u60c5\u51b5\u4e0b\uff1a`onCompositionStart` -> `onCompositionEnd` -> `onChange`\\n2. chrome \u6216 IOS \u7248\u672c 10.3 \u53ca\u4ee5\u540e\uff1a`onCompositionStart` -> `onChange` -> `onCompositionEnd`\\n\\n#### 3. \u601d\u8def\\n\\n\u5c06`formatter`\u90e8\u5206\u5355\u72ec\u62ff\u51fa\u6765\uff0c\u5f53\u5904\u5728`onCompositionStart`\u548c`onCompositionUpdate`\u72b6\u6001\u65f6\u4e0d\u89e6\u53d1`formatter`\\n\\n```javascript\\nimport React from \\"react\\";\\n\\nisChrome = () => {\\n  return !!window.chrome;\\n};\\nIOSVer = () => {\\n  const match = window.navigator.userAgent.match(/\\\\d[\\\\d]*_\\\\d[_\\\\d]*/i);\\n  if (match) {\\n    return parseFloat(match[0].split(\\"-\\").join(\\".\\"));\\n  }\\n  return null;\\n};\\n\\nfunction Input(props) {\\n  this.onComposition = true;\\n  this.isChrome = isChrome();\\n  this.IOSver = IOSVer();\\n\\n  handleInputChange = (evt) => {\\n    const { name, onChange, formatter } = this.props;\\n\\n    if (typeof onChange === \\"function\\") {\\n      let value = evt.target.value;\\n      if (this.onComposition && formatter) {\\n        value = formatter(value);\\n      }\\n\\n      onChange({ target: { value, name } });\\n    }\\n  };\\n  const handleComposition = (evt) => {\\n    if (evt.type === \\"compositionend\\") {\\n      this.onComposition = true;\\n\\n      if (this.isChrome || (this.IOSVer && this.IOSVer >= 10.3)) {\\n        this.handleInputChange(evt);\\n      }\\n    } else {\\n      this.onComposition = false;\\n    }\\n  };\\n\\n  const { children, onChange, formatter, ...otherProps } = props;\\n\\n  return (\\n    <input\\n      {...otherProps}\\n      onChange={this.handleInputChange}\\n      onCompositionStart={this.handleComposition}\\n      onCompositionUpdate={this.handleComposition}\\n      onCompositionEnd={this.handleComposition}\\n    />\\n  );\\n}\\n\\nexport default Input;\\n```\\n\\n\u6ce8\u610f\u7684\u70b9\uff1a\u56e0\u4e3a`formatter`\u90e8\u5206\u662f\u5728`onChange`\u91cc\u6267\u884c\uff0c\u6240\u4ee5\u7b2c\u4e8c\u79cd\u60c5\u51b5\u4e0b`onCompositionEnd`\u540e\u9700\u8981\u624b\u52a8\u89e6\u53d1`onChange`"},{"id":"/2020/07/20/how_to_implement_redux","metadata":{"permalink":"/blog/2020/07/20/how_to_implement_redux","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-07-20-how_to_implement_redux.md","source":"@site/blog/2020-07-20-how_to_implement_redux.md","title":"\u5982\u4f55\u5b9e\u73b0 Redux","description":"\u5982\u4f55\u5b9e\u73b0 Redux","date":"2020-07-20T00:00:00.000Z","formattedDate":"2020\u5e747\u670820\u65e5","tags":[],"readingTime":10.945,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u5982\u4f55\u5b9e\u73b0 Redux","authors":"youniaogu","date":"2020-07-20T00:00:00.000Z","tags":[]},"prevItem":{"title":"input \u9650\u5236\u8f93\u5165","permalink":"/blog/2020/08/28/how_to_limit_in_react_input"},"nextItem":{"title":"\u4ec0\u4e48\u662f Reselect","permalink":"/blog/2020/06/30/what_is_reselect"}},"content":"### \u5982\u4f55\u5b9e\u73b0 Redux\\n\\n> \u793a\u4f8b demo\uff1a[github](https://github.com/youniaogu/simple-redux)\\n>\\n> \u6ce8\u610f\uff1a\u4e3a\u4e86\u7b80\u5355\u660e\u4e86\u7684\u5c55\u793a\u4e3b\u8981\u6d41\u7a0b\uff0c\u4e0b\u9762\u793a\u4f8b\u4e2d\u5747\u4f1a\u7701\u7565\u5f02\u5e38\u60c5\u51b5\u7684\u5904\u7406\u3002\\n\\n`redux`\u91cc\u6709\u56db\u4e2a\u6838\u5fc3\u7684 api\uff0c\u4e0b\u9762\u4f1a\u6309\u987a\u5e8f\u4ecb\u7ecd\u5e76\u5b9e\u73b0\u5b83\u4eec\\n\\n1. combineReducer\\n2. compose\\n3. createStore\\n4. applyMiddlewares\\n\\n#### \u4e00\u3001combineReducer\\n\\n##### 1. combineReducer \u662f\u4ec0\u4e48\uff0c\u6709\u4ec0\u4e48\u7528\uff1f\\n\\n\u56e0\u4e3a`createStore`\u53ea\u80fd\u63a5\u6536\u4e00\u4e2a`reducer`\uff0c\u5982\u679c\u628a\u6240\u6709\u7684`reducer`\u90fd\u5199\u5728\u4e00\u8d77\u7684\u8bdd\u4f1a\u5f88\u81c3\u80bf\uff0c\u6240\u4ee5\u9700\u8981\u5c06\u5176\u5206\u5272\u4e3a\u4e00\u4e2a\u4e2a\u5c0f\u7684`reducer`\uff0c\u5206\u522b\u8d1f\u8d23\u4e00\u90e8\u5206\u7684 state\uff0c\u518d\u5408\u5e76\u6210\u4e00\u4e2a`rootReducer`\u3002\\n\\n`combineReducer`\u7684\u4f5c\u7528\u5c31\u662f\u5c06\u591a\u4e2a`reducer`\u5408\u5e76\u6210\u4e00\u4e2a\\n\\n> \u5408\u5e76\u540e\u8fd4\u56de\u7684 reducer \u5728\u5904\u7406 state \u65f6\u4f1a\u8fdb\u884c\u5206\u53d1\uff0c\u4ece\u4e0a\u9762\u63a5\u6536 state \u540e\u4f1a\u5c06\u5bf9\u5e94\u90e8\u5206\u7684 state \u5206\u53d1\u7ed9 reducer\\n>\\n> \u4e0d\u7406\u89e3\u7684\u8bdd\uff0c\u53ef\u4ee5\u770b\u4e0b\u8fb9\u7684\u6267\u884c\u524d\u540e\u4ee3\u7801\\n\\n##### 2. combineReducer \u6267\u884c\u524d\u540e\u4ee3\u7801\\n\\n```javascript\\nexport default combineReducer({\\n  list: listReducers,\\n  dict: dictReducers,\\n  detail: detailReducers,\\n});\\n\\n//\u2193\u2193\u2193\u7b49\u4ef7\u4e8e\u2193\u2193\u2193\\n\\nexport default function (state, action) {\\n  return {\\n    list: listReducers(state.list, action),\\n    dict: dictReducers(state.dict, action),\\n    detail: detailReducers(state.detail, action),\\n  };\\n}\\n```\\n\\n##### 3. \u5b9e\u73b0 combineReducer\\n\\n\u904d\u5386\u4f20\u5165\u7684\u5bf9\u8c61\u62ff\u5230\u6240\u6709\u7684 key \u503c\uff0c\u4f7f\u7528 key \u503c\u62ff\u5230\u5bf9\u5e94\u7684\u65e7\u72b6\u6001\uff0c\u5c06\u65e7\u72b6\u6001\u548c\u52a8\u4f5c\u4f20\u5165`reducer`\uff0c\u83b7\u53d6\u6700\u65b0\u72b6\u6001\u5e76\u8fd4\u56de\uff0c\u5b9e\u73b0\u8d77\u6765\u5e76\u4e0d\u590d\u6742\u3002\\n\\n```javascript\\nfunction combineReducer(reducers) {\\n  return function (state, action) {\\n    const nextState = {};\\n\\n    for (let key in reducers) {\\n      nextState[key] = reducers[key](state[key], action);\\n    }\\n\\n    return nextState;\\n  };\\n}\\n```\\n\\n##### 4. redux \u662f\u5982\u4f55\u5b9e\u73b0 combineReducer\uff1f\\n\\n\u5bf9\u6bd4\u4e0b\u6e90\u7801\\n\\n```javascript\\nfunction combineReducer(reducers) {\\n  const reducerKeys = Object.keys(reducers);\\n  const finalReducers = {};\\n  for (let i = 0; i < reducerKeys.length; i++) {\\n    const key = reducerKeys[i];\\n    if (typeof reducers[key] === \\"function\\") {\\n      finalReducers[key] = reducers[key];\\n    }\\n  }\\n  const finalReducerKeys = Object.keys(finalReducers);\\n\\n  return function (state = {}, action) {\\n    let hasChange = false;\\n    const nextState = {};\\n    for (let i = 0; i < finalReducerKeys.length; i++) {\\n      const key = finalReducerKeys[i];\\n      const reducer = finalReducers[i];\\n      const prevStateForKey = state[key];\\n      const nextStateForKey = reducer(prevStateForKey, action);\\n\\n      nextState[key] = nextStateForKey;\\n      hasChange = hasChange || nextStateForKey !== prevStateForKey;\\n    }\\n    return hasChange ? nextState : state;\\n  };\\n}\\n```\\n\\n\u9700\u8981\u6ce8\u610f\u7684\u70b9\uff1a\\n\\n- \u9664\u51fd\u6570\u4ee5\u5916\u7684\u503c\u4f1a\u88ab\u8fc7\u6ee4\uff0c\u53ea\u5904\u7406\u5bf9\u8c61\u91cc\u7684\u51fd\u6570\u3002\\n- \u5728\u8fd4\u56de\u51fd\u6570\u91cc\u4f1a\u6bd4\u8f83\u524d\u540e\u72b6\u6001\uff0c\u5982\u679c\u672a\u53d8\u5316\u5219\u8fd4\u56de\u65e7\u72b6\u6001\\n\\n#### \u4e8c\u3001compose\\n\\n##### 1. compose \u6709\u4ec0\u4e48\u4f5c\u7528\uff1f\\n\\n`compose`\u4e3b\u8981\u7528\u4e8e\u4e2d\u95f4\u4ef6\u7684\u6574\u5408\uff0c\u63a5\u6536\u591a\u4e2a\u51fd\u6570\u4f20\u53c2\uff0c\u8fd4\u56de\u5355\u4e2a\u51fd\u6570\u3002\u5f53\u6267\u884c\u8fd4\u56de\u51fd\u6570\u65f6\uff0c\u76f8\u5f53\u4e8e\u5d4c\u5957\u6267\u884c\u4f20\u53c2\u7684\u51fd\u6570\u3002\\n\\n\u8bf4\u8d77\u6765\u6bd4\u8f83\u7ed5\uff0c\u53ef\u4ee5\u770b\u4e0b\u8fb9\u7684\u4f8b\u5b50\u7406\u89e3\\n\\n```javascript\\ncompose(a, b, c); // a b c Function\\n\\n//\u2193\u2193\u2193\u7b49\u4ef7\u4e8e\u2193\u2193\u2193\\n\\nfunction Fn(...args) {\\n  return a(b(c(...args)));\\n}\\n```\\n\\n##### 2. \u5982\u4f55\u5b9e\u73b0\uff1f\\n\\n\u601d\u8def\u5f88\u7b80\u5355\uff0c\u53ef\u4ee5\u7528\u5faa\u73af\u904d\u5386\uff0c\u8fd4\u56de\u5d4c\u5957\u51fd\u6570\uff0c\u4e5f\u53ef\u4ee5\u7528`reduce`\u65b9\u6cd5\\n\\n```javascript\\n//\u7b2c\u4e00\u79cd\\nfunction compose(...fns) {\\n  if (fns.length === 0) {\\n    return;\\n  }\\n\\n  let componseFn = (...args) => fns[0](...args);\\n\\n  for (let i = 1; i < fns.length; i++) {\\n    let prevFn = componseFn;\\n    componseFn = (...args) => prevFn(fns[i](...args));\\n  }\\n\\n  return componseFn;\\n}\\n\\n//\u7b2c\u4e8c\u79cd\\nfunction compose(...fns) {\\n  if (fns.length === 0) {\\n    return (arg) => arg;\\n  }\\n\\n  if (fns.length === 1) {\\n    return fns[0];\\n  }\\n\\n  return fns.reduce((a, b) => {\\n    return (...args) => a(b(...args));\\n  });\\n}\\n```\\n\\n#### \u4e09\u3001createStore\\n\\n`createStore`\u6700\u591a\u53ef\u4ee5\u63a5\u6536\u4e09\u4e2a\u4f20\u53c2\uff0c\u5206\u522b\u662f`reducer, preloadedState, enhancer`\\n\\n> `reducer`\u4e3a\u5fc5\u4f20\u9879\uff0c`preloadedState`\u548c`enhancer`\u4e3a\u975e\u5fc5\u4f20\uff0c\u5f53\u53ea\u4f20\u9012\u4e24\u4e2a\u53c2\u6570\u65f6\uff0c`createStore`\u4f1a\u68c0\u67e5\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7684\u7c7b\u578b\uff0c\u5982\u4f55\u662f function \u7c7b\u578b\u7684\u8bdd\u6309`enhancer`\u5904\u7406\uff0c\u5176\u4ed6\u60c5\u51b5\u4f1a\u5f53\u4f5c`preloadedState`\\n\\n- `reducer`\uff1a\u54cd\u5e94 action\uff0c\u66f4\u65b0 state\\n- `preloadState`\uff1a\u521d\u59cb\u5316 state\\n- `enhancer`\uff1a`applyMiddlewares`\u8fd4\u56de\u7684\u51fd\u6570\uff0c\u7528\u4e8e\u589e\u5f3a`dispatch`\u7684\u529f\u80fd\\n\\n`reducer`\u65b9\u6cd5\u4f20\u53c2\u91cc\u63d0\u4f9b\u521d\u59cb\u503c\u4e5f\u53ef\u4ee5\u8fbe\u5230\u521d\u59cb\u5316 state \u7684\u6548\u679c\uff0c\u4f46\u548c\u4f7f\u7528`preloadState`\u5b58\u5728\u4e00\u4e9b\u533a\u522b\\n\\n> `preloadState`\u521d\u59cb\u5316 state \u5728`createStore`\u6267\u884c\u65f6\u751f\u6548\uff0c\u800c\u51fd\u6570\u4f20\u53c2\u521d\u59cb\u503c\u5fc5\u987b\u8981\u5728\u89e6\u53d1\u52a8\u4f5c\u5e76\u6267\u884c reducer \u51fd\u6570\u540e\u624d\u4f1a\u751f\u6548\uff0c\u4f46\u4e8b\u5b9e\u4e0a\uff0c`createStore`_\u5728\u8fd4\u56de\u7ed3\u679c\u524d\u4f1a\u4e3b\u52a8\u89e6\u53d1\u4e00\u4e2a\u521d\u59cb\u5316\u52a8\u4f5c_\uff08\u6307 action\uff09\uff0c\u6240\u4ee5\u8fd9\u4e24\u8005\u90fd\u80fd\u8fbe\u5230\u521d\u59cb\u5316 state \u7684\u6548\u679c\u3002\\n>\\n> \u5b9e\u9645\u5f00\u53d1\u4e2d\u521d\u59cb\u5316\u6570\u636e\u653e\u5728 reducer \u91cc\u591a\u4e00\u4e9b\uff0c\u5206\u5272\u521d\u59cb\u72b6\u6001\u7684\u540c\u65f6\u4e5f\u80fd\u76f4\u89c2\u770b\u5230\u5bf9\u5e94\u7684\u72b6\u6001\\n\\n`createStore`\u8fd4\u56de`{dispatch<Function>, getState<Function>, subscribe<Function>}`\\n\\n##### 1. \u5b9a\u4e49 createStore \u7684\u4f20\u53c2\u548c\u8f93\u51fa\\n\\n```javascript\\nfunction createStore(reducer, enhancer) {\\n  let currentState,\\n    listeners = [];\\n\\n  function dispatch() {}\\n  function subscribe() {}\\n  function getState() {}\\n\\n  return {\\n    dispatch,\\n    subscribe,\\n    getState,\\n  };\\n}\\n```\\n\\n\u786e\u8ba4`dispatch`\u3001`getState`\u3001`subscribe`\u7684\u4f5c\u7528\\n\\n- `dispatch`\uff1a\u89e6\u53d1\u4e00\u4e2a\u52a8\u4f5c\uff0c\u4fee\u6539 state\uff0c\u5e76\u89e6\u53d1\u6240\u6709\u7684\u76d1\u542c\u51fd\u6570\\n- `getState`\uff1a\u8fd4\u56de\u5f53\u524d\u7684 state\\n- `subscribe`\uff1a\u8ba2\u9605\u76d1\u542c\u51fd\u6570\uff0c\u8fd4\u56de\u53d6\u6d88\u8ba2\u9605\u65b9\u6cd5\\n\\n##### 2. \u8865\u5168\u65b9\u6cd5\\n\\n```javascript\\nfunction createStore(reducer, enhancer) {\\n  let currentState,\\n    listeners = [];\\n\\n  function dispatch(action) {\\n    currentState = reducer(currentState, action);\\n\\n    for (let i = 0; i < listeners.length; i++) {\\n      listeners[i]();\\n    }\\n  }\\n  function subscribe(handleStoreChange) {\\n    listeners.push(handleStoreChange);\\n\\n    return function unsubscribe() {\\n      const index = listeners.indexOf(handleStoreChange);\\n\\n      listeners.splice(index, 1);\\n    };\\n  }\\n  function getState() {\\n    return currentState;\\n  }\\n\\n  dispatch({ type: \\"INIT\\" }); // \u521d\u59cb\u5316\\n\\n  return {\\n    dispatch,\\n    subscribe,\\n    getState,\\n  };\\n}\\n```\\n\\n#### \u56db\u3001applyMiddleware\\n\\n##### 1. \u4e2d\u95f4\u4ef6\\n\\n\u4f20\u5165\u7684\u4e2d\u95f4\u4ef6\u5fc5\u987b\u662f\u89c4\u5b9a\u7684\u67ef\u91cc\u5316\u51fd\u6570`({ getState, dispatch }) => next => action`\u3002\\n\\n> next \u4e3a\u4e0b\u4e00\u4e2a\u4e2d\u95f4\u4ef6\uff0c\u53ea\u6709\u5f53\u6700\u540e\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u65f6\u624d\u4f1a\u662f dispatch\\n\\n\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a\uff1a\\n\\n```javascript\\n({ getState, dispatch }) =>\\n  (next) =>\\n    action;\\n\\n//\u2193\u2193\u2193\u7b49\u4ef7\u4e8e\u2193\u2193\u2193\\n\\nfunction middleware({ getState, dispatch }) {\\n  return function (next) {\\n    return function (action) {\\n      // ...do something\\n      return next(action);\\n    };\\n  };\\n}\\n```\\n\\n\u6267\u884c\u4e2d\u95f4\u4ef6\u9700\u8981\u63d0\u524d\u4f20\u9012`getState\u3001dispatch`\uff0c\u4ee5\u53ca\u7ed1\u5b9a next\\n\\n> \u8fd9\u90e8\u5206\u4ee3\u7801\u4e0d\u591a\uff0c\u4f46\u590d\u6742\u7a0b\u5ea6\u5374\u662f\u6700\u9ad8\u7684\uff0c\u5efa\u8bae\u63d0\u524d\u770b\u4e0b\u6e90\u7801\u6216\u662f\u4e86\u89e3\u4e0b\u6d0b\u8471\u6a21\u578b\u3002\\n\\n##### 2. \u6e90\u7801(\u7b80\u5316\u7248)\\n\\n```javascript\\nfunction createStore(reducer, enhancer) {\\n  ...\\n\\n  if (typeof enhancer === \\"function\\") {\\n    return enhancer(createStore)(reducer);\\n  }\\n\\n  ...\\n}\\n\\nfunction applyMiddleware(...middlewares) {\\n  return function(createStore) {\\n    return function(reducer) {\\n      const store = createStore(reducer);\\n\\n      let chain = [];\\n      let dispatch = store.dispatch;\\n\\n      const middlewareAPI = {\\n        dispatch: action => dispatch(action),\\n        getState: store.getState\\n      }\\n      chain = middlewares.map(middleware => middleware(middlewareAPI));\\n      dispatch = compose(...chain)(store.dispatch);\\n\\n      return {\\n        ...store,\\n        dispatch\\n      };\\n    };\\n  };\\n}\\n```\\n\\n\u5f53`createStore`\u4f20\u5165\u4e2d\u95f4\u4ef6\u65f6\uff0c\u4f1a\u628a\u81ea\u5df1\u4f20\u7ed9`enhancer`\uff0c\u5728\u91cc\u9762\u8fdb\u884c`store`\u7684\u521b\u5efa\uff0c\u4ee5\u53ca`dispatch`\u7684\u7ed1\u5b9a\u3002\\n\\n\u5176\u4e2d\u6700\u91cd\u8981\u6700\u590d\u6742\u7684\u7ed1\u5b9a\u90e8\u5206\u4ee3\u7801\uff0c\u53ea\u6709\u4e24\u6761\u3002\\n\\n```javascript\\nchain = middlewares.map((middleware) => middleware(middlewareAPI));\\ndispatch = compose(...chain)(store.dispatch);\\n```\\n\\n- \u7b2c\u4e00\uff1a\u4f7f\u7528`map`\u4e3a\u6bcf\u4e2a\u4e2d\u95f4\u7ed1\u5b9a`dispatch\u3001getState`\\n- \u7b2c\u4e8c\uff1a\u901a\u8fc7`compose`\u5408\u5e76\u6210\u4e00\u4e2a\u51fd\u6570\uff0c\u4f20\u9012`dispatch`\u7ed1\u5b9a\u4e2d\u95f4\u4ef6\u91cc\u7684 next\uff0c\u5f97\u5230\u65b0\u7684`dispatch`\u3002\\n\\n\u7b2c\u4e00\u53e5\u5f88\u597d\u7406\u89e3\uff0c\u7b2c\u4e8c\u53e5\u4e5f\u4e0d\u96be\uff0c`compose`\u4e0a\u9762\u6709\u8bb2\u89e3\uff0c\u6700\u540e\u5269\u4e0b\u4e00\u70b9\uff0c\u90a3\u5c31\u662f next \u7684\u7ed1\u5b9a\u3002\\n\\n##### 3. \u7ed1\u5b9a next\\n\\n\u4e2d\u95f4\u4ef6\u5b9a\u4e49\u4f2a\u4ee3\u7801\u3002\\n\\n```javascript\\nfunction middlewareA({ dispatch, getState }) {\\n  return function (next) {\\n    return function (action) {\\n      console.log(\\"Middleware A\\");\\n      return next(action);\\n    };\\n  };\\n}\\nfunction middlewareB({ dispatch, getState }) {\\n  return function (next) {\\n    return function (action) {\\n      console.log(\\"Middleware B\\");\\n      next(action);\\n    };\\n  };\\n}\\n// middlewares = [middlewareA, middlewareB]\\n\\n// middlewares.map((middleware) => middleware(middlewareAPI));\\nfunction middlewareAAfterMap(next) {\\n  //\u95ed\u5305\u91cc\u4fdd\u6301\u7740{getState, dispatch}\\n  return function (action) {\\n    console.log(\\"Middleware A do something\\");\\n    return next(action);\\n    console.log(\\"Middleware A finish\\");\\n  };\\n}\\nfunction middlewareBAfterMap(next) {\\n  //\u95ed\u5305\u91cc\u4fdd\u6301\u7740{getState, dispatch}\\n  return function (action) {\\n    console.log(\\"Middleware B do something\\");\\n    next(action);\\n    console.log(\\"Middleware B finish\\");\\n  };\\n}\\n// chain = [middlewareAAfterMap, middlewareBAfterMap]\\n\\n// composedFn = compose(...chain);\\nfunction composedFn(...args) {\\n  return middlewareAAfterMap(middlewareBAfterMap(...args));\\n}\\n\\n// newDispatch = composedFn(dispatch);\\n// newDispatch = middlewareAAfterMap(middlewareBAfterMap(dispatch))\\nfunction newDispatch(action) {\\n  return middlewareAAfterMap(function (action) {\\n    console.log(\\"Middleware B do something\\");\\n    dispatch(action);\\n    console.log(\\"Middleware B finish\\");\\n  });\\n}\\n\u2193\u2193\u2193\\nfunction newDispatch(action) {\\n  return function (action) {\\n    console.log(\\"Middleware A do something\\");\\n    console.log(\\"Middleware B do something\\");\\n    dispatch(action);\\n    console.log(\\"Middleware B finish\\");\\n    console.log(\\"Middleware A finish\\");\\n  };\\n}\\n```\\n\\n##### 4. \u7ed1\u5b9a\u987a\u5e8f\u548c\u6267\u884c\u987a\u5e8f\\n\\n`applyMiddleware`\u53ef\u4ee5\u63a5\u6536\u591a\u4e2a\u4e2d\u95f4\u4ef6\u4f20\u53c2\uff0c\u5e76\u4ece\u53f3\u5230\u5de6\u4f9d\u6b21\u7ed1\u5b9a\u4e2d\u95f4\u4ef6\uff0c\u4f46\u5f53`dispatch`\u65f6\uff0c\u4e2d\u95f4\u4ef6\u7684\u6267\u884c\u987a\u5e8f\u5374\u662f\u4ece\u5de6\u5230\u53f3\uff08\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48`redux-logger`\u8981\u653e\u5728\u6700\u540e\u9762\uff09\u3002\\n\\n\u4e3a\u4ec0\u4e48\u6267\u884c\u987a\u5e8f\u662f\u76f8\u53cd\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u6a21\u578b\u7406\u89e3\\n\\n```\\n \u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\\n| dispatch  |\\n \u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\\n\\n\u2193\u2193\u2193\u7ed1\u5b9a\u4e2d\u95f4\u4ef6\u2193\u2193\u2193\\n\\n -------------------\\n|    redux-thunk    |\\n|  ---------------  |\\n| |  redux-logger | |\\n| |  \u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014  | |\\n| | | dispatch  | | |\\n| |  \u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014  | |\\n|  ---------------  |\\n -------------------\\n```\\n\\n\u7ed1\u5b9a\u4e2d\u95f4\u4ef6\u76f8\u5f53\u4e8e\u5728`dispatch`\u5916\u5305\u4e00\u5c42\u53c8\u4e00\u5c42\u7684\u88f9\u4e0a\uff0c\u800c\u5f53\u6267\u884c\u4e2d\u95f4\u4ef6\u65f6\u5219\u9700\u8981\u4ece\u5916\u5230\u5185\u987a\u5e8f\u6267\u884c\uff0c\u6240\u4ee5\u6267\u884c\u987a\u5e8f\u548c\u7ed1\u5b9a\u987a\u5e8f\u662f\u76f8\u53cd\u7684\\n\\n##### 5. \u5b9e\u73b0\\n\\n\u5149\u770b\u8fd8\u4e0d\u591f\uff0c\u53ea\u6709\u5b9e\u9645\u52a8\u624b\u540e\u624d\u4f1a\u660e\u767d\u91cc\u9762\u7684\u7ec6\u8282\u548c\u5173\u952e\uff0c\u6700\u540e\u662f\u6211\u7684\u5b9e\u73b0\u3002\\n\\n```javascript\\nfunction applyMiddleware(...middlewares) {\\n  return function({ getState, dispatch }) {\\n    return function(next) {\\n      return compose(\\n        ...middlewares.map(middleware => {\\n          return middleware({ getState, dispatch });\\n        })\\n      )(next);\\n    };\\n  };\\n}\\n\\n\\nfunction createStore(reducer, enhancer) {\\n  let dispatch = function(action) {\\n    ...\\n  };\\n  const subscribe = function(handleStoreChange) {\\n    ...\\n  };\\n  const getState = function() {\\n    ...\\n  };\\n\\n  let currentState = {};\\n  let listeners = [];\\n  let dispatchWithMiddleware = dispatch;\\n\\n  dispatch({ type: \\"INIT\\" }); // \u521d\u59cb\u5316\\n  if (typeof enhancer === \\"function\\") {\\n    dispatchWithMiddleware = enhancer({\\n      dispatch: action => dispatchWithMiddleware(action),\\n      getState\\n    })(dispatch);\\n  }\\n\\n  return {\\n    dispatch: dispatchWithMiddleware,\\n    subscribe,\\n    getState\\n  };\\n}\\n```\\n\\n\u5199\u6cd5\u4e0a\u6709\u533a\u522b\uff0c\u4f46\u6838\u5fc3\u5185\u5bb9\u4e0a\u6ca1\u6709\u533a\u522b\u3002\\n\\n##### 6. \u6ce8\u610f\\n\\n\u53ef\u80fd\u6709\u4e9b\u4eba\u5df2\u7ecf\u6ce8\u610f\u5230\u4e86\u5947\u602a\u7684\u5730\u65b9\u3002\\n\\n```javascript\\n//\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u4f20dispatch\\n{\\n  dispatch, getState;\\n}\\n//\u800c\u662f\u4f20\u9012\u533f\u540d\u51fd\u6570\\n{\\n  dispatch: (action) => dispatchWithMiddleware(action), getState;\\n}\\n```\\n\\n\u539f\u56e0\u5728\u4e8e\u6709\u4e9b\u4e2d\u95f4\u4ef6\u4f1a\u4f7f\u7528\u7ed1\u5b9a\u7684`dispatch`\u65b9\u6cd5\uff0c\u6bd4\u5982`redux-thunk`\uff0c\u6240\u4ee5\u8981\u4fdd\u8bc1**\u4f20\u5165\u7684`dispatch`\u4e0e\u5916\u90e8`dispatchWithMiddleware`\u4fdd\u6301\u76f8\u540c**\u3002\\n\\n`dispatchWithMiddleware`\u4e3a\u5f15\u7528\u7c7b\u578b\uff0c\u5728\u7ed1\u5b9a\u4e2d\u95f4\u4ef6\u540e\u53c8\u4f1a\u91cd\u65b0\u8d4b\u503c\uff0c\u6240\u4ee5\u8fd9\u91cc\u6700\u597d\u7684\u89e3\u6cd5\u5c31\u662f\u201c\u95ed\u5305\u201d\uff0c\u5c06\u53d8\u91cf\u5b58\u5728\u5185\u5b58\u91cc\u7ef4\u6301\u8d77\u6765\u3002\\n\\n\u6240\u4ee5\u8fd9\u91cc\u4f20\u5165\u51fd\u6570\uff0c\u662f\u4e3a\u4e86\u89e6\u53d1\u95ed\u5305\u7ef4\u6301\u53d8\u91cf\u3002\\n\\n#### \u53c2\u8003\u8d44\u6599\\n\\n[Redux \u4ece\u8bbe\u8ba1\u5230\u6e90\u7801](https://tech.meituan.com/2017/07/14/redux-design-code.html)\\n\\n[\u56fe\u89e3 Redux \u4e2d middleware \u7684\u6d0b\u8471\u6a21\u578b](https://github.com/fi3ework/blog/issues/14)"},{"id":"/2020/06/30/what_is_reselect","metadata":{"permalink":"/blog/2020/06/30/what_is_reselect","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-06-30-what_is_reselect.md","source":"@site/blog/2020-06-30-what_is_reselect.md","title":"\u4ec0\u4e48\u662f Reselect","description":"\u4ec0\u4e48\u662f Reselect","date":"2020-06-30T00:00:00.000Z","formattedDate":"2020\u5e746\u670830\u65e5","tags":[],"readingTime":1.24,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u4ec0\u4e48\u662f Reselect","authors":"youniaogu","date":"2020-06-30T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u5982\u4f55\u5b9e\u73b0 Redux","permalink":"/blog/2020/07/20/how_to_implement_redux"},"nextItem":{"title":"\u8fd4\u56de\u51fd\u6570\u7684\u51fd\u6570","permalink":"/blog/2020/06/27/function_return_function"}},"content":"### \u4ec0\u4e48\u662f Reselect\\n\\n> react-redux \u6027\u80fd\u4f18\u5316\u5e93\\n\\n#### Reselect \u89e3\u51b3\u4e86\u4ec0\u4e48\uff1f\\n\\n> \u524d\u63d0\uff1a\u5728 react-redux \u91cc\uff0c\u6bcf\u5f53 state \u53d8\u5316\u65f6\uff0c\u4e3a\u4e86\u6bd4\u8f83\u524d\u540e\u7684\u72b6\u6001\uff0c\u90fd\u4f1a\u8c03\u7528 mapStateToProps \u83b7\u53d6\u6700\u65b0\u7684\u7ed3\u679c\\n\\n\u5f53`mapStateToProps`\u7684\u903b\u8f91\u6bd4\u8f83\u91cd\u65f6\uff0c\u5c06\u4f1a\u662f\u4e00\u4e2a\u5f88\u5927\u7684\u5f00\u9500\uff0c`reselect`\u7684\u76ee\u7684\u5c31\u662f\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e9b\u65e0\u7528\u7684\u5f00\u9500\u3002\\n\\n#### Reselect \u505a\u4e86\u4ec0\u4e48\uff1f\\n\\n\u5148\u6765\u770b\u4e00\u4e0b`reselect`\u7684\u7528\u6cd5\uff1a\\n\\n```javascript\\nimport { createSelector } from \'reselect\';\\n\\n//createSelector(...inputSelectors | [inputSelectors], resultFunc)\\n@connect(createSelector(\\n  (state, ownProps) => state.counter,\\n  (counter) => {\\n    return {\\n      counter,\\n    };\\n  },\\n), {\\n  dispatchAdd,\\n  dispatchReduce,\\n});\\n```\\n\\n`createSelector`\u9700\u8981\u4e24\u4e2a\u53c2\u6570\uff0c`inputSelectors`\u548c`resultFunc`\\n\\n`inputSelectors`\u53ef\u4ee5\u4e3a\u6570\u7ec4\uff0c\u4e5f\u53ef\u4ee5\u662f\u591a\u4e2a\u51fd\u6570\uff0c\u91cc\u9762\u8fd4\u56de\u9700\u8981\u7528\u6765\u8ba1\u7b97\u7684\u5b57\u6bb5\uff0c\u8fd9\u4e9b\u5b57\u6bb5\u4f1a\u4f5c\u4e3a`resultFunc`\u65b9\u6cd5\u7684\u4f20\u53c2\uff0cresultFunc \u5219\u662f\u7528\u6765\u8ba1\u7b97\u6700\u540e\u7684`props`\uff08\u529f\u80fd\u5bf9\u5e94\u4e4b\u524d\u7684`mapStateToProps`\uff09\\n\\n`reselect`\u4f1a\u4fdd\u5b58`mapStateToProps`\u7684\u7ed3\u679c\uff0c\u5f53\u7528\u6765\u8ba1\u7b97\u7684\u53c2\u6570\u672a\u53d1\u751f\u6539\u53d8\u65f6\uff08\u6d45\u6bd4\u8f83\uff09\uff0c`resultFunc`\u4f1a\u76f4\u63a5\u8fd4\u56de\u65e7\u7684\u8ba1\u7b97\u7ed3\u679c\uff0c\u4ece\u800c\u907f\u514d\u4e86\u65e0\u7528\u7684\u8ba1\u7b97\u5f00\u9500"},{"id":"/2020/06/27/function_return_function","metadata":{"permalink":"/blog/2020/06/27/function_return_function","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-06-27-function_return_function.md","source":"@site/blog/2020-06-27-function_return_function.md","title":"\u8fd4\u56de\u51fd\u6570\u7684\u51fd\u6570","description":"\u8fd4\u56de\u51fd\u6570\u7684\u51fd\u6570","date":"2020-06-27T00:00:00.000Z","formattedDate":"2020\u5e746\u670827\u65e5","tags":[],"readingTime":1.765,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u8fd4\u56de\u51fd\u6570\u7684\u51fd\u6570","authors":"youniaogu","date":"2020-06-27T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u4ec0\u4e48\u662f Reselect","permalink":"/blog/2020/06/30/what_is_reselect"},"nextItem":{"title":"\u5982\u4f55\u5b9a\u4e49 Action type","permalink":"/blog/2020/06/27/how_to_definition_action_type"}},"content":"### \u8fd4\u56de\u51fd\u6570\u7684\u51fd\u6570\\n\\n\u51fd\u6570\u91cc\u80fd\u591f\u8fd4\u56de\u51fd\u6570\u662f js \u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u6280\u5de7\uff0c\u80fd\u8ba9\u6211\u4eec\u8282\u7701\u5f88\u591a\u4ee3\u7801\u7a7a\u95f4\\n\\nreact \u91cc\u7ecf\u5e38\u9700\u8981\u5728`map`\u8fd4\u56de\u7684\u5143\u7d20\u91cc\u7ed1\u5b9a\u4e8b\u4ef6\uff0c\u8fd9\u79cd\u65f6\u5019\u6211\u4eec\u7ecf\u5e38\u4f1a\u4f7f\u7528\u8fd9\u4ee5\u6280\u5de7\\n\\n```javascript\\nhandleClick = (index) => {\\n  return () => {\\n    console.log(index);\\n  };\\n};\\n\\nlist.map((obj, index) => {\\n  return (\\n    <div key={index} onClick={this.handleClick(index)}>\\n      index\\n    </div>\\n  );\\n});\\n```\\n\\n\u8fd9\u4e00\u6280\u5de7\u9700\u8981\u6d88\u8017\u8d44\u6e90\uff0c\u56e0\u4e3a\u6bcf\u6b21\u6267\u884c\u90fd\u8981\u521b\u5efa\u8fd4\u56de\u7684\u51fd\u6570\uff0c\u800c\u4e14\u6709\u53ef\u80fd\u4f7f\u7528\u5230\u95ed\u5305\u3002\u5f53\u5217\u8868\u6570\u636e\u7279\u522b\u591a\u65f6\uff0c\u8fd9\u79cd\u5f00\u9500\u4f1a\u653e\u5927\uff0c\u5bfc\u81f4 render \u901f\u5ea6\u4e0b\u964d\\n\\n\u6240\u4ee5\u5982\u679c\u4e0d\u662f\u7279\u522b\u4f9d\u8d56\u95ed\u5305\u7684\u8bdd\uff0c\u53ef\u4ee5\u628a\u6570\u636e\u6302\u5728 dom \u5143\u7d20\u4e0a\uff0c\u901a\u8fc7`event`\u5bf9\u8c61\u53bb\u83b7\u53d6\uff0c\u8fd9\u6837\u53ea\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u51fd\u6570\\n\\n```javascript\\nhandleClick = (evt) => {\\n  console.log(evt.currentTarget.dataset.index);\\n};\\n\\nlist.map((obj, index) => {\\n  return (\\n    <div data-index={index} key={index} onClick={this.handleClick}>\\n      index\\n    </div>\\n  );\\n});\\n```\\n\\n\u6700\u540e\u8fd8\u53ef\u4ee5\u7528\u4e8b\u4ef6\u4ee3\u7406\u518d\u8fdb\u884c\u4f18\u5316\\n\\n```javascript\\nhandleClick = evt => {\\n  evt.preventDefault();\\n  console.log(evt.target.dataset.index);\\n};\\n\\n<div onClick={this.handleClick}>\\n  list.map((obj, index) => {\\n    return (\\n      <div data-index={index} key={index}>\\n        index\\n      </div>\\n    );\\n  });\\n</div>\\n```\\n\\n#### \u9898\u5916\u8bdd\\n\\n\u5173\u4e8e`evt.target`\u548c`evt.currentTarget`\u7684\u533a\u522b\\n\\n- `target`\u6307\u7684\u662f\u5f53\u524d\u89e6\u53d1\u4e8b\u4ef6\u7684\u5143\u7d20\\n- `currentTarget`\u6307\u7684\u662f\u7ed1\u5b9a\u4e8b\u4ef6\u7684\u5143\u7d20\\n\\n\u4e3e\u4e2a\u4f8b\u5b50\uff1a\\n\\n```javascript\\nhandleClick = (evt) => {\\n  console.log({\\n    target: evt.target,\\n    currentTraget: evt.currentTarget,\\n  });\\n};\\n```\\n\\n```html\\n<div class=\\"wrapper\\" onClick=\\"{this.handleClick}\\">\\n  <p>dom1</p>\\n</div>\\n```\\n\\n\u5f53\u70b9\u51fb dom1 \u65f6\uff0c`target`\u4e3a p \u5143\u7d20\uff0c\u800c`currentTarget`\u5219\u662f div \u5143\u7d20\uff0c\u56e0\u4e3a\u4e8b\u4ef6\u7ed1\u5b9a\u5728\u5b83\u4e0a\u9762"},{"id":"/2020/06/27/how_to_definition_action_type","metadata":{"permalink":"/blog/2020/06/27/how_to_definition_action_type","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-06-27-how_to_definition_action_type.md","source":"@site/blog/2020-06-27-how_to_definition_action_type.md","title":"\u5982\u4f55\u5b9a\u4e49 Action type","description":"\u5982\u4f55\u5b9a\u4e49 Action type","date":"2020-06-27T00:00:00.000Z","formattedDate":"2020\u5e746\u670827\u65e5","tags":[],"readingTime":1.73,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u5982\u4f55\u5b9a\u4e49 Action type","authors":"youniaogu","date":"2020-06-27T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u8fd4\u56de\u51fd\u6570\u7684\u51fd\u6570","permalink":"/blog/2020/06/27/function_return_function"},"nextItem":{"title":"\u5982\u4f55\u5b9e\u73b0 React-redux","permalink":"/blog/2020/06/27/how_to_implement_react-redux"}},"content":"### \u5982\u4f55\u5b9a\u4e49 Action type\\n\\n\u5728\u5199 redux \u65f6\uff0c\u9700\u8981\u5b9a\u4e49 action type\uff0c\u5f80\u5f80\u6211\u4eec\u4f1a\u76f4\u63a5\u5199\u6210\u5b57\u7b26\u4e32\uff0c\u800c\u6709\u4e9b\u60c5\u51b5\u5219\u4f1a\u5199\u6210\u53d8\u91cf\u518d\u4f20\u9012\u8fc7\u53bb\\n\\n\u90a3\u4e48\u5b9a\u4e49\u4e3a\u53d8\u91cf\u6709\u4ec0\u4e48\u597d\u5904\u548c\u574f\u5904\uff1f\\n\\n#### 1. \u597d\u5904\uff1a\u80fd\u591f\u5f88\u597d\u5b9a\u4f4d\u62fc\u5199\u9519\u8bef\\n\\n```javascript\\n// actions.js\\nconst LOAD_USER_LIST = \\"LOAD_USER_LIST\\";\\nconst LOAD_USER_INFO = \\"LOAD_USER_INFO\\";\\n\\n// userList.js\\nimport {LOAD_USER_LIST, LOAD_USER_DETAIL} from \'./actions\'\uff1b\\n// Attempted import error: \'LOAD_USER_DETAIL\' is not exported from \'./action\'\\n// \u8fd9\u91cc\u4f1a\u63d0\u793a\u62a5\u9519\uff0cLOAD_USER_DETAIL\u4e0d\u5b58\u5728\\n```\\n\\n\u5f53\u5f15\u5165\u4e0d\u5b58\u5728\u7684`action`\u53d8\u91cf\u65f6\u5e94\u7528\u4f1a\u7f16\u8bd1\u5931\u8d25\uff0c\u80fd\u591f\u5f88\u597d\u7684\u63d0\u793a\u6211\u4eec\\n\\n```javascript\\nexport function loadUserInfo(id) {\\n  return {\\n    type: \\"LOAD_USER_DETAIL\\", //\u6b63\u786e\u5e94\u8be5\u662ftype: \\"LOAD_USER_INFO\\",\\n    id,\\n  };\\n}\\n```\\n\\n\u5f53`action`\u4e3a\u5b57\u7b26\u4e32\u65f6\uff0c\u5e76\u4e0d\u4f1a\u63d0\u793a\u62a5\u9519\uff0c\u4f46\u5bf9\u5e94\u7684`reducer`\u4e0e`saga`\u90e8\u5206\u4e0d\u4f1a\u8fd0\u884c\uff0c\u800c\u5f80\u5f80\u4e3a\u4e86\u627e\u51fa\u8fd9\u79cd\u4f4e\u7ea7\u9519\u8bef\uff0c\u4f1a\u6d6a\u8d39\u5f88\u591a\u65f6\u95f4\\n\\n#### 2. \u574f\u5904\uff1a\u4f7f\u7528\u65f6\u4f1a\u9ebb\u70e6\u4e00\u4e9b\uff0c\u9700\u8981\u5f15\u5165`action`\\n\\n```javascript\\n// sagas.js | createAction.js | reducers.js\\nimport { LOAD_USER_LIST, LOAD_USER_INFO } from \\"./actions.js\\";\\n```\\n\\n#### 3. \u601d\u8003\\n\\n\u5927\u9879\u76ee\u903b\u8f91\u590d\u6742\u67e5\u9519\u4e0d\u6613\uff0c`action`\u5b9a\u4e49\u4e3a\u53d8\u91cf\u66f4\u4e3a\u4e25\u8c28\uff0c\u53ef\u4ee5\u89c4\u907f\u4e00\u4e9b\u4f4e\u7ea7\u9519\u8bef\\n\\n\u5c0f\u9879\u76ee\u8981\u6c42\u5feb\u901f\u5f00\u53d1\uff0c`action`\u5b9a\u4e49\u4e3a\u5b57\u7b26\u4e32\u66f4\u4e3a\u76f4\u63a5\uff0c\u80fd\u591f\u52a0\u5feb\u5f00\u53d1\u6548\u7387\\n\\n\u5f88\u591a\u65f6\u5019\uff0c\u6211\u4eec\u4e0d\u80fd\u4e00\u5473\u7684\u6a21\u8303\uff0c\u800c\u662f\u8981\u601d\u8003\u4e3a\u4ec0\u4e48\u8981\u8fd9\u6837\u505a\uff0c\u5176\u4e2d\u7684\u5229\u4e0e\u5f0a\u662f\u4ec0\u4e48\uff0c\u9002\u5408\u81ea\u5df1\u7684\u624d\u662f\u6700\u597d\u7684"},{"id":"/2020/06/27/how_to_implement_react-redux","metadata":{"permalink":"/blog/2020/06/27/how_to_implement_react-redux","editUrl":"https://github.com/youniaogu/youniaogu.github.io/blog/2020-06-27-how_to_implement_react-redux.md","source":"@site/blog/2020-06-27-how_to_implement_react-redux.md","title":"\u5982\u4f55\u5b9e\u73b0 React-redux","description":"\u5982\u4f55\u5b9e\u73b0 React-redux","date":"2020-06-27T00:00:00.000Z","formattedDate":"2020\u5e746\u670827\u65e5","tags":[],"readingTime":7.455,"hasTruncateMarker":false,"authors":[{"name":"youniaogu","title":"\u4f5c\u8005","url":"https://github.com/youniaogu","email":"youniaogu2023@gmail.com","imageURL":"https://github.com/youniaogu.png","key":"youniaogu"}],"frontMatter":{"title":"\u5982\u4f55\u5b9e\u73b0 React-redux","authors":"youniaogu","date":"2020-06-27T00:00:00.000Z","tags":[]},"prevItem":{"title":"\u5982\u4f55\u5b9a\u4e49 Action type","permalink":"/blog/2020/06/27/how_to_definition_action_type"}},"content":"### \u5982\u4f55\u5b9e\u73b0 React-redux\\n\\n> \u793a\u4f8b demo\uff1a[github](https://github.com/youniaogu/simple-react-redux)\\n>\\n> \u6ce8\u610f\uff1a\u4e3a\u4e86\u7b80\u5355\u660e\u4e86\u7684\u5c55\u793a\u4e3b\u8981\u6d41\u7a0b\uff0c\u4e0b\u9762\u793a\u4f8b\u4e2d\u5747\u4f1a\u7701\u7565\u5f02\u5e38\u60c5\u51b5\u7684\u5904\u7406\u3002\\n\\n#### \u4e00\u3001\u4ec0\u4e48\u662f react-redux\uff1f\\n\\n`react-redux`\u662f redux \u7684\u4e2d\u95f4\u4ef6\uff0c\u901a\u8fc7 `connect`\u548c`Provider`\u8fd9\u4e24\u4e2a api\uff0c\u5c06\u7ec4\u4ef6\u9700\u8981\u7684\u72b6\u6001\u6ce8\u5165\u8fdb\u53bb\uff0c\u5f53 redux \u91cc\u7684\u72b6\u6001\u53d1\u751f\u6539\u53d8\u65f6\uff0c\u89e6\u53d1\u76f8\u5e94\u7ec4\u4ef6\u7684\u66f4\u65b0\\n\\n#### \u4e8c\u3001react-redux \u662f\u600e\u4e48\u5de5\u4f5c\u7684\uff1f\\n\\n\u5148\u770b\u4e00\u4e2a\u7b80\u5355\u7684\u7528\u4f8b\\n\\n```javascript\\nimport React from \\"react\\";\\nimport ReactDOM from \\"react-dom\\";\\nimport App from \\"./App\\";\\nimport reducers from \\"./reducers\\";\\nimport { createStore } from \\"redux\\";\\nimport { Provider } from \\"react-redux\\";\\n\\nconst store = createStore(reducers);\\n\\nReactDOM.render(\\n  <React.StrictMode>\\n    <Provider store={store}>\\n      <App />\\n    </Provider>\\n  </React.StrictMode>,\\n  document.getElementById(\\"root\\")\\n);\\n```\\n\\n\u6700\u5916\u5c42`Provider`\u5c06\u6574\u4e2a\u5e94\u7528\u5305\u88f9\u4f4f\\n\\n\u5c06`createStore`\u8fd4\u56de\u7684`store`\u901a\u8fc7`props`\u4f20\u9012\u7ed9`Provider`\\n\\n**store \u5e76\u4e0d\u662f redux \u5b58\u50a8\u7684\u72b6\u6001**\uff0c\u8981\u83b7\u5f97\u5b58\u50a8\u7684\u72b6\u6001\u5fc5\u987b\u901a\u8fc7`store.getState()`\\n\\n```javascript\\nimport React, { Component } from \\"react\\";\\nimport { dispatchAdd, dispatchReduce } from \\"./actions\\";\\nimport { connect } from \\"react-redux\\";\\n\\nclass Counter extends component {\\n  render() {\\n    return <div>{this.props.counter}</div>;\\n  }\\n}\\n\\nconst mapStateToProps = function (state, ownProps) {\\n  return {\\n    counter: state.counter,\\n  };\\n};\\n\\nconst mapDispatchToProps = function (dispatch, ownProps) {\\n  return {\\n    add: dispatch(dispatchAdd),\\n    reduce: dispatch(dispatchReduce),\\n  };\\n};\\n\\nexport default connect(mapStateToProps, mapDispatchToProps)(Counter);\\n```\\n\\n\u5728\u9700\u8981 redux \u7684\u72b6\u6001\u65f6\uff0c\u7ec4\u4ef6\u901a\u8fc7`connect`\u5c06\u72b6\u6001\u4f20\u9012\u7ed9\u7ec4\u4ef6\\n\\nconnect \u6709\u56db\u4e2a\u4f20\u53c2\\n\\n1. `mapStateToProps?: Function` \u5c06 state \u6ce8\u5165\u5230\u7ec4\u4ef6\u4e2d\\n2. `mapDispatchToProps?: Function | Object` \u5c06 action \u6ce8\u5165\u5230\u7ec4\u4ef6\u4e2d\\n3. `mergeProps?: Function` \u5728\u524d\u4e24\u4e2a\u4f20\u53c2\u7684\u8fd4\u56de\u548c ownProps \u4f5c\u4e3a\u4f20\u53c2\uff0c\u8fd4\u56de\u5408\u5e76\u540e\u7684 props\\n4. `options?: Object` \u81ea\u5b9a\u4e49\u4f20\u5165\u7684 context \uff0c\u662f\u5426\u662f\u9700\u8981\u6bd4\u8f83\u524d\u540e\u72b6\u6001\u4ee5\u53ca\u6bd4\u8f83\u7684\u65b9\u6cd5\uff0c\u8f6c\u53d1 ref \u8fd4\u56de\u539f\u7ec4\u4ef6\u8fd8\u662f\u5305\u88c5\u540e\u7684\u7ec4\u4ef6\\n\\n\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u6211\u4eec\u53ea\u4f7f\u7528\u5230\u524d\u4e24\u4e2a\u65b9\u6cd5\uff08\u672c\u6587\u4e5f\u53ea\u4f1a\u8bb2\u8ff0\u8fd9\u4e24\u90e8\u5206\uff09\\n\\n\u901a\u8fc7\u4e0a\u9762\u7528\u4f8b\u53ef\u4ee5\u77e5\u9053\\n\\n- `Provider`\u8d1f\u8d23\u4f20\u9012`store`\\n- `connect`\u8d1f\u8d23\u63a5\u6536`store`\uff0c\u5e76\u5c06`state`\u6ce8\u5165\u5230\u7ec4\u4ef6\u4e2d\\n\\n`Provider`\u662f\u901a\u8fc7\u4ec0\u4e48\u8fdb\u884c`store`\u4f20\u9012\uff1f\\n\u7b54\u6848\u662f\uff1a[Context](https://reactjs.org/docs/context.html)\\n\\n\u4ec0\u4e48\u662f`Context`\uff1f\\n\\n\u7b80\u5355\u6765\u8bf4\uff0c`Context`\u662f React \u63d0\u4f9b\u7684\u4e00\u79cd\u6570\u636e\u4f20\u9012\u65b9\u5f0f\uff0c`Context`\u80fd\u591f\u81ea\u52a8\u7684\u81ea\u4e0a\u800c\u4e0b\u4f20\u9012\u6570\u636e\uff0c\u4e0d\u9700\u8981\u50cf`props`\u90a3\u6837\u624b\u52a8\u5b9a\u4e49\u4f20\u9012\u7684\u6570\u636e\uff0c\u662f\u4e00\u4e2a**\u65e2\u65b9\u4fbf\u53c8\u5371\u9669**\u7684\u5c5e\u6027\u3002\'\\n\\n\u5982\u679c\u60f3\u8be6\u7ec6\u4e86\u89e3`Context`\u7684\u8be6\u7ec6\u7528\u6cd5\u548c\u8bf4\u660e\uff0c\u53ef\u4ee5\u53bb React \u5b98\u7f51\u67e5\u770b[\u6587\u6863](https://reactjs.org/docs/context.html)\\n\\n#### \u4e09\u3001\u52a8\u624b\\n\\n\u76ee\u6807\uff1a\u5b9e\u73b0`connect`\u548c`Provider`\\n\\n`connect`\u662f\u51fd\u6570\uff0c\u63a5\u6536`mapStateToProps`\u548c`mapDispatchToProps`\uff0c\u8fd4\u56de[hoc](https://reactjs.org/docs/higher-order-components.html)\\n\\n`Provider`\u662f\u7ec4\u4ef6\uff0c\u63a5\u6536`store`\u5e76\u901a\u8fc7`Context`\u4f20\u9012\u7ed9\u5176\u4ed6\u7ec4\u4ef6\\n\\n```javascript\\nimport React, { Component } from \\"react\\";\\nimport PropTypes from \\"prop-types\\";\\n\\nconst StoreContext = React.createContext();\\n\\nexport function connect(mapStateToProps, mapDispatchToProps) {\\n  return function (WrappedComponent) {\\n    return class connect extends Component {\\n      render() {\\n        return <WrappedComponent {...this.props} />;\\n      }\\n    };\\n  };\\n}\\n\\nexport class Provider extends Component {\\n  render() {\\n    return (\\n      <StoreContext.Provider value={this.props.store}>\\n        {this.props.children}\\n      </StoreContext.Provider>\\n    );\\n  }\\n}\\n\\nProvider.propTypes = {\\n  children: PropTypes.element.isRequired,\\n  store: PropTypes.shape({\\n    subscribe: PropTypes.func.isRequired,\\n    dispatch: PropTypes.func.isRequired,\\n    getState: PropTypes.func.isRequired,\\n  }),\\n};\\n```\\n\\n\u4e0a\u9762\u5c31\u662f`connect`\u548c`Provider`\u6700\u57fa\u7840\u7684\u5b9a\u4e49\\n\\n\u518d\u6765\u662f`connect`\u63a5\u6536`Context`\uff0c\u5e76\u901a\u8fc7\u4f20\u5165\u7684\u4e24\u4e2a map \u65b9\u6cd5\u5c06\u9700\u8981\u7684`state`\u548c`dispatch`\u6ce8\u5165\u5230\u7ec4\u4ef6\u7684`props`\u4e2d\\n\\n```javascript\\n...\\n\\nexport function connect(mapStateToProps, mapDispatchToProps) {\\n  return function (WrappedComponent) {\\n    return class connect extends Component {\\n      static contextType = StoreContext;\\n\\n      constructor(props, context) {\\n        super(props, context);\\n\\n        this.store = props.store || context;\\n      }\\n\\n      render() {\\n        return (\\n          <WrappedComponent\\n            {...this.props}\\n            {...mapStateToProps(this.store.getState(), this.props)}\\n            {...mapDispatchToProps(this.store.dispatch, this.props)}\\n          />\\n        );\\n      }\\n    };\\n  };\\n}\\n\\n...\\n```\\n\\n\u5230\u8fd9\u4e00\u6b65\uff0c\u5df2\u7ecf\u5c06`state`\u548c`dispatch`\u6ce8\u5165\u5230\u7ec4\u4ef6\uff0c\u4f46\u89e6\u53d1`action`\u540e\u5e76\u4e0d\u4f1a\u89e6\u53d1\u7ec4\u4ef6`render`\uff0c\u539f\u56e0\u5728\u4e8e`state`\u53d8\u5316\u540e\u5e76\u6ca1\u6709\u91cd\u65b0\u6e32\u67d3\u7ec4\u4ef6\\n\\n\u6240\u4ee5\u8fd9\u4e00\u6b65\u6211\u4eec\u9700\u8981\u76d1\u542c`state`\u7684\u53d8\u5316\uff0c\u5e76\u4e14\u5728\u786e\u8ba4\u53d8\u5316\u540e\uff0c\u89e6\u53d1\u7ec4\u4ef6\u7684`render`\\n\\n```javascript\\n...\\n\\nexport function connect(mapStateToProps, mapDispatchToProps) {\\n  return function wrapWithComponent (WrappedComponent) {\\n    return class Connect extends Component {\\n      static contextType = StoreContext;\\n\\n      constructor(props, context) {\\n        super(props, context);\\n\\n        this.store = props.store || context;\\n        this.state = {\\n          storeState: this.store.getState(),\\n        };\\n      }\\n\\n      componentDidMount() {\\n        if (!this.unSubscribe) {\\n          this.unSubscribe = this.store.subscribe(\\n            this.handleStoreChange.bind(this)\\n          );\\n        }\\n      }\\n\\n      componentWillUnmount() {\\n        if (this.unSubscribe) {\\n          this.unSubscribe();\\n        }\\n        this.clearCache();\\n      }\\n\\n      handleStoreChange() {\\n        if (!this.unSubscribe) {\\n          return;\\n        }\\n\\n        const prevStoreState = this.state.storeState;\\n        const storeState = this.store.getState();\\n\\n        if (prevStoreState !== storeState) {\\n          this.setState({ storeState });\\n        }\\n      }\\n\\n      clearCache() {\\n        this.store = null;\\n        this.unSubscribe = null;\\n      }\\n\\n      render() {\\n        const storeState = this.state.storeState;\\n\\n        return (\\n          <WrappedComponent\\n            {...this.props}\\n            {...mapStateToProps(storeState, this.props)}\\n            {...mapDispatchToProps(this.store.dispatch, this.props)}\\n          />\\n        );\\n      }\\n    };\\n  };\\n}\\n\\n...\\n```\\n\\n\u5728\u8ba2\u9605\u540e\uff0c\u6bcf\u5f53\u89e6\u53d1\u4e00\u4e2a`action`\uff0c\u5c31\u4f1a\u89e6\u53d1`handleStoreChange`\u65b9\u6cd5\uff0c\u91cc\u9762\u5c06`prevStoreState`\u548c`storeState`\u8fdb\u884c\u6bd4\u8f83\uff0c\u53ea\u6709\u89e6\u53d1\u7684`reducers`\u8fd4\u56de\u539f\u672c\u7684`state`\u65f6\u624d\u4f1a\u662f true\\n\\n\u6bcf\u5f53`action`\u89e6\u53d1`state`\u53d8\u5316\u65f6\uff0c\u6bcf\u4e2a`WrappedComponent`\u90fd\u4f1a`render`\uff0c\u5373\u4f7f\u6539\u53d8\u7684`state`\u7ec4\u4ef6\u6ca1\u6709\u7528\u5230\uff0c\u6240\u4ee5\u63a5\u4e0b\u6765\u9700\u8981\u505a\u4e00\u4e9b\u4f18\u5316\\n\\n```javascript\\n...\\n\\n  shouldComponentUpdate(prevProps, prevState) {\\n    return !(\\n      shallowEqual(this.state.storeState, prevState.storeState) ||\\n      shallowEqual(\\n        mapStateToProps(this.state.storeState, this.props),\\n        mapStateToProps(prevState.storeState, prevProps)\\n      )\\n    );\\n  }\\n\\n...\\n```\\n\\n\u5728`shouldComponentUpdate`\u4e2d\uff0c\u6839\u636e\u524d\u540e\u7684`storeState`\u548c`mapStateToProps`\u7684\u7ed3\u679c\u6765\u51b3\u5b9a\u662f\u5426\u9700\u8981`render`\\n\\n![pic1](./assets/screenshots/1.png)\\n\\n\u53ef\u4ee5\u770b\u5230\u70b9\u51fb add \u6309\u94ae\u540e\uff0c\u53ea\u89e6\u53d1\u4e86`counter`\u7684`render`\uff0c\u8fbe\u5230\u4e86\u9884\u671f\u7684\u6548\u679c\uff08\u8fd9\u91cc`render`\u4e24\u6b21\u662f\u56e0\u4e3a`React.StrictMode`\uff0c\u8be6\u7ec6\u53ef\u4ee5\u770b[issues](https://github.com/facebook/react/issues/15074)\uff09\\n\\n\u5230\u8fd9\u6b65\u7b80\u6613`react-redux`\u7b97\u662f\u5b8c\u6210\u4e86\\n\\n#### \u601d\u8003\\n\\n\u6700\u540e\u603b\u7ed3\u4e00\u4e0b\u5b58\u5728\u7684\u4e00\u4e9b\u95ee\u9898\uff1a\\n\\n- `mapDispatchToProps`\u53ea\u80fd\u4f20\u9012`function`\u7c7b\u578b\\n\\n  - \u5b9e\u9645\u5f00\u53d1\u4e2d\u5927\u591a\u6570\u90fd\u4f1a\u4f20\u9012`action creater`\u800c\u4e0d\u662f`action`\uff0c\u6240\u4ee5\u652f\u6301`object`\u7c7b\u578b\u662f\u633a\u91cd\u8981\u7684\u4e00\u70b9\\n\\n- \u66f4\u65b0\u903b\u8f91\u4e0d\u5e94\u8be5\u5728`shouldComponentUpdate`\u91cc\\n\\n  - \u8fd9\u4e00\u70b9\u5728[React Redux with Dan Abramov](https://youtu.be/VJ38wSFbM3A)\u89c6\u9891\u91cc\u6709\u63d0\u5230\uff0c\u6700\u521d\u8bbe\u8ba1\u65f6\u66f4\u65b0\u903b\u8f91\u5199\u5728`shouldComponentUpdate`\u91cc\uff0c\u4f46\u5728\u7279\u6b8a\u60c5\u51b5\u4e0b\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6700\u540e\u6e32\u67d3\u51fa\u6765\u4e0d\u662f\u6700\u65b0\u7684`state`\uff08\u56e0\u4e3a\u672c\u4eba\u82f1\u8bed\u4e0d\u597d\uff0c\u6ca1\u80fd\u7406\u89e3\u9519\u8bef\u53d1\u751f\u7684\u60c5\u666f\uff0c\u6240\u4ee5\u5c31\u4e0d\u5199\u51fa\u6765\u6015\u8bef\u5bfc\u5927\u5bb6\uff0c\u89c6\u9891\u5185 24:59~27:30\uff09\\n\\n  - \u95ee\u9898\u7684\u6839\u672c\u539f\u56e0\u5728\u4e8e react \u662f\u5f02\u6b65\u6e32\u67d3\uff0c\u5bf9\u4e8e\u591a\u4e2a`setState`\u4f1a\u5408\u5e76\u6210\u4e00\u4e2a\u53bb\u6267\u884c\uff0c\u800c redux \u4fee\u6539`state`\u5374\u662f\u540c\u6b65\uff0c\u5f53`dipatch`\u65f6\uff0credux \u91cc\u7684`state`\u4f1a\u7acb\u5373\u6539\u53d8\uff0c\u5f02\u6b65\u4e0e\u540c\u6b65\u4e4b\u95f4\u7684\u5dee\u5f02\u5bfc\u81f4\u4e86\u95ee\u9898\\n\\n  - \u8bb2\u8ff0\u95ee\u9898\u7684\u540c\u65f6\u4e5f\u4ecb\u7ecd\u4e86\u65b0\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u5c06\u66f4\u65b0\u903b\u8f91\u653e\u5728`render`\u91cc\uff0c`connect`\u4f1a\u4fdd\u7559`React.createElement`\u751f\u6210\u7684`element`\u5bf9\u8c61\uff0c\u5728\u4e00\u7cfb\u5217\u5224\u65ad\u540e\u8fd4\u56de\u65b0\u65e7`element`\u5bf9\u8c61\uff08\u5982\u679c render \u91cc\u8fd4\u56de\u65e7\u7684 element \u5bf9\u8c61\uff0c\u5c06\u4e0d\u4f1a\u91cd\u65b0\u6e32\u67d3\uff09\\n\\n- \u66f4\u65b0\u903b\u8f91\u91cc\u6bcf\u4e2a`mapStateToProps`\u90fd\u5fc5\u987b\u91cd\u65b0\u6267\u884c\u4e00\u904d\\n\\n  - \u5f53 mapStateToProps \u7684\u8ba1\u7b97\u5f88\u91cd\u65f6\uff0c\u6bcf\u6b21\u6e32\u67d3\u90fd\u8981\u8bdd\u8d39\u5927\u91cf\u65f6\u95f4\uff0c\u8fd9\u662f react-redux \u672c\u8eab\u7684\u7f3a\u9677\uff08[reselect](https://github.com/reduxjs/reselect)\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\uff09\\n\\n#### \u53c2\u8003\u8d44\u6599\\n\\n[React Redux with Dan Abramov](https://youtu.be/VJ38wSFbM3A)\\n\\n[The History and Implementation of React-Redux](https://blog.isquaredsoftware.com/2018/11/react-redux-history-implementation/)"}]}')}}]);